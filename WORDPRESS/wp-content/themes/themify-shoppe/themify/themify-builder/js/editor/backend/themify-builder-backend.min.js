!function($,o,r,l){'use strict';const s=$('body');let a=!!l.is_gutenberg_editor,d=!1;if(0<$('#page-builder.themify_write_panel').length)a=!1,s[0].classList.remove('themify-gutenberg-editor');else if(!a)return;function t(){if(s[0].classList.contains('post-php')){const t=o.getElementById('post-lock-dialog');null===t||t.classList.contains('hidden')||Themify.LoadAsync(l.builder_url+'/js/editor/themify-ticks.js',function(){const t=TB_Ticks.init(l.ticks,window);s[0].classList.contains('tb_restriction')?t.show():t.ticks()},null,null,function(){return'undefined'!=typeof TB_Ticks})}'function'==typeof window.icl_copy_from_original&&$.ajaxPrefilter(function(t,e,n){if(e.data&&'string'==typeof e.data&&e.data.includes('icl_ajx_action=copy_from_original')){const i=t.success,o=new URLSearchParams(e.data);t.success=function(t){const e=$('#tb_canvas_block');var n;e.length&&e.hide().appendTo('body'),i(t),e.length&&$('#editor [data-type="themify-builder/canvas"]').empty().append(e.show()),t=o.get('lang'),n=o.get('trid'),$.ajax({url:ajaxurl,type:'POST',data:{action:'themify_builder_icl_copy_from_original',source_page_id:n,source_page_lang:t},success:function(t){if('-1'!=t){let e;try{e=$.parseJSON(t)||{}}catch(t){e={}}r.Forms.reLoad(e,l.post_ID)}}})}}}),Themify.LoadAsync(l.builder_url+'/js/editor/themify-constructor.js',function(){ThemifyConstructor.getForms(r.render)},null,null,function(){return'undefined'!=typeof ThemifyConstructor})}r.redirectFrontend=!1,r.toolbarCallback=function(){r.undoManager.btnUndo=r.toolbar.el.getElementsByClassName('tb_undo_btn')[0],r.undoManager.btnRedo=r.toolbar.el.getElementsByClassName('tb_redo_btn')[0],r.undoManager.compactBtn=r.toolbar.el.getElementsByClassName('tb_compact_undo')[0],Themify.trigger('tf_toolbar_callback'),Themify.body.triggerHandler('tf_toolbar_callback')},r.render=function(){const n=o.getElementById('tb_canvas_block');if(a&&!n)Themify.on('tb_canvas_loaded',r.render,!0);else{s[0].insertAdjacentHTML('afterbegin','<div class="tb_fixed_scroll" id="tb_fixed_bottom_scroll"></div>'),s.append($('<div/>',{id:'tb_alert'})),0===l.builder_data.length&&(l.builder_data={}),a&&(n.innerHTML='',n.appendChild(o.getElementById('tmpl-builder_admin_canvas_block').content)),ThemifyBuilderCommon.setToolbar(),r.toolbar=new r.Views.Toolbar({el:'#tb_toolbar'}),r.toolbar.render(),r.toolbarCallback(),r.Instances.Builder[0]=new r.Views.Builder({el:'#tb_row_wrapper',collection:new r.Collections.Rows(l.builder_data)}),r.Instances.Builder[0].render(),r.toolbar.pageBreakModule.countModules();const i=function(t){$('.themify_builder').find('input[required]').removeAttr('required'),d||(d=!0,a||(this.classList.remove('disabled'),t.preventDefault()),r.Utils.saveBuilder(function(){r.undoManager.reset(),d=!1,a?$('button.editor-post-publish-button__button').one('click',i):(this.classList.remove('disabled'),this.click())}.bind(this)))};let t=$('<a href="#" id="tb_switch_frontend_button" class="button tb_switch_frontend">'+l.i18n.switchToFrontendLabel+'</a>'),e=$('.themify-wp-editor-holder');$('input#publish,input#save-post,button.editor-post-publish-button__button').one('click',i),e.length?t=e.find('a'):t.appendTo('#postdivrich #wp-content-media-buttons'),t.on('click',function(t){t.preventDefault(),$('#tb_switch_frontend').trigger('click')}),r.Instances.Builder[r.builderIndex].$el.triggerHandler('tb_init'),sessionStorage.getItem('focusBackendEditor')&&(r._backendBuilderFocus(),sessionStorage.removeItem('focusBackendEditor')),ThemifyStyles.init(ThemifyConstructor.data,ThemifyConstructor.breakpointsReverse,l.post_ID)}},r._backendSwitchFrontend=function(t){let e=o.getElementById('page-builder');if(e){let t=o.createElement('input');t.type='hidden',t.name='tb_switch_frontend',t.value='yes',e.appendChild(t)}d=!0,'publish'===$('#original_post_status').val()?a?(($('.editor-post-publish-button').length?$('.editor-post-publish-button'):$('.editor-post-publish-panel__toggle')).trigger('click'),r.redirectFrontend=t,$('#tb_switch_frontend').trigger('click.frontend-btn')):$('#publish').trigger('click'):a?($('.editor-post-save-draft').trigger('click'),r.redirectFrontend=t):$('#save-post').trigger('click')},r._backendBuilderFocus=function(){$('#page-buildert').trigger('click'),a?r.Utils.scrollToDropped(r.toolbar.el):r.Utils.scrollTo(r.toolbar.$el.offset().top-$('#wpadminbar').height())},'complete'===o.readyState?t():window.addEventListener('load',t,{once:!0,passive:!0})}(jQuery,document,tb_app,themifyBuilder);