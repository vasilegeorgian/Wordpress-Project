var ThemifyBuilderCommon;!function($,v,m,a){'use strict';m!==window.self&&(window.wp.shortcode=m.wp.shortcode),ThemifyBuilderCommon={loader:null,showLoader(t){null===this.loader&&(this.loader=$(m.document.getElementById('tb_alert')));const e=this.loader[0];'show'===t?(e.classList.add('tb_busy'),e.style.display='block'):'spinhide'===t?this.loader.fadeOut(300,function(){this.classList.remove('tb_busy')}):('error'!==t&&(t='done'),e.classList.remove('tb_busy'),e.classList.add('tb_'+t),this.loader.delay(500).fadeOut(500,function(){this.classList.remove('tb_'+t)}))},clone(t){if(null===t)return t;const o=(t=void 0!==t[0]?t[0]:t).cloneNode(!0);if($(o).find('#tb_component_bar').empty().attr('id','').closest('.tb_clicked').removeClass('tb_clicked'),'visual'===tb_app.mode){const e=o.getElementsByTagName('video');if(0<e.length){for(let t=e.length-1;-1<t;--t)e[t].pause();for(let t=o.getElementsByClassName('big-video-wrap'),e=t.length-1;-1<e;--e)t[e]&&t[e].remove()}for(let t=o.getElementsByClassName('tb_dragger'),e=t.length-1;-1<e;--e)t[e].remove();for(let t=v.selectWithParent('tb_element_clicked',o),e=t.length-1;-1<e;--e)t[e].classList.remove('tb_element_clicked');for(let e=v.selectWithParent('[contenteditable]',o),i=e.length-1;-1<i;--i){e[i].setAttribute('contenteditable','false');let t=e[i].closest('.tb_editor_on');t&&t.classList.remove('tb_editor_on','tb_editor_clicked')}}return $(o)},Clipboard:{key:'themify_builder_clipboard_',set(t,e){const i={};i[t]=e,localStorage.setItem(this.key+'content',JSON.stringify(i))},get(t){const e=JSON.parse(localStorage.getItem(this.key+'content'));return void 0!==e[t]&&e[t]}},alertWrongPaste(){alert(themifyBuilder.i18n.text_alert_wrong_paste)},autoComplete(i){var l,t=$('.themify_tax_autocomplete',i);0<t.length&&(l=[],t.each(function(){var t,e=$(this),i=e.closest('.tb_input').find('input.query_category_multiple'),o=i.val();$(this).autocomplete({minLength:2,source(t,o){t=$.trim(t.term);$.getJSON(themifyBuilder.ajaxurl,{term:$.trim(t),tax:e.data('tax'),action:e.data('action')},function(t,e,i){o(t)})},select(t,e){return i.val(e.item.value),this.value=e.item.label,!1}}).focus(function(){return $(this).autocomplete("search"),!1}),o&&'undefined'!==o?((t={})[e.data('tax')]=o,l.push(t)):i.val('')}),0<l.length&&$.ajax({url:themifyBuilder.ajaxurl,type:'POST',dataType:'json',data:{data:l,action:'themify_builder_get_tax_data'},success(t){if(t)for(var e in t)$('#themify_search_cat_'+t[e].tax,i).val(t[e].val)}}))},Lightbox:{$lightbox:null,lightboxStorageKey:m!==window.self?'themify_builder_lightbox_frontend_pos_size':'themify_builder_lightbox_backend_pos_size',setup(){m.document.body.appendChild(a.getElementById('tmpl-builder_lightbox').content),this.$lightbox=$('#tb_lightbox_parent',m.document),ThemifyBuilderCommon.LiteLightbox.modal=new wp.media.view.Modal({controller:{trigger(){}}}),ThemifyBuilderCommon.LiteLightbox.modal.on('attach',function(){this.el.classList.add('tb_lite_lightbox_modal')}),this.bindEvents()},bindEvents(){const t=this;t.responsiveTabs(),t.$lightbox.one('themify_opened_lightbox',function(){t.resizable.init(),'visual'===tb_app.mode&&t.$lightbox[0].getElementsByClassName('builder_cancel_docked_mode')[0].addEventListener('click',function(t){t.preventDefault(),t.stopPropagation();const e=this.ownerDocument.body.classList;e.add('themify_lightbox_drag'),ThemifyBuilderCommon.Lightbox.dockMode.close(),e.remove('themify_lightbox_drag')}),t.$lightbox[0].getElementsByClassName('tb_close_lightbox')[0].addEventListener('click',function(){t.close()},{passive:!0})}),themifyBuilder.disableShortcuts||t.controlByKeyInput()},getLightboxStorage(){const t=localStorage.getItem(this.lightboxStorageKey);return t?JSON.parse(t):{}},updateLightboxStorage(t){localStorage.setItem(this.lightboxStorageKey,JSON.stringify(Object.assign(this.getLightboxStorage(),t)))},resizable:{$el:null,init(){const g=this,f=tb_app.Utils.getMouseEvents(),y=ThemifyBuilderCommon.Lightbox,x=m.document.body.classList,e=(this.$el=y.$lightbox,this.$el[0].getElementsByClassName('tb_resizable')),i=this.$el[0].querySelectorAll('.tb_lightbox_top_bar,.tb_action_breadcrumb');for(let t=e.length-1;-1<t;--t)e[t].addEventListener(f.mousedown,function(t){if('touchstart'===t.type||1===t.which){t.stopImmediatePropagation();let e;const i=this.ownerDocument,r=parseInt(g.$el.css('min-height')),d=.9*i.documentElement.clientHeight,h=350,m=880,c=this.dataset.axis,b=parseInt(g.$el[0].offsetHeight,10),u=parseInt(g.$el[0].offsetWidth,10),_=(t.touches?t.touches[0]:t).clientX,p=(t.touches?t.touches[0]:t).clientY,o=function(a){a.stopImmediatePropagation(),e&&cancelAnimationFrame(e),e=requestAnimationFrame(function(){let t;const e=g.$el[0],i=(a.touches?a.touches[0]:a).clientX,o=(a.touches?a.touches[0]:a).clientY;if('w'===c){if((t=(t=_+u-i)>m?m:t)>=h&&t<=m){const l=e.style.width;e.style.width=t+'px',e.style.left=parseInt(e.style.left)+parseInt(l)-t+'px',g.setupLightboxSizeClass(t)}}else{const s='-y'===c||'ne'===c||'nw'===c?p+b-o:b+o-p;if((t='sw'===c||'nw'===c?_+u-i:u+i-_)>m&&(t=m),('se'===c||'x'===c||'sw'===c||'nw'===c||'ne'===c)&&t>=h&&t<=m){const n=e.style.width;e.style.width=t+'px','sw'!==c&&'nw'!==c||(e.style.left=parseInt(e.style.left)+parseInt(n)-t+'px'),g.setupLightboxSizeClass(t)}('se'===c||'y'===c||'-y'===c||'sw'===c||'nw'===c||'ne'===c)&&s>=r&&s<=d&&('-y'!==c&&'nw'!==c&&'ne'!==c||(e.style.top=parseInt(e.style.top)+parseInt(e.style.height)-s+'px'),e.style.height=s+'px')}v.body.triggerHandler('themify_builder_resize_lightbox')})},l=function(t){t.stopImmediatePropagation(),this.removeEventListener(f.mousemove,o,{passive:!0}),e&&cancelAnimationFrame(e),e=null,y.fixContainment(),g.remember(),this.body.style.cursor='',x.remove('tb_start_animate','tb_move_drag','tb_panel_resize')};i.addEventListener(f.mousemove,o,{passive:!0}),i.addEventListener(f.mouseup,l,{passive:!0,once:!0}),x.add('tb_start_animate','tb_move_drag','tb_panel_resize'),'se'!==c&&'x'!==c&&'sw'!==c&&'ne'!==c&&'nw'!==c||g.setupLightboxSizeClass(),i.body.style.cursor=$(this).css('cursor')}},{passive:!0});for(let t=i.length-1;-1<t;--t)i[t].addEventListener(f.mousedown,function(t){if('touchstart'===t.type||1===t.which){const s=y.dockMode.get()&&!x.contains('tb_standalone_lightbox')&&(this.classList.contains('tb_action_breadcrumb')||t.target.classList.contains('tb_lightbox_top_bar'));if(s||t.target.classList.contains('tb_lightbox_top_bar')){t.stopImmediatePropagation();let e,o,l=g.$el[0];const i=this.ownerDocument,n=l.offsetLeft-(t.touches?t.touches[0]:t).clientX,a=l.offsetTop-(t.touches?t.touches[0]:t).clientY,r=function(i){i.stopImmediatePropagation(),e&&cancelAnimationFrame(e),e=requestAnimationFrame(function(){const t=n+(i.touches?i.touches[0]:i).clientX,e=a+(i.touches?i.touches[0]:i).clientY;l.style.left=t+'px',l.style.top=e+'px',y.dockMode.drag(i,t)})},d=function(t){if(o=!0,t.stopImmediatePropagation(),s){const e=l.offsetLeft,i=l.offsetTop;l.getElementsByClassName('builder_cancel_docked_mode')[0].click(),l.style.left=e+'px',l.style.top=i+'px'}x.add('tb_start_animate','tb_move_drag','themify_lightbox_drag')};i.addEventListener(f.mouseup,function(t){this.removeEventListener(f.mousemove,d,{passive:!0,once:!0}),this.removeEventListener(f.mousemove,r,{passive:!0}),o&&(r(t),requestAnimationFrame(function(){e=l=o=null,y.fixContainment(),x.remove('tb_start_animate','tb_move_drag','themify_lightbox_drag')}),g.remember())},{passive:!0,once:!0}),i.addEventListener(f.mousemove,d,{passive:!0,once:!0}),i.addEventListener(f.mousemove,r,{passive:!0})}}},{passive:!0});g.setupLightboxSizeClass()},remember(){if(!m.document.body.classList.contains('tb_standalone_lightbox')){const t=ThemifyBuilderCommon.Lightbox.resizable,e=t.$el.position(),i={top:e.top,left:e.left,width:t.$el.outerWidth(),height:t.$el.outerHeight()};ThemifyBuilderCommon.Lightbox.updateLightboxStorage(i),v.body.triggerHandler('themify_builder_resize_lightbox')}},setupLightboxSizeClass(t){if(null!==this.$el){t=t||parseInt(this.$el.width());const e=this.$el[0].classList;750<t?e.add('larger-lightbox'):e.remove('larger-lightbox'),t<540?e.add('tb_lightbox_small'):e.remove('tb_lightbox_small')}}},fixContainment(){const t=this.$lightbox[0].getBoundingClientRect(),e=t.width,i=m.innerWidth-20,o=m.innerHeight-30,l=t.left,s=t.top,n={};l<0?n.left=20:i<l+e&&(n.left=i-e),s<0?n.top=0:o<s&&(n.top=o);for(let t in n)this.$lightbox[0].style[t]=n[t]+'px'},setStandAlone(t,e,i){const o=this.$lightbox.outerWidth(),l=this.$lightbox.outerHeight(),s=m.document.documentElement.clientWidth,n=m.document.documentElement.clientHeight;i||'visual'!==tb_app.mode||(this.dockMode.get()&&(tb_app.toolbar.$el.find('.tb_toolbar_add_modules').click(),m.document.body.classList.contains('tb_panel_minimized')||('desktop'!==tb_app.activeBreakPoint?t+=this.dockMode.isLeft?150:-150:this.dockMode.isLeft&&(t+=300))),'desktop'!==tb_app.activeBreakPoint&&(t+=(s-tb_app.iframe.width())/2+8)),(t-=o/2)<=5?t=5:s<t+o&&(t=s-o-20),this.$lightbox.css({left:t,top:e=(e=n<(e+=50)+l?n-l-5:e)<0?5:e}).one('themify_opened_lightbox',function(){tb_app.Utils.addViewPortClass(this)})},open(s,n,a){const r=ThemifyBuilderCommon.Lightbox,d=m.document,h=r.$lightbox[0].querySelector('#tb_lightbox_container'),e=function(t){for(r.$lightbox[0].style.display='none','function'==typeof n&&n.call(r,t);null!==h.firstChild;)h.removeChild(h.firstChild);'string'==typeof t?h.innerHTML=t:h.appendChild(t);const e=d.body.classList.contains('tb_standalone_lightbox');let i,o=null;!1===e?(i={top:100,left:Math.max(0,$(m).width()/2-300),width:600,height:500},Object.assign(i,r.getLightboxStorage())):i={top:'',left:'',width:'',height:''};for(let t in i)r.$lightbox[0].style[t]=''!==i[t]?i[t]+'px':'';if(!1===e&&(!0===r.dockMode.get()?(r.dockMode.setDoc(),o=!0):r.fixContainment()),'function'==typeof a&&a.call(r,h),null===o&&r.resizable.setupLightboxSizeClass(i.width),r.$lightbox[0].style.display='block',r.$lightbox.triggerHandler('themify_opened_lightbox'),'inline'!==s.loadMethod){const l=h.getElementsByClassName('tb_tabs');for(let t=l.length-1;-1<t;--t){let e=l[t].getElementsByTagName('a');for(let t=e.length-1;-1<t;--t)e[t].addEventListener('click',ThemifyConstructor.switchTabs)}}tb_app.Instances.Builder[tb_app.builderIndex].lastRowShowHide()};'inline'===s.loadMethod?(v.body.triggerHandler('themify_builder_lightbox_close'),d.body.classList.remove('tb_standalone_lightbox'),e(ThemifyConstructor.run(s.templateID))):'html'===s.loadMethod?(tb_app.autoSaveCid=null,r.close(!0),!0===s.contructor?e(ThemifyConstructor.run(s.data,s.save)):e(s.data)):(ThemifyBuilderCommon.showLoader('show'),tb_app.autoSaveCid=null,r.close(!0),s.data.nonce=themifyBuilder.tb_load_nonce,s=_.defaults(s||{},{type:'POST',url:themifyBuilder.ajaxurl}),$.ajax(s).done(function(t){!0===s.contructor?e(ThemifyConstructor.run(t)):e(t),ThemifyBuilderCommon.showLoader('spinhide')}))},close(t){const e=ThemifyBuilderCommon.Lightbox;v.body.triggerHandler('themify_builder_lightbox_before_close'),'visual'===tb_app.mode&&m.jQuery('body').trigger('themify_builder_lightbox_close',t),t||(e.$lightbox[0].style.display='none',tb_app.autoSaveCid=null),e._cleanLightBoxContent(),t||(tb_app.undoManager.updateUndoBtns(),tb_app.Instances.Builder[tb_app.builderIndex].lastRowShowHide(!0),tb_app.Utils.removeViewPortClass(e.$lightbox[0])),tb_app.ActionBar.hoverCid=null,tb_app.ActionBar.clearSelected(),v.body.triggerHandler('themify_builder_lightbox_close',t)},dockMode:{key:'themify_builder_docked',leftKey:'themify_builder_docked_left',workspace:m.document.body.getElementsByClassName('tb_workspace_container')[0],minEl:null,width:322,isDocked:null,isLeft:null,set(t){(this.isDocked=t)?(localStorage.setItem(this.key,t),this.isLeft?localStorage.setItem(this.leftKey,!0):localStorage.removeItem(this.leftKey)):(localStorage.removeItem(this.key),localStorage.removeItem(this.leftKey)),v.body.triggerHandler('themify_builder_resize_lightbox')},get(){return'visual'===tb_app.mode&&(null===this.isDocked&&(this.isDocked='true'===localStorage.getItem(this.key)),!0===this.isDocked)&&(this.isLeft='true'===localStorage.getItem(this.leftKey),!0)},minimize(t){t.stopPropagation();const e=m.document.body.classList;e.contains('tb_panel_minimized')?e.remove('tb_panel_minimized'):e.add('tb_panel_minimized'),tb_app.Utils._onResize(!0)},setDoc(){if(null===tb_app.toolbar.getStorage()&&localStorage.setItem(this.key,!0),this.get()){const t=m.document.body.classList,e=tb_app;t.contains('tb_panel_docked')?ThemifyBuilderCommon.Lightbox.resizable.setupLightboxSizeClass(this.width):(t.add('tb_panel_docked'),this.isLeft?(t.add('tb_panel_left_dock'),t.remove('tb_panel_right_dock')):(t.add('tb_panel_right_dock'),t.remove('tb_panel_left_dock')),e.Utils._onResize(!0),ThemifyBuilderCommon.Lightbox.resizable.setupLightboxSizeClass(this.width),v.body.triggerHandler('themify_builder_resize_lightbox'),this.minEl=tb_app.toolbar.el.getElementsByClassName('tb_docked_minimize')[0],this.minEl.addEventListener('click',this.minimize,{passive:!0}),e.Views.Toolbar.prototype.removeFloat(),e.Views.Toolbar.prototype.openFloat(),e.Views.Toolbar.prototype._setResponsiveTabs())}},drag(t,e){if('visual'===tb_app.mode&&!this.get()){const i=m.document.body.classList;if(!i.contains('tb_standalone_lightbox')){const o=t.clientX+20>=m.innerWidth,l=t.type;this.isLeft=!o&&e<0,!o&&!this.isLeft||'mousemove'!==l&&'touchmove'!==l?i.remove('tb_dock_highlight','tb_dock_left_highlight'):(i.add('tb_dock_highlight'),this.isLeft?i.add('tb_dock_left_highlight'):i.remove('tb_dock_left_highlight')),!o&&!this.isLeft||'mouseup'!==l&&'touchend'!==l||(this.set(!0),this.setDoc())}}},close(t){if('visual'===tb_app.mode&&this.get()){const e=ThemifyBuilderCommon.Lightbox,i=m.document.body.classList,o=e.getLightboxStorage(),l={width:o.width||e.resizable.minWidth,height:o.height||e.resizable.minHeight,top:m.innerHeight/2-e.$lightbox.innerHeight()/2,left:m.innerWidth/2-e.$lightbox.innerWidth()/2};e.$lightbox.css(l),t&&m.document.body.classList.contains('tb_panel_closed')&&tb_app.Views.Toolbar.prototype.openFloat(),!this.isLeft&&t||(t?this.isLeft?i.remove('tb_panel_right_dock'):i.remove('tb_panel_left_dock'):(i.remove('tb_panel_left_dock','tb_panel_right_dock','tb_panel_docked'),null!==this.minEl&&(this.minEl.removeEventListener('click',this.minimize,{passive:!0}),this.minEl=null),null!==tb_app.activeModel&&localStorage.getItem('tb_panel_closed')&&tb_app.Views.Toolbar.prototype.closeFloat(),tb_app.Views.Toolbar.prototype.setFloat(),i.contains('tb_standalone_lightbox')||this.set(null))),e.resizable.setupLightboxSizeClass(l.width),tb_app.Utils._onResize(!0)}}},_cleanLightBoxContent(){let t=this.$lightbox.find('#tb_lightbox_container')[0];for(;null!==t.firstChild;)t.removeChild(t.firstChild);for(t=this.$lightbox[0].getElementsByClassName('tb_options_tab')[0];null!==t.firstChild;)t.removeChild(t.firstChild);for(t=this.$lightbox[0].getElementsByClassName('tb_lightbox_actions_wrap')[0];null!==t.firstChild;)t.removeChild(t.firstChild);for(t=this.$lightbox[0].getElementsByClassName('tb_action_breadcrumb')[0];null!==t.firstChild;)t.removeChild(t.firstChild)},controlByKeyInput(){function t(e){if(27===e.keyCode&&tb_app.activeModel)e.preventDefault(),e.stopPropagation(),ThemifyBuilderCommon.Lightbox.close();else if(83===e.which&&(!0===e.ctrlKey||!0===e.metaKey)&&'INPUT'!==m.document.activeElement.tagName&&'TEXTAREA'!==m.document.activeElement.tagName){e.preventDefault(),e.stopPropagation();let t=tb_app.activeModel?$('.builder_save_button',ThemifyBuilderCommon.Lightbox.$lightbox):null;(t=null!==t&&0!==t.length?t:tb_app.toolbar.$el.find('.tb_toolbar_save')).click()}}$(a).on('keydown.tb_shortcut',t),'visual'===tb_app.mode&&$(m.document).on('keydown.tb_shortcut',t)},responsiveTabs(){var o,l,s=null,n=null,t=function(t,e,i){setTimeout(function(){'styling'===ThemifyConstructor.clicked&&(function(t){if(void 0!==(s=null===s?t.getElementsByClassName('tb_tabs')[0]:s)){if(!l){if(void 0===(o=s.getElementsByTagName('ul')[0]))return;{let t=o.getElementsByTagName('li');if(t=t[t.length-1],t=$(t),s=$(s),'rtl'===a.dir){const e=t.outerWidth(),i=m.innerWidth;l=i-(t.offset().left+e)+e-(i-(s.offset().left+s.outerWidth()))}else l=t.offset().left+t.outerWidth()-s.offset().left}}s.innerWidth()<=l?(s[0].classList.add('tb_compact_tabs'),o.classList.add('tb_ui_dropdown_items'),null===n&&((n=a.createElement('span')).className='tb_ui_dropdown_label',n.tabIndex='-1',n.textContent=o.getElementsByClassName('current')[0].textContent,o.parentNode.insertBefore(n,o))):(s[0].classList.remove('tb_compact_tabs'),o.classList.remove('tb_ui_dropdown_items'))}}(null===s?m.document.getElementById('tb_options_styling'):null),'themify_builder_tabsactive'===t.type&&null!==n&&(n.textContent=o.getElementsByClassName('current')[0].textContent))},4)};v.body.on('themify_builder_tabsactive themify_builder_resize_lightbox',t).on('themify_builder_lightbox_close',function(){s=o=l=n=null}),this.$lightbox.on('themify_opened_lightbox',t)}},LiteLightbox:{modal:null,confirmView:Backbone.View.extend({template:wp.template('builder_lite_lightbox_confirm'),className:'tb_lite_lightbox_content',initialize(t){this.options=t||{}},render(){this.el.innerHTML=this.template({message:this.options.message,buttons:this.options.buttons})},events:{'click button':'buttonClick'},buttonClick(t){t.preventDefault(),this.trigger('litelightbox:confirm',$(t.currentTarget).data('type'))}}),promptView:Backbone.View.extend({template:wp.template('builder_lite_lightbox_prompt'),className:'tb_lite_lightbox_content',initialize(t){this.options=t||{}},render(){this.$el.html(this.template(this.options))},events:{'click button':'buttonClick','keypress .tb_litelightbox_prompt_input':'keyPress'},buttonClick(t){t.preventDefault(),this.trigger('litelightbox:prompt',$(t.currentTarget).data('type'),this.$el.find('.tb_litelightbox_prompt_input').val())},keyPress(t){13===t.which&&this.trigger('litelightbox:prompt','ok',$(t.currentTarget).val())}}),confirm(t,e,i){(i=_.defaults(i||{},{buttons:{no:{label:'No'},yes:{label:'Yes'}}})).message=t;const o=new ThemifyBuilderCommon.LiteLightbox.confirmView(i);ThemifyBuilderCommon.LiteLightbox.modal.content(o),ThemifyBuilderCommon.LiteLightbox.modal.open(),o.on('litelightbox:confirm',function(t){ThemifyBuilderCommon.LiteLightbox.modal.close(),'function'==typeof e&&e.call(this,t)})},prompt(t,i,e){(e=_.defaults(e||{},{buttons:{cancel:{label:'Cancel'},ok:{label:'OK'}}})).message=t;const o=new ThemifyBuilderCommon.LiteLightbox.promptView(e);ThemifyBuilderCommon.LiteLightbox.modal.content(o),ThemifyBuilderCommon.LiteLightbox.modal.open(),o.on('litelightbox:prompt',function(t,e){ThemifyBuilderCommon.LiteLightbox.modal.close(),'function'==typeof i&&i.call(this,e='cancel'===t?null:e)})},alert(t){ThemifyBuilderCommon.LiteLightbox.confirm(t,null,{buttons:{yes:{label:'OK'}}})}},templateCache:{templates:[],get(t){if(void 0===this.templates[t]){const e=a.getElementById(t);this.templates[t]=e.innerHTML,setTimeout(function(){e.remove()},6e3)}return this.templates[t]}},setToolbar(){const t=a.getElementById('tb_toolbar_template'),e=t.content;'visual'===tb_app.mode?a.body.appendChild(e):t.parentNode.insertBefore(e,t),t.remove()},isImageUrl(t){if(!t)return!1;const e=t.split('?')[0].split('.');return-1!==['jpg','jpeg','tiff','png','gif','bmp','svg'].indexOf(e[e.length-1])}}}(jQuery,Themify,window.top,document);