!function($,t,C,y){'use strict';$.ThemifyGradient=function(c,t){const e={gradient:$.ThemifyGradient.default,width:173,height:15,point:8,angle:180,circle:!1,type:'linear',onChange(){},onInit(){}},d=$(c);let g,p,f,m,u,h,_=[];return this.isInit=!1,this.initSwatchesFlag=!1,this.settings={},this.__constructor=function(){return this.settings=$.extend({},e,t),this.update(),this.settings.onInit(),this.isInit=!0,this},this.updateSettings=function(t){return this.settings=$.extend({},e,t),this.update(),this},this.update=function(){this._setupPoints(),this._setup(),this._render()},this.getCSSvalue=function(){const i=[],t='radial'===this.settings.type?this.settings.circle?'circle,':'':this.settings.angle+'deg,';for(let t=0,e=_.length;t<e;++t)i.push(_[t][1]+' '+_[t][0]);return this.settings.type+'-gradient('+t+i.join(', ')+')'},this.getString=function(){let i='';for(let t=0,e=_.length;t<e;++t)i+=_[t][0]+' '+_[t][1]+'|';return i.substr(0,i.length-1)},this.setType=function(t){this.settings.type=t,this.settings.onChange(this.getString(),this.getCSSvalue())},this.setAngle=function(t){this.settings.angle=t,this.settings.onChange(this.getString(),this.getCSSvalue())},this.setRadialCircle=function(t){this.settings.circle=t,this.settings.onChange(this.getString(),this.getCSSvalue())},this._setupPoints=function(){_=[],_=Array.isArray(this.settings.gradient)?this.settings.gradient:this._getGradientFromString(this.settings.gradient)},this._setup=function(){const a=this,t=C.createDocumentFragment(),e=C.createElement('div'),i=C.createElement('div'),n=C.createElement('span'),s=C.createElement('span'),r=C.createElement('div'),o=C.createElement('div');u=C.createElement('a'),f=C.createElement('div'),m=C.createElement('input'),g=C.createElement('div'),p=C.createElement('div');let l=C.createElement('canvas');for(e.className='themifyGradient tf_rel',l.width=this.settings.width,l.height=this.settings.height,g.className='points',f.className='point-color',n.className='gradient_delimiter',s.className='gradient_percent',s.innerHTML='%',m.type='text',m.className='point-position',u.className='gradient-point-delete tf_close',u.href='#',i.className='gradient-pointer-info',p.className='content',r.style.backgroundColor='#00ff00',o.className='gradient-pointer-arrow',f.appendChild(r),i.appendChild(o),p.appendChild(f),p.appendChild(n),p.appendChild(m),p.appendChild(s),p.appendChild(u),t.appendChild(g),t.appendChild(l),i.appendChild(p),t.appendChild(i),e.appendChild(t);c.firstChild;)c.removeChild(c.firstChild);c.appendChild(e),this.initSwatchesFlag||(c.parentNode.appendChild(this.swatchesHTML()),this.initSwatches(),this.initSwatchesFlag=!0),p=$(p),f=$(f),m=$(m),u=$(u),g=$(g),h=l.getContext('2d'),(l=$(l)).off('click').on('click',function(t){const e=$(this).offset();let i='rgba(0,0,0, 1)',n=999999999999,s=t.pageX-e.left;s=Math.round(100*s/a.settings.width);for(let t=0,e=_.length;t<e;++t)_[t][0]=parseInt(_[t][0]),_[t][0]<s&&s-_[t][0]<n?(n=s-_[t][0],i=_[t][1]):_[t][0]>s&&_[t][0]-s<n&&(n=_[t][0]-s,i=_[t][1]);_.push([s+'%',i]),_.sort(a._sortByPosition),a._render();for(let t=0,e=_.length;t<e;++t)_[t][0]===s+'%'&&a._selectPoint(g.find('.point:eq('+t+')')[0]);'visual'===y.mode&&setTimeout(a._colorPickerPosition,315)}),this.pointEvents()},this.pointEvents=function(){const l=this,h=y.Utils.getMouseEvents(),t=function(e){const i=e.target;if(i.classList.contains('point-position')){let t=parseInt(i.value.trim());isNaN(t)?t=0:t<0?t=Math.abs(t):98<=t&&(t=98),'focusout'!==e.type?(t=Math.round(t*l.settings.width/100),$(i).closest('.themifyGradient').find('.themify_current_point').css('left',t),l._renderCanvas()):i.value=t}};p[0].addEventListener('focusout',t,{passive:!1}),p[0].addEventListener('keyup',t,{passive:!1}),g[0].addEventListener('keyup',function(t){const e=t.keyCode||t.which||0;8!==e&&46!==e||'INPUT'===C.activeElement.tagName||(m.focus(),l.removePoint(t))},{passive:!1}),g[0].addEventListener('click',function(t){t.target.classList.contains('point')&&(l._selectPoint(t.target),'visual'===y.mode&&l._colorPickerPosition())},{passive:!0}),g[0].addEventListener(h.mousedown,function(e){if(('touchstart'===e.type||1===e.which)&&e.target.classList.contains('point')){e.stopImmediatePropagation();let t;const i=e.target,n=function(t){c.focus(),i.classList.add('tb_gradient_drag_point'),this.body.classList.add('tb_start_animate','tb_move_drag','tb_gradient_drag')},s=l.settings.width,a=parseFloat(window.getComputedStyle(i).getPropertyValue('margin-left'))||0,r=i.offsetLeft-(e.touches?e.touches[0]:e).clientX,o=function(e){e.stopImmediatePropagation(),t&&cancelAnimationFrame(t),t=requestAnimationFrame(function(){let t=r+(e.touches?e.touches[0]:e).clientX-a;t>s?t=s:t<0&&(t=0),i.style.left=t+'px',l._selectPoint(i,!0),l._renderCanvas()})};C.addEventListener(h.mouseup,function(t){t.stopImmediatePropagation(),this.removeEventListener(h.mousemove,n,{passive:!0,once:!0}),this.removeEventListener(h.mousemove,o,{passive:!0}),this.body.classList.remove('tb_start_animate','tb_move_drag','tb_gradient_drag'),i.classList.remove('tb_gradient_drag_point'),c.focus()},{passive:!0,once:!0}),C.addEventListener(h.mousemove,n,{passive:!0,once:!0}),C.addEventListener(h.mousemove,o,{passive:!0})}},{passive:!0})},this._render=function(){this._initGradientPoints(),this._renderCanvas()},this._colorPickerPosition=function(){const t=ThemifyBuilderCommon.Lightbox.$lightbox,e=p.find('.tfminicolors'),i=e.find('.tfminicolors-panel');0<i.length&&(t.offset().left+t.width()<=i.offset().left+i.width()?e.addClass('tb_minicolors_right'):e.removeClass('tb_minicolors_right'))},this._initGradientPoints=function(){const i=C.createDocumentFragment();for(;g[0].firstChild;)g[0].removeChild(g[0].firstChild);for(let e=0,t=_.length;e<t;++e){let t=C.createElement('div');t.className='point',t.style.backgroundColor=_[e][1],t.style.left=parseInt(_[e][0])*this.settings.width/100+'px',i.appendChild(t)}g[0].appendChild(i)},this.hexToRgb=function(t){t=t.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(t,e,i,n){return e+e+i+i+n+n});const e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:null},this._selectPoint=function(r,o){if(r){const l=this;let t=parseInt(r.style.left);if(m.val(Math.round(t/this.settings.width*100)),(t-=30)<0&&C.body.classList.contains('tb_module_panel_docked')&&(t=3),p[0].parentNode.style.marginLeft=t+'px',o)return!1;d.focus();const h=$(r);h.addClass('themify_current_point').siblings().removeClass('themify_current_point');let e=h.css('backgroundColor'),i=e.substr(4,e.length),n=(i=i.substr(0,i.length-1),d.find('.point-color .tfminicolors').remove(),f.find('.themify-color-picker')),s=(0===n.length&&((n=$('<input type="text" class="themify-color-picker" />')).appendTo(f).tfminicolors({opacity:!0,changeDelay:10,change(t,e){let i=l.hexToRgb(t);i||(i={r:255,g:255,b:255},e=1),h.css('backgroundColor','rgba('+i.r+','+i.g+','+i.b+','+e+')'),l._renderCanvas()}}),d.find('.tfminicolors').first().addClass('tfminicolors-focus'),u.off('click').on('click',this.removePoint.bind(this))),e.replace(/^rgba?\(|\s+|\)$/g,'').split(',')),a=4===s.length?s.pop():1;s=this._rgbToHex(s),n.val(s).attr('data-opacity',a).data('opacity',a).tfminicolors('settings',{value:s})}},this._renderCanvas=function(){const i=g[0].getElementsByClassName('point');_=[];for(let e=0,t=i.length;e<t;++e){let t=Math.round(parseInt(i[e].style.left)/this.settings.width*100);_.push([t+'%',i[e].style.backgroundColor])}_.sort(this._sortByPosition),this._renderToCanvas(),this.isInit&&this.settings.onChange(this.getString(),this.getCSSvalue())},this._renderToCanvas=function(){const i=h.createLinearGradient(0,0,this.settings.width,0);for(let t=0,e=_.length;t<e;++t)i.addColorStop(parseInt(_[t][0])/100,_[t][1]);h.clearRect(0,0,this.settings.width,this.settings.height),h.fillStyle=i,h.fillRect(0,0,this.settings.width,this.settings.height)},this._getGradientFromString=function(t){const a=[],r=t.split('|');for(let s=0,t=r.length;s<t;++s){let t,e=r[s],i=e.indexOf('%'),n=e.substr(i-3,i);'100'===n||'100%'===n?t='100%':(t=1<i?parseInt(e.substr(i-2,i)):parseInt(e.substr(i-1,i)),t+='%'),a.push([t,e.replace(t,'')])}return a},this._rgbToHex=function(t){const e=t[0],i=t[1],n=t[2];function s(t){return t=parseInt(t,10),isNaN(t)?'00':(t=Math.max(0,Math.min(t,255)),'0123456789ABCDEF'.charAt((t-t%16)/16)+'0123456789ABCDEF'.charAt(t%16))}return'#'+s(e)+s(i)+s(n)},this._sortByPosition=function(t,e){return(t=parseInt(t[0]))<(e=parseInt(e[0]))?-1:e<t?1:0},this.removePoint=function(t){if(t.preventDefault(),1<_.length){_.splice((void 0).index(),1);const e=p[0].parentNode;e.style.display='none',setTimeout(function(){e.style.display=''},50),this._render()}},this.swatchesHTML=function(){const t=C.createDocumentFragment(),e=C.createElement('div'),i=C.createElement('ul'),n=themifyColorManager.makeImportExportDropdown(),s=C.createElement('a');s.className='tb_gradient_add_swatch tf_plus_icon';let a=C.createElement('span');return a.className='themify_tooltip',a.innerText=ThemifyConstructor.label.save_gradient,s.appendChild(a),s.href='#',s.addEventListener('click',this.saveSwatch.bind(this)),e.className='tf_cm_dropdown_icon',e.tabIndex=1,(a=C.createElement('span')).className='themify_tooltip',a.innerText=ThemifyConstructor.label.ie_gradient,e.appendChild(a),n.addEventListener('click',this.swatchesDropdownClicked.bind(this)),e.appendChild(y.Utils.getIcon('ti-import')),e.appendChild(n),i.className='tb_gradient_swatches',i.addEventListener('click',this.swatchClicked.bind(this)),t.appendChild(s),t.appendChild(e),t.appendChild(i),t},this.swatchesDropdownClicked=function(t){t.preventDefault(),t.stopPropagation();const e=t.target,i=e.classList;i.contains('tb_cm_export')?(e.parentNode.parentNode.parentNode.blur(),C.location.assign(themifyCM.exportGradientsURL)):i.contains('tb_cm_import')&&(e.parentNode.parentNode.parentNode.blur(),themifyColorManager.importColors('gradients'))},this.saveSwatch=function(){if(''===this.getString()||''===this.getCSSvalue())return!1;const e=Object.keys(themifyCM.gradients),i=this.getCSSvalue();for(let t=e.length-1;-1<t;--t)if(themifyCM.gradients[e[t]].css===i)return null;const t=themifyColorManager.UID(),n={id:t,setting:JSON.parse(JSON.stringify(this.settings)),gradient:this.getString(),css:i,points:_};themifyCM.gradients[t]=n,this.addSwatch(n),themifyColorManager.updateColorSwatches('gradients')},this.addSwatch=function(t,e){const i=C.createElement('li'),n=C.createElement('span');if(i.className='tb_gradient_swatch',i.style.background=t.css,i.dataset.id=t.id,n.className='tf_delete_swatch tf_close',i.appendChild(n),e){const s=c.parentElement.getElementsByClassName('tb_gradient_swatches')[0];s.insertBefore(i,s.firstChild)}else{const a=ThemifyBuilderCommon.Lightbox.$lightbox[0].getElementsByClassName('tb_gradient_swatches');for(let t=0,e=a.length;t<e;++t)a[t].insertBefore(i.cloneNode(!0),a[t].firstChild)}},this.swatchClicked=function(t){t.preventDefault();const e=t.target,i=e.classList;i.contains('tb_gradient_swatch')?this.selectSwatch(e.dataset.id):i.contains('tf_delete_swatch')&&(this.removeSwatch(e.parentNode.dataset.id),themifyColorManager.updateColorSwatches('gradients'))},this.removeSwatch=function(t){const e=ThemifyBuilderCommon.Lightbox.$lightbox[0].querySelectorAll('.tb_gradient_swatch[data-id="'+t+'"]');for(let t=e.length-1;-1<t;--t)e[t].parentNode.removeChild(e[t]);delete themifyCM.gradients[t]},this.selectSwatch=function(t){const e=themifyCM.gradients[t],i=(this.setAngle(e.setting.angle),this.setRadialCircle(e.setting.circle),this.setType(e.setting.type),this.settings.gradient=e.gradient,this.update(),c.parentElement),n=i.getElementsByClassName('themify-gradient-type')[0],s=i.querySelector('input[type="checkbox"]'),a=i.getElementsByClassName('tb_angle_input')[0];n.value=e.setting.type,Themify.triggerEvent(n,'change'),s.checked=e.setting.circle,Themify.triggerEvent(s,'change'),a.value=e.setting.angle,Themify.triggerEvent(a,'change')},this.initSwatches=function(){const i=Object.keys(themifyCM.gradients);themifyCM.gradients=i.length?themifyCM.gradients:{};for(let t=0,e=i.length;t<e;++t)this.addSwatch(themifyCM.gradients[i[t]],!0)},this.__constructor()},$.ThemifyGradient.default='0% rgba(0,0,0, 1)|100% rgba(255,255,255,1)',$.fn.ThemifyGradient=function(t){return this.each(function(){void 0===$(this).data('themifyGradient')&&$(this).data('themifyGradient',new $.ThemifyGradient(this,t))})}}(jQuery,window.top,window.top.document,tb_app);