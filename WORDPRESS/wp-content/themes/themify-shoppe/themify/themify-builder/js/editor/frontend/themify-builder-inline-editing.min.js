!function(q,$,k,B,M,y){'use strict';let R,r,C,n,S,I,t,z,g=null,l=null,d=null,p=null,b=null,h=null,F=!1,e=!1,c=!1,L,u,m,T=!1,a,P=!1,E=!1;const U=M.Utils.getMouseEvents(),H=q.isTouch?U:{mousedown:'click'},f=function(t){M.hasChanged=!0;const e=void 0!==arguments[1]?arguments[1]:null;B.execCommand(t,!1,e),_()},D=function(t){const e=B.queryCommandState(t);return-1!==e&&e},o={formatBlock:{result(t){const e=t.parentNode.classList.contains('tb_editor_selected')?'p':t.getAttribute('data-action');f('formatBlock','<'+e+'>')},state(t){const i=t.getElementsByClassName('tb_editor_options')[0].getElementsByClassName('tb_editor_action'),s=B.queryCommandValue('formatBlock');for(let e=i.length-1;-1<e;--e){let t=i[e].parentNode.classList;s===i[e].getAttribute('data-action')?t.contains('tb_editor_selected')||(t.add('tb_editor_selected'),j(i[e])):t.remove('tb_editor_selected')}}},text_align:{result(t){if(t.parentNode.classList.contains('tb_editor_selected')){if(h){if(h.startContainer){h.startContainer.parentNode.style.textAlign='';const e=h.startContainer.parentNode.closest('[style*=text-align]');e&&(e.style.textAlign='')}if(h.commonAncestorContainer){h.commonAncestorContainer.nodeType!==Node.TEXT_NODE&&(h.commonAncestorContainer.style.textAlign='');const i=h.startContainer.parentNode.closest('[style*=text-align]');i&&(i.style.textAlign='')}_()}}else f(t.getAttribute('data-action'))},state(t){const i=t.getElementsByClassName('tb_editor_options')[0].getElementsByClassName('tb_editor_action');let s=!1;for(let e=i.length-1;-1<e;--e){let t=i[e].parentNode.classList;i[e].hasAttribute('data-action')&&D(i[e].getAttribute('data-action'))?(t.contains('tb_editor_selected')||j(i[e]),s=!0):t.remove('tb_editor_selected')}!1===s&&t.classList.remove('tb_editor_selected')}},list:{result(t){f(t.getAttribute('data-action'))},state(t){o.text_align.state(t)}},image:{state(t){},result(t){const m=B.createElement('div'),_=B.createElement('hidden');T=!0;let g;_.addEventListener('change',function(t){t.stopImmediatePropagation();const e=g.state().get('selection').first().toJSON(),i=e.id,s=null!==R.closest('[data-hasEditor]'),o=R.classList;let a=e.title||'',n=e.alt||a;for(let t=o.length-1;-1<t;--t)if(0===o[t].indexOf('wp-image-')){o.remove(o[t]);break}if(o.add('wp-image-'+i),F){L=R.closest('.active_module').outerHTML;const l=B.createElement('div'),r=R.hasAttribute('data-w')||R.hasAttribute('data-h'),d=!!R.hasAttribute('data-w')&&R.getAttribute('width'),c=!!R.hasAttribute('data-h')&&R.getAttribute('height'),u=function(){P=!0,X(!s);const t=R.closest('.active_module');t&&(R.hasAttribute('data-update')&&(t.innerHTML=t.innerHTML,R=t.getElementsByClassName('tb_selected_img')[0]),M.Utils.runJs($(t),'module')),q.trigger('tb_image_resize',R),at(),O(),q.requestIdleCallback(function(){setTimeout(function(){requestAnimationFrame(O)},25)},500),l.remove()};l.className='tf_loader',b.appendChild(l),b.classList.add('tb_image_editor_loading'),R.removeAttribute('srcset'),!s&&r?(R.setAttribute('data-orig',e.url),R.setAttribute('data-ext',e.mime)):(R.removeAttribute('data-ext'),R.removeAttribute('data-orig'),s&&(R.alt=n,R.title=a)),r&&(!s||d||c)||(R.width=e.width,R.height=e.height),!d&&!c||s?(R.addEventListener('load',u,{passive:!0,once:!0}),R.setAttribute('src',e.url)):M.Utils.resizeImage(R,d,c).finally(u)}else A(),f('insertImage',e.url);_.remove(),m.remove(),T=!1},{passive:!0,once:!0}),ThemifyConstructor.file.browse(m,_,ThemifyConstructor,'image'),m.click(),g=ThemifyConstructor.file._frames.image;const e=function(){g.off('close',e),T=!1,setTimeout(function(){g=null},50)};g.on('close',e)}},link:{state(t){if(h){const e=h.startContainer.parentNode.closest('a'),i=g.classList;e&&e===h.endContainer.parentNode.closest('a')?(d.firstChild.textContent=d.nextElementSibling.href=e.getAttribute('href'),i.add('tb_editor_show_link'),v(),w(!0)):g.classList.contains('tb_editor_show_link')&&(d.firstChild.textContent=d.nextElementSibling.href='',i.remove('tb_editor_show_link'),v(),w(!0))}},result(t){const e=g.getElementsByClassName('tb_editor_link_options')[0].cloneNode(!0),i=e.getElementsByClassName('tb_editor_link_input')[0],s=e.querySelector('#tb_editor_link_type'),o=h.startContainer.parentNode.closest('a'),a=ThemifyConstructor,n={px:{min:1,max:5e4},'%':{min:1,max:500}},l=(e.querySelector('#tb_editor_lb_w_holder').replaceWith(a.range.render({id:'tb_editor_lb_w',control:!1,units:n},a)),e.querySelector('#tb_editor_lb_h_holder').replaceWith(a.range.render({id:'tb_editor_lb_h',control:!1,units:n},a)),e.querySelector('#tb_editor_lb_w')),r=e.querySelector('#tb_editor_lb_h'),d=e.querySelector('#tb_editor_lb_w_unit'),c=e.querySelector('#tb_editor_lb_h_unit');if(i.value=l.value=r.value='',s.selectedIndex=d.selectedIndex=c.selectedIndex=0,o&&o===h.endContainer.parentNode.closest('a')){let t=o.getAttribute('target');if(i.value=o.getAttribute('href'),(t='_blank'!==t&&o.hasAttribute('data-zoom-config')?'lightbox':t)&&(s.value!==t&&(s.value=t),'lightbox'===t)){const u=o.getAttribute('data-zoom-config').split('|'),m=-1!==u[0].indexOf('%')?'%':'px',_=u[1]&&-1!==u[1].indexOf('%')?'%':'px';parseInt(u[0])!==parseInt(l.value)&&(l.value=parseInt(u[0])),parseInt(u[1])!==parseInt(r.value)&&(r.value=parseInt(u[1])),d.value!==m&&(d.value=m),c.value!==_&&(c.value=_),e.querySelector('.tb_editor_lightbox_actions').classList.remove('tf_hide')}}e.addEventListener('focusout',W,{passive:!0}),e.addEventListener('change',W,{passive:!0}),e.querySelector('#tb_editor_link_type').addEventListener('change',function(t){const e=this.closest('form').querySelector('.tb_editor_lightbox_actions');e.classList.toggle('tf_hide','lightbox'!==this.value),A(),v(),w(!0)},{passive:!0}),p.appendChild(Z()),p.appendChild(e),g.classList.add('tf_hide','tb_editor_dialog_open','tb_editor_dialog_link','tf_opacity'),e.classList.remove('tf_hide'),A(),v(),w(!0),setTimeout(function(){i.focus()},100)}},font:{state(t){B.queryCommandValue('fontName')},result(t){const e=B.createElement('span');let i=B.createDocumentFragment(),s=B.queryCommandValue('fontName');e.className='themify_tooltip',e.textContent='themify_tooltip',i.appendChild(ThemifyConstructor.font_select.render({id:'',control:!1},ThemifyConstructor)),i=i.firstChild,g.classList.add('tf_hide','tb_editor_dialog_open','tb_editor_dialog_font','tf_opacity'),tt(i);const o=i.getElementsByClassName('font-family-select')[0];if(q.triggerEvent(o.closest('.tb_font_preview_wrapper'),'tf_init'),o.addEventListener('change',function(t){t.stopPropagation(),c=!0,A(),f('styleWithCSS',!0),f('fontName',this.value||'inherit'),setTimeout(function(){Y(),c=!1},10)},{passive:!0}),A(),v(),w(!0),s&&(s=s.replace(/["']/g,''),o.querySelector('[value="'+CSS.escape(s)+'"]'))){o.value=s,i.getElementsByClassName('themify-combo-input')[0].value=s;const a=i.getElementsByClassName('themify-combo-dropdown')[0],n=a.querySelector('[data-value="'+CSS.escape(s)+'"]');n&&(n.classList.add('themify-combo-selected'),a.style.scrollBehavior='auto',a.scrollTop=n.offsetTop-n.offsetHeight,a.style.scrollBehavior='')}}},unlink:{result(t){A();const e=h?h.startContainer.parentNode.closest('a'):null;if(e&&e===h.endContainer.parentNode.closest('a')){const i=B.createRange(),s=k.getSelection();i.selectNodeContents(e),s.removeAllRanges(),s.addRange(i)}f('unlink'),Y()}},unlinkBack:{result(t){o.unlink.result(t),et()}},color:{result(t){const e=B.createElement('span'),i=function(t){c=!0,A(),f('styleWithCSS',!0),f('foreColor',t),setTimeout(function(){Y(),c=!1},10)};let s=B.createDocumentFragment(),o=B.queryCommandValue('foreColor');e.className='themify_tooltip',e.textContent='themify_tooltip',s.appendChild(ThemifyConstructor.color.render({id:'',control:!1},ThemifyConstructor)),s=s.firstChild,g.classList.add('tf_hide','tb_editor_dialog_open','tb_editor_dialog_color','tf_opacity'),tt(s);const a=s.getElementsByClassName('tfminicolors-input')[0],n=s.getElementsByClassName('tfminicolors-swatch')[0],l=s.getElementsByClassName('color_opacity')[0];if(o){let t=1;if(-1<o.indexOf('rgb')){t=-1<o.indexOf('rgba')?parseFloat(o.split(',').slice(-1).pop()):1;const r=o.match(/^rgba?[\s+]?\([\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?/i);o=r&&4===r.length?"#"+("0"+parseInt(r[1],10).toString(16)).slice(-2)+("0"+parseInt(r[2],10).toString(16)).slice(-2)+("0"+parseInt(r[3],10).toString(16)).slice(-2):''}a.value=o,l.value=t}n.click(),a.addEventListener('themify_builder_color_picker_change',function(t){t.stopPropagation(),'tb_editor_dialog_content'!==B.activeElement.id&&p.contains(B.activeElement)||i(t.detail.val)},{passive:!0}),a.addEventListener('change',function(t){t.stopPropagation(),i($(this).tfminicolors('rgbaString'))},{passive:!0}),l.addEventListener('change',function(t){P=!0,t.stopPropagation(),q.triggerEvent(a,'change')},{passive:!0}),v(),w(!0)}}},X=function(d){if(R&&P){const c=M.Models.Registry.lookup(C),u=!(!M.activeModel||C!==M.activeModel.cid);if(c){let i=u?{}:c.get('mod_settings'),e=$.extend(!0,{},i),s,o,a=!1,t=!d&&F,n=R,l;if(i=i||{},t){if(s=n.getAttribute('data-w'),o=n.getAttribute('data-h'),!s&&!o){if(!(n=n.closest('[data-hasEditor]')))return;t=!1,E=!0}if(t){let t=!1;if(s&&(i[s]=n.getAttribute('width'),t=parseInt(e[s])!==parseInt(i[s])),o&&(i[o]=n.getAttribute('height'),!0!==t&&(t=parseInt(e[o])!==parseInt(i[o]))),!t)return}}let r=n.getAttribute('data-repeat');r&&!isNaN(r)&&(r=!1);const m=n.getAttribute('data-name');if(r){if(void 0===i[r]&&(i[r]={}),!1===(a=!!n.hasAttribute('data-index')&&parseInt(n.getAttribute('data-index')))){let e=n.closest('.tf_swiper-slide');if(e=e||n.closest('li')||n.closest('.module-'+c.get('mod_name')+'-item')){const _=e.parentNode.children;for(let t=_.length-1;-1<t;--t)if(_[t]===e){a=t;break}}}if(!1===a)return;void 0===i[r][a]&&(i[r][a]={})}if(!t){if(!m)return;let t;if(l='IMG'===n.tagName?n.hasAttribute('data-orig')?n.getAttribute('data-orig'):n.getAttribute('src'):E?n.innerHTML:n.innerText,!1!==a?(t=void 0!==e[r]&&void 0!==e[r][a]&&void 0!==e[r][a][m]?e[r][a][m]:null,i[r][a][m]=l):(t=e[m],i[m]=l),t===l)return}if(e!==i){if(u){const g=y.Lightbox.$lightbox[0];if(t){let t=!1;const p=s?g.querySelector('.tb_lb_option#'+s):null,b=o?g.querySelector('.tb_lb_option#'+o):null;if(p&&p.value!=i[s]&&(t=!0,p.value=ThemifyConstructor.settings[s]=i[s]),b&&b.value!=i[o]&&(t=!0,b.value=ThemifyConstructor.settings[o]=i[o]),!1===t)return}else{r?(void 0===ThemifyConstructor.settings[r]&&(ThemifyConstructor.settings[r]={}),void 0===ThemifyConstructor.settings[r][a]&&(ThemifyConstructor.settings[r][a]={}),ThemifyConstructor.settings[r][a][m]=l):ThemifyConstructor.settings[m]=l;const h={el:'',val:l,data:i,cid:C,activeEl:R};q.triggerEvent(B,'tb_inline_item',h),l=h.val,i=h.data;let e=h.el;if(e=e||(r?g.querySelector('#'+r).querySelectorAll('[data-input-id="'+m+'"]'):g.querySelector('.tb_lb_option#'+m))){if(r&&!(e=e[a]))return;if(e.value===l)return;if(e.value=l,F){let t=e.closest('.tb_uploader_wrapper');(t=t&&t.querySelector('.tb_media_uploader img'))&&(t.src=l)}if(E&&'undefined'!=typeof tinyMCE&&tinyMCE){const f=tinyMCE.get(e.id);f&&f.setContent(l)}}}M.hasChanged=!0}else{const v={val:t?i[m]:l,data:i,cid:C,activeEl:R};q.triggerEvent(B,'tb_inline_save',v),l=v.val,i=v.data,!1!==a?i[r][a][m]=l:i[m]=l,M.hasChanged=!0,L&&(M.undoManager.push(C,L,y.clone(n.closest('.active_module')),'save',{bsettings:e,asettings:$.extend(!0,{},i)}),L=null),c.set(i,{silent:!0})}at()}}}},V=function(t){t.preventDefault()},G=function(t){t.stopImmediatePropagation(),F&&(R.hasAttribute('data-name')||R.closest('[data-hasEditor]'))&&(t.target===b||b.contains(t.target))&&o.image.result()},i=function(){M.Instances.Builder[M.builderIndex].el.addEventListener(U.mousedown,function(t){if(!0===M.ActionBar.inlineEditor&&(1===t.which||t.touches)){const i=(F='IMG'===t.target.tagName)?t.target:t.target.closest('[contenteditable]');if(i&&!i.closest('.tb_disable_sorting')&&(F||!1===i.contentEditable||'false'===i.contentEditable)){x(),k.getSelection().removeAllRanges();const s=i.closest('.active_module');if(s){const o=M.Models.Registry.lookup(s.dataset.cid);if(o&&void 0!==o.attributes.mod_settings.__dc__&&void 0!==o.attributes.mod_settings.__dc__[i.dataset.name])return!1;s.classList.add('tb_editor_clicked')}F||(i.contentEditable=!0);let e=[],t=i.closest('[draggable]');for(;null!==t;)e.push(t),t=t.parentNode.closest('[draggable]');if(0<e.length){const a=function(t){B.removeEventListener(U.mousemove,n,{passive:!0,once:!0});for(let t=e.length-1;-1<t;--t)e[t].setAttribute('draggable',!1),e[t].removeEventListener('drag',n,{passive:!0,once:!0})},n=function(t){i.setAttribute('contenteditable',!1),B.removeEventListener(U.mousemove,n,{passive:!0,once:!0}),i.removeEventListener(U.mouseup,a,{passive:!0,once:!0}),s&&s.classList.remove('tb_editor_clicked');for(let t=e.length-1;-1<t;--t)e[t].removeEventListener('drag',n,{passive:!0,once:!0});nt(),'drag'===t.type&&N()};i.addEventListener(U.mouseup,a,{passive:!0,once:!0}),B.addEventListener(U.mousemove,n,{passive:!0,once:!0});for(let t=e.length-1;-1<t;--t)e[t].addEventListener('drag',n,{passive:!0,once:!0})}}}},{passive:!0}),M.Instances.Builder[M.builderIndex].el.addEventListener(H.mousedown,function(t){if(!0===M.ActionBar.inlineEditor){let e=t.target;if(e.hasAttribute('data-target')){let t=e.closest('.active_module');(t=t&&t.querySelector(e.getAttribute('data-target')))&&(e=t)}const s=(F='IMG'===e.tagName)?e:e.closest('[contentEditable]');if(s&&((s.closest('label')||s.closest('a')||s.closest('button'))&&t.preventDefault(),R!==s&&(R&&N(),(1===t.which||t.touches)&&(!F||s.getAttribute('data-w')||s.getAttribute('data-h')||s.getAttribute('data-name')||s.closest('[data-hasEditor]'))))){const o=s.closest('.active_module');if(o){C=o.getAttribute('data-cid');const a=M.Models.Registry.lookup(C);if(a&&void 0!==a.attributes.mod_settings.__dc__&&void 0!==a.attributes.mod_settings.__dc__[s.dataset.name])return}P=!1,z=q.body[0].classList,x(),z.add('tb_editor_active'),k.top.document.body.classList.add('tb_editor_active'),E=!F&&s.hasAttribute('data-hasEditor'),R=s,o&&(L=o.outerHTML,o.classList.add('tb_editor_on'),o.classList.remove('tb_editor_clicked'));let t=R,e=s.closest('form'),i=s.closest('[draggable]');if(e){e.addEventListener('submit',V);const n=e.querySelectorAll('[required]');for(let t=n.length-1;-1<t;--t)n[t].removeAttribute('required'),n[t].setAttribute('data-required',1)}for(;t&&t!==o;)t.style['animation-name']&&(t.setAttribute('data-tmp-animation',t.style['animation-name']),t.style['animation-name']='none'),t=t.parentNode;for(;null!==i;)i.setAttribute('draggable',!1),i=i.parentNode.closest('[draggable]');if(t=i=e=null,(u=(u=R.closest('.tf_swiper-container'))&&u.swiper?u.swiper:null)&&u.params&&u.params.autoplay&&u.params.autoplay.enabled&&(u.el.dataset.stopped=!0,u.autoplay.stop(),u.params.thumbs&&u.params.thumbs.swiper&&u.params.thumbs.swiper.autoplay&&u.params.thumbs.swiper.autoplay.enabled&&(u.params.thumbs.swiper.el.dataset.stopped=!0,u.params.thumbs.swiper.autoplay.stop())),F?(z.add('tb_editor_image_active'),k.top.document.body.classList.add('tb_editor_image_active'),q.on('tfsmartresize',O).on('tbresizeImageEditor',O)):(m=E?R.innerHTML:R.textContent,R.contentEditable=!0,R.focus(),R.addEventListener('blur',N,{passive:!0}),R.addEventListener('input',_,{passive:!0}),R.addEventListener('change',_,{passive:!0}),q.isTouch||setTimeout(function(){o&&o.addEventListener('dblclick',G,{passive:!0})},800),r=M.undoManager.stack,M.undoManager.reset()),q.on('tbDisableInline',N),B.addEventListener(U.mousedown,N,{passive:!0}),k.top.document.addEventListener(U.mousedown,N,{passive:!0}),setTimeout(function(){y.Lightbox.$lightbox.one('themify_opened_lightbox',it)},600),E){if(B.addEventListener('selectionchange',K,{passive:!0}),null===g){const l=B.getElementById('tmpl-builder_inline_editor');l&&(B.body.appendChild(l.content),l.remove()),g=B.getElementById('tb_editor')}g,v(),g.addEventListener(H.mousedown,J),d=g.querySelector('#tb_editor_link_value'),p=g.querySelector('#tb_editor_dialog')}else F&&(s.closest('.masonry')?q.requestIdleCallback(function(){setTimeout(function(){requestAnimationFrame(function(){st(s)})},25)},500):st(s))}}})},v=function(){const t=g.className,e=g.classList,i=(e.add('tf_hidden'),e.remove('tf_hide'),g.getBoundingClientRect());n=i.width+40,S=i.height+30,g.className=t},Y=function(){const t=k.getSelection();h=!1===t.isCollapsed?t.getRangeAt(0).cloneRange():null},A=function(){if(!1===e&&h){e=!0,R.focus();const t=k.getSelection();t.removeAllRanges(),t.addRange(h),e=!1}},J=function(e){const i=e.target.closest('.tb_editor_action');if(e.stopPropagation(),i&&'submit'!==i.type){e.preventDefault(),c=!0;let t=i.getAttribute('data-type');if('expand'!==(t=t||i.closest('[data-type]').getAttribute('data-type')))void 0!==o[t]&&void 0!==o[t].result?o[t].result(i):(A(),f(t)),Q();else if(!i.classList.contains('tb_editor_disable')){const s=M.Models.Registry.lookup(C);s&&(N(),k.getSelection().removeAllRanges(),s.trigger('edit',null))}c=!1}},_=function(t){if(t&&t.stopPropagation(),R){P=!0;const e=E?R.innerHTML:R.textContent;m===e&&!F||(M.hasChanged=!0,M.activeModel&&M.activeModel.cid===C&&X(),t&&'input'!==t.type||M.undoManager.push(C,m,e,'inline',R),m=e)}},W=function(t){if(t.stopPropagation(),!('focusout'===t.type&&!t.target.classList.contains('tb_range')||'change'===t.type&&t.target.classList.contains('tb_range'))){const e=this.getElementsByClassName('tb_editor_link_input')[0],i=e.value.trim();if(i){P=!0,A();let t=k.getSelection();const s=h?h.startContainer.parentNode.closest('a'):null,o=this,a=o.querySelector('#tb_editor_link_type').value;if(s&&s===h.endContainer.parentNode.closest('a')){const n=B.createRange();n.selectNodeContents(s),t.removeAllRanges(),t.addRange(n)}if(f('createLink',i),Y(),t.anchorNode&&t.anchorNode.parentNode){const l=t.anchorNode.parentNode.closest('a');if(l)if(l.removeAttribute('target'),l.removeAttribute('data-zoom-config'),l.classList.remove('themify_lightbox'),'_blank'===a)l.setAttribute('target',a);else if('lightbox'===a){l.classList.add('themify_lightbox');const r=o.querySelector('#tb_editor_lb_w').value,d=o.querySelector('#tb_editor_lb_h').value,c=o.querySelector('#tb_editor_lb_w_unit').value||'px',u=o.querySelector('#tb_editor_lb_h_unit').value||'px';if(0<r||0<d){let t='|';r&&(t=r+c+t),d&&(t+=d+u),l.setAttribute('data-zoom-config',t)}}}_()}}},j=function(t){const e=t.parentNode,i=e.parentNode.closest('li');if(e.classList.add('tb_editor_selected'),i){i.classList.add('tb_editor_selected');const s=i.getElementsByClassName('tb_editor_action')[0];void 0!==s&&s.parentNode.replaceChild(t.cloneNode(!0),s)}},Q=function(){for(let s=(l=null===l?g.querySelectorAll('[data-type]'):l).length-1;-1<s;--s){let t=l[s],e=t.getAttribute('data-type'),i='LI'===t.tagName?t:t.parentNode;'expand'===e?i.classList.toggle('tb_editor_disable',M.activeModel&&C===M.activeModel.cid):e&&(void 0!==o[e]&&void 0!==o[e].state?o[e].state(i):i.classList.toggle('tb_editor_selected',D(e)))}},w=function(s){if(null!==g){const t=k.getSelection(),o=g.classList;if(!1===t.isCollapsed){Y(),o.contains('tf_hide')&&(v(),o.remove('tf_hide'),setTimeout(function(){o.remove('tf_opacity')},20));let t=h.getBoundingClientRect(),e=t.left+(t.width-n)/2,i=t.top-S-10;e+n>=q.w&&(e-=n+Math.ceil(e)+k.pageXOffset-q.w-1),o.toggle('tb_editor_top_viewport',i<=0),i<=0&&(i=t.bottom+10),e<=0&&(e=15),i+=k.pageYOffset,g.style.transform='translate('+e+'px,'+i+'px)',void 0===s&&Q(),z&&(z.contains('tb_editor_start_select')||(k.top.document.body.classList.add('tb_editor_start_select'),z.add('tb_editor_start_select')),a&&clearTimeout(a),a=setTimeout(x,500))}else h=null,o.add('tf_hide','tf_opacity'),o.remove('tb_editor_top_viewport'),et()}},K=function(){null!==R&&!1===e&&!1===c&&B.activeElement===R&&(I&&cancelAnimationFrame(I),t&&clearTimeout(t),I=requestAnimationFrame(function(){t=setTimeout(function(){null!==R&&!1===e&&!1===c&&B.activeElement===R&&w()},20)}))},x=function(t){z&&z.contains('tb_editor_start_select')&&(k.top.document.body.classList.remove('tb_editor_start_select'),z.remove('tb_editor_start_select')),a&&clearTimeout(a),a=null},Z=function(){const t=B.createElement('button');return t.type='button',t.className='tf_close',t.title='Back',t.addEventListener(H.mousedown,function(t){t.stopImmediatePropagation(),t.preventDefault(),et(),g.classList.add('tf_hide','tf_opacity'),A(),v(),w()},{once:!0}),t},tt=function(t){const e=B.createElement('div'),i=B.createElement('div');e.id='tb_editor_dialog_header',i.id='tb_editor_dialog_content',i.tabIndex='-1',e.appendChild(Z()),i.appendChild(t),p.appendChild(e),p.appendChild(i)},et=function(){if(g){if(g.style.display='none',p&&p.firstChild)for(;p.firstChild;)p.removeChild(p.lastChild);g.classList.remove('tb_editor_dialog_open','tb_editor_dialog_color','tb_editor_dialog_font','tb_editor_dialog_link','tb_editor_show_link'),g.style.display='',v()}},it=function(t){R&&N()},st=function(t){nt(),b=B.createElement('div');const e=t.getBoundingClientRect(),i=(R.dataset.orig||R.src).trim(),s=0!==i.indexOf(themifyBuilder.upload_url)?themifyBuilder.i18n.image_help:null!==R.closest('[data-hasEditor]')&&themifyBuilder.i18n.image_help2,o=['w','s','e','n'];b.id='tb_editor_image',b.style.top=e.top+k.scrollY+'px',b.style.left=e.left+k.scrollX+'px',b.style.width=e.width+'px',b.style.height=e.height+'px';for(let s=o.length-1;-1<s;--s){let t=B.createElement('div'),e=B.createElement('div'),i=B.createElement('div');t.className='tb_editor_image_handler tb_editor_'+o[s],e.className='tb_editor_image_border tb_editor_border_'+o[s],i.className='tb_image_editor_tooltip tb_image_editor_tooltip_'+o[s],b.appendChild(e),b.appendChild(i),b.appendChild(t)}t.hasAttribute('data-w')||t.hasAttribute('data-h')?!1!==s&&b.appendChild(ThemifyConstructor.help(s)):b.className='tb_image_editor_disable',b.addEventListener(U.mousedown,ot,{passive:!0}),q.isTouch||b.addEventListener('dblclick',G,{passive:!0}),R.classList.add('tb_selected_img'),q.body[0].appendChild(b)},ot=function(e){if(1===e.which||e.touches){const o=e.target;if(e.stopPropagation(),(R.hasAttribute('data-w')||R.hasAttribute('data-h'))&&(o.classList.contains('tb_editor_image_handler')||o.classList.contains('tb_editor_image_border'))){this.style.willChange='width,height,left,top',R.parentNode.style.willChange='contents',R.style.willChange='width,height';let r,d,i,s,c,u,m,_=new Image,t=R.getAttribute('data-maxw'),g=!1;t=(t=(t=t&&R.closest(t))||R.closest('[data-hasEditor]'))||R.parentNode;const a=o.classList[1].replace('tb_editor_border_','').replace('tb_editor_',''),n=o.classList.contains('tb_editor_image_handler'),p=this,l=40,b=40,h=Number.MAX_VALUE,f=R.getBoundingClientRect(),v=parseInt(f.width),y=parseInt(f.height),C=parseFloat(v/y),L=(e.touches?e.touches[0]:e).clientX,E=(e.touches?e.touches[0]:e).clientY,A=p.getElementsByClassName('tb_image_editor_tooltip'),w=(R.dataset.orig||R.src).trim(),x=0===w.indexOf(themifyBuilder.upload_url)&&!R.closest('[data-hasEditor]'),N=!0===x?B.createElement('div'):null,S=function(t){t.stopPropagation(),i=(t.touches?t.touches[0]:t).clientX,s=(t.touches?t.touches[0]:t).clientY,!1===g?(g=!0,R.classList.add('tb_resized_img')):r&&cancelAnimationFrame(r),r=requestAnimationFrame(function(){if(null===R)T();else{let t,e;!0===n?(t='n'===a||'s'===a?L+v-i:v+i-L,e=parseInt(t/C)):'s'===a||'n'===a?(e='s'===a?y+s-E:E+y-s,t=v):(t='w'===a?v+i-L:L+v-i,e=y),t<l?t=l:t>h&&(t=h),void 0!==e&&e<b&&(e=b),c===t&&u===e||(c=t,u=e,M.Utils.resizeImage(R,t,e,_).then(function(t){if(null===t[0]||null===R)T();else{const e=!1===x?t[0].parentNode:null,i=(null!==e&&'FIGURE'===e.tagName&&(e.style.width&&(e.style.width=t[1]+'px'),e.style.height&&(e.style.height=t[2]+'px')),t[0].getBoundingClientRect());p.style.left=i.left+k.scrollX+'px',p.style.top=i.top+k.scrollY+'px',p.style.width=i.width+'px',p.style.height=i.height+'px',A[0].textContent=A[3].textContent=parseInt(t[1])+'px',A[1].textContent=A[2].textContent=parseInt(t[2])+'px',at()}}))}})},I=function(){B.addEventListener(U.mousemove,S,{passive:!0}),p.classList.remove('tb_image_editor_loading'),N&&N.remove()},T=function(t){t&&t.stopPropagation(),r&&cancelAnimationFrame(r),d&&clearTimeout(d),B.removeEventListener(U.mousemove,S,{passive:!0}),B.removeEventListener(U.mouseup,T,{passive:!0,once:!0}),k.top.document.body.classList.remove('tb_start_animate','tb_image_editor_resing');const e=z||q.body[0].classList;if(e.remove('tb_start_animate','tb_image_editor_resing'),q.body[0].style.cursor=k.top.document.body.style.cursor=p.style.willChange=R.style.willChange=R.parentNode.style.willChange='',R.classList.remove('tb_resized_img'),!0===g){P=!0;let e=R.closest('.active_module');e=e||R.closest('.module_column'),X();const i=function(){requestAnimationFrame(function(){_&&(m=q.hash(w+R.getAttribute('width')+R.getAttribute('height')),M.Utils.cache_images[m]=_,_=null),at(),e&&(R.hasAttribute('data-update')&&(e.innerHTML=e.innerHTML,R=F?e.getElementsByClassName('tb_selected_img')[0]:e.querySelector('[contenteditable="true"]')),M.Utils.runJs($(e),'module')),q.trigger('tb_image_resize',R),O(),q.requestIdleCallback(function(){setTimeout(function(){requestAnimationFrame(O)},25)},500),M.Utils.canvas=M.Utils.ctx=null})};if(e){const s=e.querySelectorAll('img[data-w="'+R.getAttribute('data-w')+'"]');if(1<s.length){const o=R.getAttribute('width'),a=R.getAttribute('height'),n=x?B.createElement('div'):null,l=[];n&&(n.className='tf_loader tf_loader_center',e.appendChild(n),e.classList.add('tf_image_editor_working'));for(let t=s.length-1;-1<t;--t)s[t]!==R&&l.push(M.Utils.resizeImage(s[t],o,a));Promise.all(l).then(t=>{n&&n.remove(),e.classList.remove('tf_image_editor_working'),i()})}else i()}else i()}g=!1,r=d=c=u=null};z.add('tb_start_animate','tb_image_editor_resing'),k.top.document.body.classList.add('tb_start_animate','tb_image_editor_resing'),q.body[0].style.cursor=k.top.document.body.style.cursor=getComputedStyle(o).getPropertyValue('cursor'),!0===x?(m=q.hash(w+R.getAttribute('width')+R.getAttribute('height')),void 0!==M.Utils.cache_images[m]?(_=M.Utils.cache_images[m],I()):(N&&(N.className='tf_loader',this.appendChild(N),this.classList.add('tb_image_editor_loading')),_.src=w,_.crossOrigin='anonymous',_.decode().then(I))):I(),B.addEventListener(U.mouseup,T,{passive:!0,once:!0})}}},O=function(){b&&requestAnimationFrame(function(){b&&R&&st(R)})},at=function(){null!==u&&u.update()},nt=function(){b&&(b.removeEventListener(U.mousedown,ot,{passive:!0}),b.removeEventListener('dblclick',G,{passive:!0}),b.remove(),b=null)},N=function(i){if(!T){let e=null;if(i&&(e='blur'===i.type?i.relatedTarget||(y.Lightbox.$lightbox[0].contains(k.top.document.activeElement)?k.top.document:B).activeElement:i.target,!F&&e.closest('.tb_toolbar_undo')))R&&R.removeEventListener('blur',N,{passive:!0}),setTimeout(function(){R&&R.addEventListener('blur',N,{passive:!0}),h=null,et(),R&&R.focus(),w()},120);else if((!i||'blur'===i.type||1===i.which)&&(!i||!g||(i.touches||'blur'===i.type||1===i.which)&&g!==e&&!g.contains(e))){let t=R&&M.Instances.Builder[M.builderIndex].el.contains(R)?R.closest('.module'):M.Instances.Builder[M.builderIndex].el.querySelector('.tb_element_cid_'+C+' .module');if(et(),i&&t&&(t===e||t.contains(e)))i&&'blur'!==i.type&&R&&!1===k.getSelection().isCollapsed&&(z.contains('tb_editor_start_select')||(k.top.document.body.classList.add('tb_editor_start_select'),z.add('tb_editor_start_select')),this.addEventListener(U.mouseup,x,{passive:!0,once:!0}));else{if(B.removeEventListener(U.mousedown,N,{passive:!0}),B.removeEventListener('selectionchange',K,{passive:!0}),B.removeEventListener(U.mouseup,x,{passive:!0,once:!0}),k.top.document.removeEventListener(U.mousedown,N,{passive:!0}),y.Lightbox.$lightbox.off('themify_opened_lightbox',it),x(),r&&(M.undoManager.stack=r,M.undoManager.index=r.length-1,M.undoManager.updateUndoBtns()),R){R.removeEventListener('input',_,{passive:!0}),R.removeEventListener('change',_,{passive:!0}),R.removeEventListener('blur',N,{passive:!0}),'IMG'!==R.tagName&&R.setAttribute('contenteditable','false'),R.classList.remove('tb_selected_img');const s=R.closest('form'),o=[];let t=R.closest('[draggable]');for(;null!==t;)o.push(t),t=t.parentNode.closest('[draggable]');for(let t=o.length-1;-1<t;--t)o[t].setAttribute('draggable',!0);if(s){s.removeEventListener('submit',V);const a=s.querySelectorAll('[data-required]');for(let t=a.length-1;-1<t;--t)a[t].removeAttribute('data-required'),a[t].setAttribute('required','required')}let e=R;for(;e&&e.classList&&!e.classList.contains('active_module');)e.getAttribute('data-tmp-animation')&&(e.style['animation-name']=e.getAttribute('data-tmp-animation'),e.removeAttribute('data-tmp-animation')),e=e.parentNode;e=null}u&&u.params&&u.params.autoplay&&u.params.autoplay.enabled&&(u.el.dataset.stopped=!1,u.autoplay.start(),u.params.thumbs&&u.params.thumbs.swiper.autoplay&&u.params.thumbs.swiper.autoplay.enabled&&(u.params.thumbs.swiper.el.dataset.stopped=!1,u.params.thumbs.swiper.autoplay.start())),g&&(g.classList.add('tf_hide','tf_opacity'),g.classList.remove('tb_editor_top_viewport','tb_editor_show_link'),g.removeEventListener(H.mousedown,J)),i&&k.getSelection().removeAllRanges(),q.off('tfsmartresize',O).off('tbresizeImageEditor',O).off('tbDisableInline',N),nt(),z&&z.remove('tb_editor_active','tb_editor_image_active','tb_editor_start_select'),k.top.document.body.classList.remove('tb_editor_active','tb_editor_image_active','tb_editor_start_select'),M.ActionBar.clear(),(t=t&&t.closest('.active_module'))&&(t.classList.remove('tb_editor_on','tb_editor_clicked'),t.removeEventListener('dblclick',G,{passive:!0}),P&&(X(),R.hasAttribute('data-no-update')||M.Utils.runJs($(t),'module'))),M.ActionBar.hoverCid=L=g=z=E=h=n=S=I=l=p=d=C=r=m=u=R=null}}}};q.is_builder_loaded?i():q.on('tb_css_visual_modules_load',i,!0),q.on('undo',function(t,e,i,s){'inline'!==e&&N()}).on('disableInline',function(){N()})}(Themify,jQuery,window,document,tb_app,ThemifyBuilderCommon);