var tb_app;!function($,s,D,b,R,O,U){'use strict';void 0===$.fn.themifySerializeObject&&($.fn.themifySerializeObject=function(){const l={};for(let s=this.length-1;-1<s;--s){let i=this[s].type;if(this[s].classList.contains('wp-editor-area')&&'undefined'!=typeof tinyMCE){let e=tinyMCE.get(this[s].id);e&&(this[s].value=e.getContent())}if(''!==this[s].value&&('text'===i||'number'===i||'radio'===i||'checkbox'===i||'textarea'===i||'select-one'===i||'hidden'===i||'email'===i||'select'===i||'select-multiple'===i)&&(this[s].name||this[s].id)){let e=this[s].name||this[s].id,t=this[s].value;'radio'===i||'checkbox'===i?t=this[s].checked&&t:'select-multiple'===i&&(t=$(this[s]).val()),void 0!==l[e]&&'radio'!==i?(l[e].push||(l[e]=[l[e]]),t&&l[e].push(t)):t&&(l[e]=t)}}return l});const j=tb_app={activeModel:null,Models:{},Collections:{},Mixins:{},Views:{Modules:{},Rows:{},SubRows:{},Columns:{}},Forms:{},Constructor:{},Utils:{},Instances:{Builder:{}}};let i={},u=null;j.builderIndex=0,j.mode='default',j.autoSaveCid=null,j.hasChanged=null,j.editing=!1,j.scrollTo=!1,j.eventName=!1,j.beforeEvent=!1,j.saving=!1,j.activeBreakPoint='desktop',j.zoomMeta={isActive:!1,size:100},j.isPreview=!1,j.clearOnModeChange=null,j.Models.Module=s.Model.extend({defaults:{element_id:null,elType:'module',mod_name:'',mod_settings:{}},initialize(){j.Models.Registry.register(this.cid,this);let e=this.get('element_id');e&&1!==i[e]||(e=j.Utils.generateUniqueID(),this.set({element_id:e},{silent:!0})),i[e]=1},toRenderData(){const e=this.get('mod_name');return{icon:j.Utils.getIcon('ti-'+themifyBuilder.modules[e].icon).outerHTML,name:themifyBuilder.modules[e].name,slug:e,element_id:this.get('element_id'),excerpt:this.getExcerpt()}},getExcerpt(e){const t=e||this.get('mod_settings'),i=t.content_text||t.content_box||t.plain_text||'';return this.limitString(i,100)},limitString(e,t){let i='';return''!==e&&(e=this.stripHtml(e).toString(),i=e.length>t?e.substr(0,t):e),i},stripHtml(e){const t=O.createElement('div');return t.innerHTML=e,t.textContent||t.innerText||''},setData(e){j.Utils.clearElementId([e]);const t=j.Views.init_module(e);t.model.trigger('custom:change',t)},backendLivePreview(){$('.tb_element_cid_'+this.cid).find('.module_excerpt').text(this.getExcerpt())},getPreviewSettings(){return Object.assign({cid:this.cid},themifyBuilder.modules[this.get('mod_name')].defaults)},getIDattr(){let e=this.get('element_id');return e||j.Utils.generateUniqueID()}}),j.Models.SubRow=s.Model.extend({defaults:{element_id:null,elType:'subrow',gutter:'gutter-default',column_alignment:themifyBuilder.is_fullSection?'col_align_middle':'col_align_top',column_h:'',desktop_dir:'ltr',tablet_dir:'ltr',tablet_landscape_dir:'ltr',mobile_dir:'ltr',col_mobile:'-auto',col_tablet_landscape:'-auto',col_tablet:'-auto',cols:{},styling:{}},initialize(){j.Models.Registry.register(this.cid,this);let e=this.get('element_id');e&&1!==i[e]||(e=j.Utils.generateUniqueID(),this.set({element_id:e},{silent:!0})),i[e]=1},setData(e){j.Utils.clearElementId([e]);const t=j.Views.init_subrow(e);t.model.trigger('custom:change',t)}}),j.Models.Column=s.Model.extend({defaults:{element_id:null,elType:'column',grid_class:'',component_name:'column',modules:{},styling:{}},initialize(){j.Models.Registry.register(this.cid,this);let e=this.get('element_id');e&&1!==i[e]||(e=j.Utils.generateUniqueID(),this.set({element_id:e},{silent:!0})),i[e]=1},setData(e){j.Utils.clearElementId([e]);const t=j.Views.init_column(e);t.model.trigger('custom:change',t)}}),j.Models.Row=s.Model.extend({defaults:{element_id:null,elType:'row',gutter:'gutter-default',column_alignment:themifyBuilder.is_fullSection?'col_align_middle':'col_align_top',column_h:'',desktop_dir:'ltr',tablet_dir:'ltr',tablet_landscape_dir:'ltr',mobile_dir:'ltr',col_mobile:'-auto',col_tablet_landscape:'-auto',col_tablet:'-auto',cols:{},styling:{}},initialize(){j.Models.Registry.register(this.cid,this);let e=this.get('element_id');e&&1!==i[e]||(e=j.Utils.generateUniqueID(),this.set({element_id:e},{silent:!0})),i[e]=1},setData(e){j.Utils.clearElementId([e]);const t=j.Views.init_row(e);t.model.trigger('custom:change',t)}}),j.Collections.Rows=s.Collection.extend({model:j.Models.Row}),j.Models.Registry={items:{},register(e,t){this.items[e]=t},lookup(e){return this.items[e]||null},remove(e){this.items[e]=null,delete this.items[e]},destroy(){for(let e in this.items)this.items[e].destroy();this.items={}}},j.vent=Object.assign({},s.Events),j.Views.register_module=function(e){'default'!==j.mode&&(this.Modules[j.mode]=this.Modules.default.extend(e))},j.Views.init_module=function(e,t){if(void 0===themifyBuilder.modules[e.mod_name])return!1;!0===t&&void 0===e.mod_settings&&void 0!==themifyBuilder.modules[e.mod_name].defaults&&(e.mod_settings=Object.assign({},themifyBuilder.modules[e.mod_name].defaults));const i=e instanceof j.Models.Module?e:new j.Models.Module(e),s=this.get_module(),l=new s({model:i,type:j.mode});return{model:i,view:l}},j.Views.get_module=function(){return this.Modules[j.mode]},j.Views.unregister_module=function(){'default'!==j.mode&&(this.Modules[j.mode]=null,delete this.Modules[j.mode])},j.Views.module_exists=function(){return this.Modules.hasOwnProperty(j.mode)},j.Views.register_column=function(e){'default'!==j.mode&&(this.Columns[j.mode]=this.Columns.default.extend(e))},j.Views.init_column=function(e){const t=e instanceof j.Models.Column?e:new j.Models.Column(e),i=this.get_column(),s=new i({model:t,type:j.mode});return{model:t,view:s}},j.Views.get_column=function(){return this.Columns[j.mode]},j.Views.unregister_column=function(){'default'!==j.mode&&(this.Columns[j.mode]=null,delete this.Columns[j.mode])},j.Views.column_exists=function(){return this.Columns.hasOwnProperty(j.mode)},j.Views.register_subrow=function(e){'default'!==j.mode&&(this.SubRows[j.mode]=this.SubRows.default.extend(e))},j.Views.init_subrow=function(e){const t=e instanceof j.Models.SubRow?e:new j.Models.SubRow(e),i=this.get_subrow(),s=new i({model:t,type:j.mode});return{model:t,view:s}},j.Views.get_subrow=function(){return this.SubRows[j.mode]},j.Views.unregister_subrow=function(){'default'!==j.mode&&(this.SubRows[j.mode]=null,delete this.SubRows[j.mode])},j.Views.subrow_exists=function(){return this.SubRows.hasOwnProperty(j.mode)},j.Views.register_row=function(e){'default'!==j.mode&&(this.Rows[j.mode]=this.Rows.default.extend(e))},j.Views.init_row=function(e){const t=e.attributes;if(void 0===t||void 0!==t.cols&&(0<Object.keys(t.cols).length||0<t.cols.length)||void 0!==t.styling&&0<Object.keys(t.styling).length){const i=e instanceof j.Models.Row?e:new j.Models.Row(e),s=this.get_row(),l=new s({model:i,type:j.mode});return{model:i,view:l}}return!1},j.Views.get_row=function(){return this.Rows[j.mode]},j.Views.unregister_row=function(){'default'!==j.mode&&(this.Rows[j.mode]=null,delete this.Rows[j.mode])},j.Views.row_exists=function(){return this.Rows.hasOwnProperty(j.mode)},j.Views.BaseElement=s.View.extend({type:'default',initialize(){this.listenTo(this.model,'custom:change',this.modelChange),this.listenTo(this.model,'destroy',this.remove),this.listenTo(this.model,'edit',this.edit),this.listenTo(this.model,'duplicate',this.duplicate),this.listenTo(this.model,'save',this.save),this.listenTo(this.model,'importExport',this.importExport),this.listenTo(this.model,'delete',this.delete),this.listenTo(this.model,'copy',this.copy),this.listenTo(this.model,'visibility',this.visibility),this.listenTo(this.model,'paste',this.paste),this.listenTo(this.model,'change:view',this.setView)},setView(e){this.setElement(e)},modelChange(){this.$el.attr(Object.assign({},_.result(this,'attributes')));let e=this.render(),t=j.beforeEvent.data('cid'),i=O.getElementsByClassName('tb_element_cid_'+t)[0];i.parentNode.replaceChild(e.el,i),'visual'===j.mode?this.model.trigger('visual:change'):('row'===j.eventName&&(t=this.$el.data('cid')),j.undoManager.push(t,j.beforeEvent,this.$el,j.eventName),j.Utils.runJs(this.$el))},remove(){this.$el.remove()},visibility(e,t){const i='module'===this.model.get('elType')?'mod_settings':'styling',s=this.model.get(i),l=t.name,o=(!0===t.checked?delete s[l]:s[l]=t.value,{});o[i]=s,this.model.set(o,{silent:!0})},copy(e,t){const i=this.$el,s=this.model;let l=s.get('elType');'column'===l&&(l=s.get('component_name')),null!==j.activeModel&&ThemifyConstructor.saveComponent();const o=this.getData(i,l);if(Object.keys(j.GS.styles).length){const n=j.GS.findUsedItems(o);!1!==n&&n.length&&(o.attached_gs=n)}j.Utils.clearElementId([o]),'sub-column'===l&&(l='column'),U.Clipboard.set(l,o)},paste(e,t,i){let s=this.$el,l=this.model,o=l.get('elType'),n=null;'column'===o?o=l.get('component_name'):'module'===o&&(n=l.get('mod_name')),'sub-column'===o&&(o='column');const a='style'===t||null!=t&&t.classList.contains('tb_paste_style');let d=U.Clipboard.get(o);if(!1===a&&!1===d&&'column'===o&&(d=U.Clipboard.get('module'),o='module',n=d.mod_name),!1===d||!0===a&&'module'===o&&n!==d.mod_name)!0!==i&&U.alertWrongPaste();else{if(j.eventName='row',!0===a){const r=ThemifyStyles.getStyleOptions('module'===o?n:o),c='module'===o?'mod_settings':'styling',u=this.getData(s,'column'===o?l.get('component_name'):o);void 0===u[c]&&(u[c]={});for(let e in d[c])void 0!==r[e]||function(e){if(-1!==e.indexOf('breakpoint_')||-1!==e.indexOf('_apply_all'))return 1;let t=-1!==e.indexOf('_color')?'color':-1!==e.indexOf('_style')&&'style';if(!1!==t){if(t=e.replace('_'+t,'_width'),void 0!==r[t]&&'border'===r[t].type)return 1}else if(-1!==e.indexOf('_unit')){if(t=e.replace(/_unit$/gi,'',''),void 0!==r[t])return 1}else if(-1!==e.indexOf('_w')){if(t=e.replace(/_w$/gi,'',''),void 0!==r[t]&&'font_select'===r[t].type)return 1}else if(void 0!==r[e]&&'radio'===r[e].type)return 1}(e)?(u[c][e]=d[c][e],void 0!==r[e]&&(!0===r[e].isFontColor&&void 0!==d[c][r[e].g+'-gradient']?u[c][r[e].g+'-gradient']=d[c][r[e].g+'-gradient']:(void 0!==r[e].posId&&void 0!==d[c][r[e].posId]&&(u[c][r[e].posId]=d[c][r[e].posId]),void 0!==r[e].repeatId&&void 0!==d[c][r[e].repeatId]&&(u[c][r[e].repeatId]=d[c][r[e].repeatId])))):delete d[c][e];void 0!==d.used_gs&&(u.used_gs=d.used_gs),delete(d=u).element_id}if('column'===o){d.grid_class=j.Utils.filterClass(s.prop('class')),(s.hasClass('first')||s.hasClass('last'))&&(d.grid_class+=s.hasClass('first')?' first':' last');const _=s[0].style.width;d.grid_width=_?_.replace('%',''):null,d.component_name=l.get('component_name')}if(!1===a&&j.Utils.clearElementId([d]),!(j.hasChanged=!0)===a&&'module'===o&&'column'===l.get('elType')){const m=j.Views.init_module({mod_name:n},!0),h=m.view.render().$el;s[0].getElementsByClassName('tb_holder')[0].appendChild(h[0]),l=m.model,s=h}j.beforeEvent=U.clone(s),l.setData(d),null!==j.activeModel&&U.Lightbox.close()}},importExport(e,t){const i=t.classList.contains('tb_import')?'import':'export',o=this,d=this.$el,r=this.model;let c=r.get('elType');const s=(c='column'===c?r.get('component_name'):c).charAt(0).toUpperCase()+c.slice(1),l='subrow'===c?'Sub-Row':'sub-column'===c?'Sub-Column':s,n={contructor:!0,loadMethod:'html',data:{component_form:{name:ThemifyConstructor.label[i+'_tab'].replace('%s',s),options:[{id:'tb_data_field',type:'textarea',label:ThemifyConstructor.label.import_label.replace('%s',l),help:ThemifyConstructor.label[i+'_data'].replace('%s',s),class:'fullwidth',rows:13,readonly:'export'==i?1:0}]}}};'import'==i&&(n.save={}),U.Lightbox.$lightbox[0].style.display='none',U.Lightbox.open(n,function(){R.document.body.classList.add('tb_standalone_lightbox')},function(){const a=this.$lightbox;if(a.addClass('tb_import_export_lightbox'),this.setStandAlone(e.clientX,e.clientY),'import'==i)a.find('.builder_save_button').on('click.tb_import',function(e){e.preventDefault(),e.stopPropagation();let t=a.find('#tb_data_field').val();if(''===t)U.Lightbox.close();else{const i=JSON.parse(t);if(('column'===c&&'sub-column'===i.component_name||'sub-column'===c&&'column'===i.component_name)&&(i.component_name=c),i.component_name&&i.component_name===c){if('column'===c||'sub-column'===c){const l=d[0].closest('.module_column'),o=l.style.width,n=l.classList;i.grid_class=j.Utils.filterClass(l.className),(n.contains('first')||n.contains('last'))&&(i.grid_class+=n.contains('first')?' first':' last'),i.grid_width=o?o.replace('%',''):null}j.eventName='row',j.hasChanged=!0,j.beforeEvent=U.clone(d);const s=function(e){e=j.Utils.clear(e),r.setData(e),U.Lightbox.close()};void 0!==i.used_gs?j.GS.setImport(i.used_gs,s,i):s(i)}else U.alertWrongPaste()}});else{let e=o.getData(d,c);e.component_name=c;const s=j.GS.findUsedItems(e);if(!1!==s){const l={};for(let i=s.length-1;-1<i;--i){let e=j.GS.styles[s[i]],t=$.extend(!0,{},e.data[0]);void 0!==(t='row'===e.type||'subrow'===e.type?t.styling:void 0!==t.cols?(t=t.cols[0])&&('column'===e.type?t.styling:void 0!==t.modules?t.modules[0].mod_settings:void 0):void 0)&&0<Object.keys(t).length&&(l[s[i]]={title:e.title,type:e.type,data:j.Utils.clear(t,!1)})}Object.keys(l).length&&(e.used_gs=l)}e=JSON.stringify(e),a.find('#tb_data_field').val(e).on('click',function(){$(this).trigger('focus').trigger('select')})}D.body.one('themify_builder_lightbox_close',function(){a.removeClass('tb_import_export_lightbox'),R.document.body.classList.remove('tb_standalone_lightbox'),'import'==i&&a.find('.builder_save_button').off('click.tb_import')})})},getData(e,t){let i={};switch(t){case'row':case'subrow':const s='row'===t?'module_row':'active_subrow';i=j.Utils._getRowSettings(e.closest('.'+s)[0],t);break;case'module':i=j.Models.Registry.lookup(e.closest('.active_module').data('cid')).attributes;break;case'column':case'sub-column':const l=e.closest('.module_column'),o=l.closest('column'===t?'.module_row':'.active_subrow'),n=j.Utils._getRowSettings(o[0],'column'===t?'row':'subrow');i=n.cols[l.index()];break}return j.Utils.clear(i)},duplicate(e,t){const i=this.$el,s=U.clone(i),l=(null!==j.activeModel&&U.Lightbox.$lightbox.is(':visible')&&ThemifyConstructor.saveComponent(),i.removeClass('tb_element_cid_'+this.model.cid),s.hide().insertAfter(i),this.getData(s,this.model.get('elType')));j.eventName='duplicate',j.beforeEvent=s,j.hasChanged=!0,this.model.setData(l),i.addClass('tb_element_cid_'+this.model.cid)},edit(e,t){if(j.isPreview)return!0;'breadcrumb'!==e?j.ActionBar.breadCrumbsPath.lightbox=null:e=null;let i=j.hasChanged=!1,s=U.Lightbox.$lightbox,l=this.model.get('elType'),o=!1,n='module'===l?this.model.get('mod_name'):l,a=!1;if(null!==e){const d=t?t.classList:e.target,r=d.contains('tb_dragger');if(!0===r&&(!t.hasAttribute('data-v')||''===t.getAttribute('data-v')))return;if('dblclick'===e.type&&this.model.cid!==j.autoSaveCid&&j.ActionBar.clear(),!0===(a=r||d.contains('tb_styling')))this.model.set({styleClicked:!0},{silent:!0}),!0===r&&(o=function(e){const t=d.contains('tb_dragger_padding')?'p':'m',i=ThemifyConstructor.label[t],s=e.getElementsByClassName('tb_style_toggle');for(let e=s.length-1;-1<e;--e)if(s[e].textContent===i){s[e].classList.contains('tb_closed')&&s[e].click(),setTimeout(function(){s[e].closest('.tf_scrollbar').scrollTop=s[e].offsetTop},10);break}});else if(d.contains('tb_visibility_component'))i=!0,this.model.set({visibileClicked:!0},{silent:!0});else{const c=!d.contains('tb_settings')&&(!!['layout-part','overlay-content'].includes(n)||D.body.triggerHandler('tb_edit_'+n,[e,this.el,this.model]));if(!0===c&&'visual'===j.mode&&!j.Forms.LayoutPart.id&&('dblclick'===e.type||d.contains('tb_edit')))return j.activeModel=this.model,void j.Forms.LayoutPart.edit(this.el)}}if(null!==j.activeModel&&null!==j.autoSaveCid&&this.model.cid!==j.autoSaveCid&&ThemifyConstructor.saveComponent(!0),j.activeModel=this.model,j.autoSaveCid===this.model.cid){let e=null;!0===a?(e=s.find('a[href="#tb_options_styling"]'),this.model.unset('styleClicked',{silent:!0})):!0===i?(e=s.find('a[href="#tb_options_visibility"]'),this.model.unset('visibileClicked',{silent:!0})):'module'!==l&&'row'!==l&&'subrow'!==l||(e=s.find('a[href="#tb_options_setting"]')),null!==e&&0<e.length&&(e[0].click(),!1!==o&&!0===a&&o(U.Lightbox.$lightbox[0].querySelector('#tb_lightbox_container')))}else U.Lightbox.open({loadMethod:'inline',templateID:n},!1,o),!1===j.GS.isGSPage&&(j.ActionBar.hideContextMenu(),('row'!==n||'row'===n&&null!==j.ActionBar.breadCrumbsPath.lightbox)&&U.Lightbox.$lightbox[0].getElementsByClassName('tb_action_breadcrumb')[0].appendChild(j.ActionBar.getBreadCrumbs(j.Instances.Builder[j.builderIndex].el.getElementsByClassName('tb_element_cid_'+this.model.cid)[0])))},delete(e,t){let i=this.$el,s=this.model,l=s.cid,o=l,n=s.get('elType'),a=i.closest('.module_row'),d='row',r='',c,u={};if('row'===n?(u.pos_cid=a.next('.module_row'),u.pos='before',0===u.pos_cid.length&&(u.pos='after',u.pos_cid=a.prev('.module_row')),d='delete_row',u.pos_cid=u.pos_cid.data('cid')):l=a.data('cid'),a=U.clone(a),'row'!==n&&(c=i.closest('.active_subrow')),s.destroy(),c&&0<c.length&&0===c.find('.active_module').length&&c.addClass('tb_row_empty'),'row'!==n){const _=(r=$('.tb_element_cid_'+l)).closest('.module_row');0===_.find('.active_module').length&&_.addClass('tb_row_empty')}j.hasChanged=!0,j.undoManager.push(l,a,r,d,u),j.toolbar.pageBreakModule.countModules(),j.activeModel&&j.activeModel.cid===o&&U.Lightbox.$lightbox.find('.tb_close_lightbox')[0].click()},save(i){j.activeModel&&null!==j.autoSaveCid&&ThemifyConstructor.saveComponent(!0);const c=this.model.get('elType'),e={contructor:!0,loadMethod:'html',save:{done:'save'},data:{}},u=this.model.cid;e.data['s'+c]={options:[{id:'item_title_field',type:'text',label:ThemifyConstructor.label.title},{id:'item_layout_save',type:'checkbox',label:'',options:[{name:'layout_part',value:ThemifyConstructor.label.slayout_part}],new_line:!1,after:'',help:'Any changes made to a Layout Part are saved and reflected everywhere else they are being used (<a href="https://themify.me/docs/builder#layout-parts" target="_blank">learn more</a>)'}]},U.Lightbox.$lightbox[0].style.display='none',U.Lightbox.open(e,function(){R.document.body.classList.add('tb_standalone_lightbox')},function(a){const e=this.$lightbox,t=function(t){if('keypress'!==t.type||13===t.keyCode){t.preventDefault(),t.stopPropagation(),U.showLoader('show');const s=j.Models.Registry.lookup(u);let i,e;switch(c){case'row':e=c,i=j.Utils._getRowSettings($('.tb_element_cid_'+u)[0]),j.Utils.clearElementId([i],!0);break;case'module':e=s.get('mod_name'),i={mod_name:e,element_id:j.Utils.generateUniqueID(),mod_settings:s.get('mod_settings')};break}i=j.Utils.clear(i);const l=ThemifyStyles.builder_id,o=$.extend(j.Forms.serialize(a),{action:'tb_save_custom_item',item:JSON.stringify(i),tb_load_nonce:themifyBuilder.tb_load_nonce,postid:l,type:c}),r=o.item_layout_save,n=j.GS.findUsedItems(i);!1!==n&&(o.usedGS=n),$.ajax({type:'POST',url:themifyBuilder.ajaxurl,dataType:'json',data:o,success(e){if('success'===e.status){const t=function(n){if($('#tb_module_panel',R.document).find('.tb_module_panel_search_text').val(''),r){j.hasChanged=!0;const i={mod_name:'layout-part',mod_settings:{selected_layout_part:n.post_name}};delete n.status,0<ThemifyConstructor.layoutPart.data.length&&ThemifyConstructor.layoutPart.data.push(n);let e=$('.tb_element_cid_'+u),t,s,l,o=U.clone(e);if('row'===c){const a=j.Views.init_row({cols:[{grid_class:'col-full first last',element_id:j.Utils.generateUniqueID(),modules:[i]}]});l=a.view.render(),t=j.Models.Registry.lookup(l.$el.find('.active_module').data('cid'))}else t=j.Views.init_module(i),l=t.view.render(),t=t.model;if(e.replaceWith(l.el),'visual'===j.mode){const d=function(e,t,i){-1!==i.data.indexOf('tb_load_module_partial',3)&&($(this).off('ajaxComplete',d),s=j.liveStylingInstance.$liveStyledElmt,'row'===c&&(s=s.closest('.module_row')),j.undoManager.push(l.$el.data('cid'),o,s,'row'))};$(O).ajaxComplete(d),t.trigger('custom:preview:refresh',t.get('mod_settings'))}else s=l.el,j.undoManager.push(l.$el.data('cid'),o,s,'row')}if(!0===j.toolbar.libraryItems.is_init){let i=$('.tb_library_item_list'),s=j.toolbar.libraryItems.template([n]);for(let e=0,t=(i=(i='visual'===j.mode?i.add(j.toolbar.$el.find('.tb_library_item_list')):i).get()).length;e<t;++e)i[e].insertAdjacentHTML('afterbegin',s),i[e].previousElementSibling.getElementsByClassName('current')[0].click()}U.showLoader('hide'),U.Lightbox.close()};r?(ThemifyStyles.builder_id=e.id,j.Utils.saveCss([i],'',e.id).then(function(){ThemifyStyles.builder_id=l,t(e)})):t(e)}else alert(e.msg)}})}};e.addClass('tb_save_module_lightbox'),this.setStandAlone(i.clientX,i.clientY),e.on('click.saveLayout','.builder_save_button',t).on('keypress.saveLayout','input',t),D.body.one('themify_builder_lightbox_close',function(){e.removeClass('tb_save_module_lightbox').off('.saveLayout'),R.document.body.classList.remove('tb_standalone_lightbox')})})}}),j.Views.BaseElement.extend=function(e){const t=this,i=s.View.extend.apply(this,arguments);return i.prototype.events=Object.assign({},this.prototype.events,e.events),i.prototype.initialize=function(){'function'==typeof t.prototype.initialize&&t.prototype.initialize.apply(this,arguments),'function'==typeof e.initialize&&e.initialize.apply(this,arguments)},i},j.Views.Modules.default=j.Views.BaseElement.extend({tagName:'div',attributes(){const e={class:'active_module tb_element_cid_'+this.model.cid,'data-cid':this.model.cid,draggable:!0},t=this.model.get('mod_settings');return'visual'===j.mode&&('hide_all'!==t.visibility_all&&'hide'!==t.visibility_desktop&&'hide'!==t.visibility_tablet&&'hide'!==t.visibility_tablet_landscape&&'hide'!==t.visibility_mobile||(e.class+=' tb_visibility_hidden'),e.class+=' tb_module_front'),void 0!==t.custom_css_id&&''!==t.custom_css_id&&(e.id=t.custom_css_id),e},template:'visual'===j.mode?null:wp.template('builder_module_item'),initialize(){this.listenTo(this.model,'dom:module:unsaved',this.removeUnsaved)},removeUnsaved(){this.model.destroy()},render(){return'visual'!==j.mode&&(this.el.innerHTML=this.template(this.model.toRenderData()),j.Utils.visibilityLabel(this.el,this.model)),this}}),j.Views.Columns.default=j.Views.BaseElement.extend({tagName:'div',attributes(){const e={class:'module_column tb_element_cid_'+this.model.cid+' tb_'+this.model.get('element_id')+' tf_box '+this.model.get('grid_class'),'data-cid':this.model.cid};return this.model.get('grid_width')&&(e.style='width:'+this.model.get('grid_width')+'%'),e.class+='column'!==this.model.get('component_name')?' sub_column':' tb-column',e},render(){const s=this.model.get('modules');if(this.el.innerHTML=U.templateCache.get('tmpl-builder_column_item'),s){const l=this.el.getElementsByClassName('tb_holder')[0];for(let i in s)if(void 0!==s[i]&&null!==s[i]){let e=s[i],t=void 0===e.cols?j.Views.init_module(e):j.Views.init_subrow(e);t&&l.appendChild(t.view.render().el)}'sub-column'===this.model.get('component_name')&&l.classList.add('tb_subrow_holder')}return this}}),j.Views.SubRows.default=j.Views.BaseElement.extend({tagName:'div',attributes(){return{class:'active_module active_subrow tb_element_cid_'+this.model.cid,'data-cid':this.model.cid,draggable:!0}},template:wp.template('builder_subrow_item'),render(){let i=this.model.get('cols'),s=Object.keys(i).length;if(this.el.innerHTML=this.template({element_id:this.model.get('element_id')}),0<s){const l=this.el.getElementsByClassName('subrow_inner')[0];let t=!1;if(6<s){i[5].modules||(i[5].modules=[]);for(let e=s-1;6<e;--e)i[e].modules&&(i[5].modules=i[5].modules.concat(i[e].modules));s=6;for(let e=0;e<s;++e)i[e].grid_class='col6-1';i=i.slice(0,s),this.model.set({cols:i},{silent:!0})}for(let e=0;e<s;++e)void 0!==i[e]&&null!==i[e]&&(i[e].component_name='sub-column',l.appendChild(j.Views.init_column(i[e]).view.render().el),!1===t&&void 0!==i[e].modules&&0<i[e].modules.length&&(t=!0));!1===t&&this.el.classList.add('tb_row_empty')}return j.Utils.selectedGridMenu(this.el,'subrow'),j.Utils.visibilityLabel(this.el,this.model),this}}),j.Views.Rows.default=j.Views.BaseElement.extend({tagName:'div',attributes(){const e=this.model.get('styling'),t={class:'module_row themify_builder_row tb_element_cid_'+this.model.cid+' tf_clearfix tf_box tb_'+this.model.get('element_id'),'data-cid':this.model.cid,draggable:!0};return null!==e&&(void 0!==e.custom_css_row&&''!==e.custom_css_row&&(t.class+=' '+e.custom_css_row),void 0!==e.custom_css_id&&''!==e.custom_css_id&&(t.id=e.custom_css_id),'fullwidth-content'===e.row_width&&(t.class+=' fullwidth')),t},render(){let t=this.model.get('cols'),i=Object.keys(t).length,s=!1;this.el.innerHTML=U.templateCache.get('tmpl-builder_row_item');const l=this.el.getElementsByClassName('row_inner')[0];if(0<i){if(6<i){t[5].modules||(t[5].modules=[]);for(let e=i-1;6<e;--e)t[e].modules&&(t[5].modules=t[5].modules.concat(t[e].modules));i=6;for(let e=0;e<i;++e)t[e].grid_class='col6-1';t=t.slice(0,i),this.model.set({cols:t},{silent:!0})}for(let e=0;e<i;++e)void 0!==t[e]&&null!==t[e]&&(t[e].component_name='column',l.appendChild(j.Views.init_column(t[e]).view.render().el),!1===s&&void 0!==t[e].modules&&(0<t[e].modules.length||'object'==typeof t[e].modules&&0<Object.keys(t[e].modules).length)&&(s=!0))}else j.Utils._addNewColumn({newclass:'col-full',component:'column'},l);return!1===s&&this.el.classList.add('tb_row_empty'),j.Utils.selectedGridMenu(this.el,'row'),j.Utils.visibilityLabel(this.el,this.model),this}}),j.Views.Builder=s.View.extend({type:'default',lastRow:null,events:{'click .tb_import_layout_button':'importLayoutButton'},initialize(){this.$el.off('tb_init tb_new_row').on('tb_init',this.init.bind(this)).on('tb_init',this.newRowAvailable.bind(this))},init(e){'visual'===j.mode&&setTimeout(function(){j.Utils._onResize(!0)},1500);const t=this;setTimeout(function(){j.ActionBar.init(),j.Utils.setCompactMode(t.el.getElementsByClassName('module_column')),t.insertLayoutButton(),'visual'!==j.mode&&j.GS.init()},1e3),i={}},render(){const i=this.collection;j.Utils.clearLastEmptyRow(i.models);for(let t=0,e=i.models.length;t<e;++t){let e=j.Views.init_row(i.models[t]);!1!==e&&this.el.appendChild(e.view.render().el)}return this},insertLayoutButton(){this.removeLayoutButton(),this.lastRowAddBtn();const e=this.el.getElementsByClassName('module_row');if(void 0!==e[0]&&e.length<2&&e[0].classList.contains('tb_row_empty')){const t=O.createElement('a');t.className='tb_import_layout_button',t.href='#',t.textContent=themifyBuilder.i18n.text_import_layout_button,this.el.appendChild(t)}},removeLayoutButton(){const t=this.el.getElementsByClassName('tb_import_layout_button');for(let e=t.length-1;-1<e;--e)t[e].parentNode.removeChild(t[e])},importLayoutButton(e){j.Views.Toolbar.prototype.loadLayout(e)},newRowAvailable(e,t){const i=this.el.children,s=i.length;let l=!0;if(0!==s&&!0!==t)for(let e=s-1;-1<e;--e)if(i[e].classList.contains('module_row')){l=!1;break}if(!0===l){e=e||1;const o=j.Views.init_row(j.Utils.grid(e)[0]).view.render().$el;return o[0].className+=' tb_new_row',this.el.insertBefore(o[0],this.lastRow),j.Utils.setCompactMode(o[0].getElementsByClassName('module_column')),j.Utils.runJs(o,'row'),j.Utils.calculateHeight(),o}},lastRowShowHide(e){this.lastRow&&(e?this.lastRow.classList.remove('hide'):(this.lastRow.classList.remove('expanded'),this.lastRow.classList.add('hide')))},lastRowAddBtn(){if(!0!==j.GS.isGSPage){const e=O.getElementById('tb_add_container'),t=O.createElement('div');null!==e&&e.parentNode.removeChild(e),this.lastRow=O.createElement('div');let s=null;this.lastRow.id='tb_add_container',t.className='tb_last_add_btn',t.textContent='+',this.lastRow.addEventListener('click',function(e){e.preventDefault();const t=e.target,i=t.closest('.tb_row_grid');null!==i?(this.classList.remove('expanded'),j.Mixins.Builder.rowDrop(j.Utils.grid(i.dataset.col),$('<div>').insertBefore(this),!0,!0)):t.classList.contains('tb_add_blocks')?(this.classList.remove('expanded'),j.toolbar.common.show(e,$(this).find('.tb_last_add_btn')),j.toolbar.common.clicked=this.previousElementSibling?$(this.previousElementSibling):null,j.toolbar.common.btn[0].querySelector('[data-target="tb_module_panel_rows_wrap"]').click()):t.classList.contains('tb_last_add_btn')&&(null===s&&(s=!0,this.appendChild(O.getElementById('tmpl-last_row_add_btn').content.cloneNode(!0))),this.classList.add('expanded'))}),this.lastRow.appendChild(t),this.el.appendChild(this.lastRow)}}}),j.Mixins.Builder={before:null,zindex:null,r:null,w:null,h:null,type:null,isFullWidth:null,columnDrag(e,s,t,l){if(s){const o=(s=s instanceof jQuery?s.get():s).length;if(t&&l){const n='gutter-narrow'===l?1.6:'gutter-none'===l?0:3.2,a='gutter-narrow'===t?1.6:'gutter-none'===t?0:3.2;let i=a-n;i=parseFloat(i*(o-1)/o);for(let t=o-1;-1<t;--t){let e=s[t].style.width;e&&(s[t].style.width=parseFloat(e)+i+'%')}}else{for(let e=o-1;-1<e;--e)s[e].style.width='';j.Utils.setCompactMode(s)}}else{e.stopPropagation(),j.ActionBar.clear(),j.ActionBar.disable=!0,j.ActionBar.hoverCid=null;let a,d,r,c,s,u=!1;const _=D.body[0].classList,m=e.target,i=j.Utils.getMouseEvents(),h=m.parentNode,g=m.classList.contains('tb_drag_right')?'w':'e',b=e.clientX,p=O.createElement('div'),f=O.createElement('div'),y=U.clone(h.closest('.module_row')),v=h.parentNode,w=v.classList.contains('direction-rtl'),C=v.offsetWidth,x=(p.className=f.className='tb_grid_drag_tooltip',m.classList.add('tb_drag_grid_current'),h.classList.add('tb_element_clicked'),_.add('tb_start_animate','tb_drag_grid_start'),'w'==g?(p.className+=' tb_grid_drag_right_tooltip',f.className+=' tb_grid_drag_left_tooltip',r=w?h.previousElementSibling:h.nextElementSibling,a=h.offsetWidth,d=a+m.offsetWidth):(p.className+=' tb_grid_drag_left_tooltip',f.className+=' tb_grid_drag_right_tooltip',r=w?h.nextElementSibling:h.previousElementSibling,d=h.offsetWidth,a=d),h.style.willChange=r.style.willChange='width',function(l){l.stopImmediatePropagation(),s&&cancelAnimationFrame(s),s=requestAnimationFrame(function(){u=!0;const e=parseInt(l.clientX)-b,t=d+('e'==g?-e:e),i=parseFloat(100*t/C).toFixed(2);if(5<=i&&i<100){let e=c;e+='w'==g?-(t-a):a-t;const s=parseFloat(100*e/C).toFixed(2);5<s&&s<100&&(r.style.width=e+'px',h.style.width=t+'px',p.textContent=i+'%',f.textContent=s+'%')}})});O.addEventListener(i.mouseup,function(e){e.stopImmediatePropagation(),this.removeEventListener(i.mousemove,x,{passive:!0}),s&&cancelAnimationFrame(s),h.style.willChange=r.style.willChange='',requestAnimationFrame(function(){if(u&&(h.style.width=parseFloat(p.textContent).toFixed(2)+'%'),p.remove(),f.remove(),h.classList.remove('tb_element_clicked'),m.classList.remove('tb_drag_grid_current'),j.ActionBar.disable=null,j.ActionBar.clear(),_.remove('tb_start_animate','tb_drag_grid_start'),u){const t={default:{'col6-1':14,'col5-1':17.44,'col4-1':22.6,'col4-2':48.4,'col2-1':48.4,'col4-3':74.2,'col3-1':31.2,'col3-2':65.6},narrow:{'col6-1':15.33,'col5-1':18.72,'col4-1':23.8,'col4-2':49.2,'col2-1':49.2,'col4-3':74.539,'col3-1':32.266,'col3-2':66.05},none:{'col6-1':16.666,'col5-1':20,'col4-1':25,'col4-2':50,'col2-1':50,'col4-3':75,'col3-1':33.333,'col3-2':66.666}},o=v.children;let e=3.2,s=t.default,l=(v.classList.contains('gutter-narrow')?(s=t.narrow,e/=2):v.classList.contains('gutter-none')&&(s=t.none,e=0),e*(o.length-1));for(let i=o.length-1;-1<i;--i)if(o[i]!==r){let t=o[i].style.width;if(t)t=parseFloat(t);else{let e=j.Utils.filterClass(o[i].className);t=s[e]}l+=t}r.style.width=100-l+'%',j.Utils.setCompactMode([h,r]);const i=$(h.closest('.module_row')),n=!0===j.hasChanged;j.hasChanged=!0,j.undoManager.push(i.data('cid'),y,i,'row'),j.hasChanged=n,D.body.triggerHandler('tb_grid_changed',[i])}u=s=c=r=a=d=null})},{once:!0,passive:!0}),r&&(c=parseInt(r.offsetWidth)-2,m.appendChild(p),m.appendChild(f),O.addEventListener(i.mousemove,x,{passive:!0}))}},updateModuleSort(e){if(!0!==j.GS.isGSPage){const P=this,t=j.Utils.getMouseEvents();let A;e.addEventListener(t.mousedown,function(e){1!==e.which||e.target.closest('.tb_dragger,.tb_disable_sorting,.tb_editor_on')?A=null:(A=e.target).classList.contains('tb_grid_drag')&&P.columnDrag(e)},{passive:!0}),e.addEventListener('dragstart',function(e){let c=e.target&&A?e.target.closest('[draggable]'):null,u=c&&c.classList.contains('module_row');if('visual'===j.mode){if(!e.target||e.target.nodeType===Node.TEXT_NODE||e.target.closest('.tb_editor_on'))return;c&&'desktop'!==j.activeBreakPoint&&c.classList.contains('active_module')&&(c=null)}if((!c||c.classList.contains('tb_grid_drag')||c.classList.contains('tb_dragger')||!A.classList.contains('tb_move')&&A.closest('#'+j.ActionBar.el.id)||!A.classList.contains('tb_move')&&(u||c.classList.contains('active_subrow')))&&(!c||!u||!c.classList.contains('tb-page-break')))return A=null,e.preventDefault(),!1;A=null,e.stopImmediatePropagation();let _=c.classList;u=u||_.contains('tb_page_break_module')||_.contains('predesigned_row')||_.contains('tb_item_row');let n,a,m=null,h=u?'row':_.contains('tb_row_grid')?'column':'module',o=h,g=c.closest('.module_row'),d=D.body[0],r=0,b=0,p,f,i,y=null,v=null,w=j.toolbar.$el,C=j.Instances.Builder[j.builderIndex].el,s=O.createElement('div');w=w.add($('#tb_fixed_bottom_scroll',R.document));const x=u&&_.contains('module_row'),l=function(e){let t=$('body',R.document);if('visual'===j.mode&&(t=t.add(d)),i&&clearInterval(i),w.off('.tb_drag'),!0===e)'row'===o&&'visual'===j.mode&&j.toolbar.$el.find('.tb_zoom[data-zoom="100"]').click(),t.removeClass('tb_start_animate tb_drag_start tb_drag_'+o),w=v=i=y=null;else{let s=1,l=5;'visual'!==j.mode&&((y=(y=j.toolbar.$el.closest('.interface-interface-skeleton__content'))[0]?y:$('.edit-post-layout__content').first())[0]?s/=2:y=null),null===y&&(y='desktop'===j.activeBreakPoint?$('body,html'):$('body,html',R.document)),t.addClass('tb_start_animate tb_drag_start tb_drag_'+o),'row'===o&&'visual'===j.mode&&j.toolbar.$el.find('.tb_zoom[data-zoom="50"]').click(),0<s&&w.on('dragenter.tb_drag',function(){i&&clearInterval(i),l=5,i=setInterval(function(){l<51?l+=5:(clearInterval(i),i=null)},1200),(p=null)!==m&&(m.style.display='none');for(let e=C.querySelectorAll('[data-pos]'),t=e.length-1;-1<t;--t)e[t].removeAttribute('data-pos');!function t(i){if(null===v&&y){v=!0;let e='tb_toolbar'===i||'wpadminbar'===i?'-':'+';e+='='+s*l+'px',y.stop().animate({scrollTop:e},{duration:10,complete(){!0===v&&(v=null,t(i))}})}}(this.id)}).on('dragleave.tb_drag',function(){i&&clearInterval(i),l=5,v=i=null,y.stop()})}},k=function(e){e.dataTransfer.dropEffect=e.dataTransfer.effectAllowed='none',p&&p.removeAttribute('data-pos'),null!==m&&(m.style.display='none')},L=function(t){if(t.preventDefault(),t.stopImmediatePropagation(),n&&(n.style.top=t.clientY-a+'px'),!t.target||null!==v||t.target===d||t.target===c||'module'===h&&t.target.classList.contains('module_row'))k(t);else if((null===m||t.target!==m&&!t.target.classList.contains('tb_sortable_placeholder'))&&(t.dataTransfer.effectAllowed='move',0===r||0===b||10<t.clientY-r||10<r-t.clientY||10<t.clientX-b||10<b-t.clientX||t.target!==p)){r=t.clientY,b=t.clientX;let e=t.target;const i=e.getBoundingClientRect(),s=.5<(r-i.top)/i.height?'bottom':'top';if(e!==w[0]&&e!==w[1]){if(!n){if(e.classList.contains('module_column')){if(!(e=e.getElementsByClassName('tb_holder')[0]))return void k(t)}else e.classList.contains('tb_dragger')&&(e=e.parentNode);if(e.classList.contains('tb_holder')&&0<e.childElementCount&&(e='top'==s&&e.firstChild!==c?e.firstChild:e.lastChild)===c)return void k(t)}if(p&&p!==e){const l='top'==s?e.previousSibling:e.nextElementSibling;if(l===p){const o=l.dataset.pos;if('top'==s&&'bottom'===o||'bottom'==s&&'top'===o)return}p.removeAttribute('data-pos')}e.dataset.pos!==s&&(e.setAttribute('data-pos',s),null!==m&&(m.style.display='',e.classList.contains('tb_holder')?e.appendChild(m):'top'==s?e.before(m):e.after(m))),p=e}}},B=function(e){e.stopImmediatePropagation(),j.ActionBar.clear(),j.ActionBar.disable=!0,j.ActionBar.hoverCid=null,j.toolbar.common.hide(!0),this.classList.add('tb_draggable_item'),l(),n&&(n.style.top=e.clientY+'px')},E=function(e){e.stopImmediatePropagation()},S=function(e){e.target&&(e.preventDefault(),e.stopImmediatePropagation()),j.hasChanged=!0,f=!0,c.classList.remove('tb_draggable_item');let i=!0,t=e.target||e;if(t.classList.contains('module_column')?t=t.querySelector('[data-pos]'):t.classList.contains('tb_dragger')&&(t=t.closest('[draggable]')),(t===m||t.classList.contains('tb_sortable_placeholder'))&&(t=t.closest('.tb_active_builder').querySelector('[data-pos]')).classList.contains('tb_sortable_placeholder')&&(t=t.closest('.tb_holder')),m&&m.remove(),t&&('module'!==h||!t.classList.contains('module_row'))){const s=g?c:c.cloneNode(!0),l=c.closest('.active_subrow'),o=c.closest('.module_row');if(x&&(0===(g=$(c).next('.module_row')).length&&(g=$(c).prev('.module_row'),i=!1),g=g.data('cid')),t.classList.contains('tb_holder'))t.appendChild(s);else{const a='top'===t.getAttribute('data-pos')?t:t.nextElementSibling;t.parentNode.insertBefore(s,a)}const n=$(s);if(u){if('visual'===j.mode){const d='desktop'===j.activeBreakPoint?$('html,body'):$('body',R.document);d.scrollTop($(c).offset().top)}if(x){let e=$(c).next('.module_row'),t=!0;0===e.length&&(e=$(c).prev('.module_row'),i=t=!1),e=e.data('cid'),j.undoManager.push(c.dataset.cid,null,null,'row_sort',{bnext:i,before:g,anext:t,after:e})}else(_.contains('predesigned_row')||_.contains('tb_page_break_module')||'row'===c.dataset.type)&&('row'===c.dataset.type?j.toolbar.libraryItems.get(c.dataset.id,'row',function(e){if(!Array.isArray(e)){e=new Array(e);const t=j.GS.findUsedItems(e);!1!==t&&t.length&&(e[0].used_gs=t)}P.rowDrop(e,n)}):_.contains('tb_page_break_module')?(P.rowDrop(j.toolbar.pageBreakModule.get(),n),j.toolbar.pageBreakModule.countModules()):j.toolbar.preDesignedRows.get(c.dataset.slug,function(e){P.rowDrop(e,n)}))}else{const r=t.closest('.module_row');if('module'===h){let e=t.closest('.tb_row_empty');e&&e.classList.remove('tb_row_empty'),r.classList.remove('tb_row_empty'),g&&(l&&l.classList.toggle('tb_row_empty',!l.querySelector('.active_module')),o&&o.classList.toggle('tb_row_empty',!o.querySelector('.active_module')))}g?j.undoManager.push(s.dataset.cid,g,r,'sort',{before:g.dataset.cid,after:r.dataset.cid}):P.moduleDrop($(s),!1,U.clone(r))}D.body.triggerHandler('tb_'+h+'_sort',[s])}};if(s.className='tb_sortable_helper tf_box tf_overflow',g=g&&U.clone(g)[0],_.contains('active_subrow')&&(o+=' tb_drag_subrow'),x){if(n=s.cloneNode(),s.style.opacity=0,'visual'!==j.mode){const t=c.getBoundingClientRect();n.style.width=t.width+'px',n.style.left=t.left+'px'}O.body.appendChild(n),a=n.offsetHeight/2}else if('module'===h)if(_.contains('active_subrow'))s.innerHTML='Subrow';else{let e=c.getAttribute('data-module-slug');if(!e){const M=j.Models.Registry.lookup(c.getAttribute('data-cid'));M&&'module'===M.get('elType')&&(e=M.get('mod_name'))}if(e&&themifyBuilder.modules[e]){const N=themifyBuilder.modules[e].icon,T=O.createElement('span');T.textContent=themifyBuilder.modules[e].name,T.className='tf_vmiddle',N&&s.appendChild(j.Utils.getIcon('ti-'+N)),s.appendChild(T)}}else if('column'===h)s.className+=' '+c.className,s.innerHTML='<div class="tb_row_grid_title"></div>';else if('row'===h&&(_.contains('tb_page_break_module')||_.contains('predesigned_row'))){const I=_.contains('tb_page_break_module')?'tb_page_break_title':'tb_predesigned_rows_title';s.textContent=c.getElementsByClassName(I)[0].textContent}'visual'===j.mode&&!u||((m=O.createElement('div')).className='tb_sortable_placeholder tf_rel tf_w'),O.body.appendChild(s),e.dataTransfer.setDragImage(s,s.offsetWidth/2+2,s.offsetHeight/2),c.addEventListener('dragend',function(e){if(e.stopImmediatePropagation(),D.body[0].removeEventListener('dragover',L),C.removeEventListener('drop',S,{once:!0}),C.removeEventListener('mousemove',E,{passive:!0}),C.removeEventListener('mouseover',E,{passive:!0}),C.removeEventListener('mouseout',E,{passive:!0}),C.removeEventListener('mouseenter',E,{passive:!0}),C.removeEventListener('mouseleave',E,{passive:!0}),this.removeEventListener('drag',B,{once:!0,passive:!0}),!f){const i=C.querySelector('[data-pos]');i&&S(i)}s.remove(),x&&n.remove(),m&&m.remove();const t=O.querySelectorAll('[data-pos]');for(let e=t.length-1;-1<e;--e)t[e].removeAttribute('data-pos');this.classList.remove('tb_draggable_item'),l(!0),'visual'!==j.mode&&$('.is-drop-target').removeClass('is-drop-target'),j.ActionBar.disable=m=f=A=c=_=p=s=n=a=d=C=b=r=o=h=g=null,j.ActionBar.clear()},{once:!0,passive:!0}),c.addEventListener('drag',B,{once:!0,passive:!0}),C.addEventListener('drop',S,{once:!0}),D.body[0].addEventListener('dragover',L),C.addEventListener('mousemove',E,{passive:!0}),C.addEventListener('mouseover',E,{passive:!0}),C.addEventListener('mouseout',E,{passive:!0}),C.addEventListener('mouseenter',E,{passive:!0}),C.addEventListener('mouseleave',E,{passive:!0})})}},subRowDrop(s,l){j.ActionBar.clear();const o=0<l.parent('.themify_builder_content,#tb_row_wrapper').length;if(o||0===l.closest('.sub_column').length){s=j.Utils.grid(s);let e,t,i;o||((e=U.clone(l.closest('.module_row'))).find('.tb_row_grid').remove(),t='row');const n=o?j.Views.init_row({cols:s[0].cols}):j.Views.init_subrow({cols:s[0].cols}),a=n.view.render().$el;if(o||l[0].parentNode.classList.contains('tb_holder')||l[0].parentNode.parentNode.classList.contains('tb_holder'))l[0].parentNode.replaceChild(a[0],l[0]),a[0].className+=' tb_element_clicked',j.ActionBar.type='subrow';else{let e=l.next('.tb_holder');0<e.length?e.prepend(a):(e=l.prev('.tb_holder')).append(a)}o&&(e=a.next('.module_row'),i=!0,0===e.length&&(i=!1,e=a.prev('.module_row')),e=e.data('cid'),t='grid_sort'),j.Utils.setCompactMode(a[0].getElementsByClassName('module_column')),j.Utils.runJs(a),l.remove(),j.hasChanged=!0;const d=a.closest('.module_row');o||d.removeClass('tb_row_empty'),d.find('.tb_row_grid').remove(),j.Utils.scrollToDropped(a[0]),j.undoManager.push(d.data('cid'),e,d,t,{next:i})}else l.remove()},rowDrop(i,s,l,e){j.ActionBar.clear();const o=O.createDocumentFragment(),n=[],a=[],t=function(){let e=s.prev('.module_row'),t;e=0===e.length?(t='visual'===j.mode?s.closest('.themify_builder_content').data('postid'):null,!1):e.data('cid'),s[0].innerHTML='',j.ActionBar.type='row',s[0].parentNode.replaceChild(o,s[0]),j.hasChanged=!0,j.Instances.Builder[j.builderIndex].removeLayoutButton(),j.undoManager.push('','','','predesign',{prev:e,rows:n,bid:t});for(let t=0,e=n.length;t<e;++t){let e=n[t][0].getElementsByClassName('module_column');0===t&&n[t][0].classList.add('tb_element_clicked'),j.Utils.setCompactMode(e),j.Utils.runJs(n[t])}j.Utils.scrollToDropped(n[0][0]),U.showLoader('hide'),j.Utils.calculateHeight()};e||j.Utils.clearLastEmptyRow(i);for(let e=0,t=i.length;e<t;++e)if(!0===l||i[e].styling&&0<Object.keys(i[e].styling).length||i[e].cols&&function(t){for(let e in t)if(t[e].styling&&0<Object.keys(t[e].styling).length||t[e].modules&&0<Object.keys(t[e].modules).length)return 1}(i[e].cols)){let t=j.Views.init_row(i[e]);if(!1!==t){let e=t.view.render();if(o.appendChild(e.el),'visual'===j.mode){let t=e.el.querySelectorAll('[data-cid]');a[e.el.dataset.cid]=1;for(let e=t.length-1;-1<e;--e)a[t[e].dataset.cid]=1}n.push(e.$el)}}'visual'===j.mode?j.bootstrap(a,t):t()},moduleDrop(r,c,u){j.ActionBar.clear();const e={mod_name:r.data('module-slug')},_=r.data('type'),m='part'===_||'module'===_;if(r[0].classList.contains('tb_row_grid'))this.subRowDrop(r.data('slug'),r);else{if(!m)return t(e);j.toolbar.libraryItems.get(r.data('id'),_,t),'visual'!==j.mode&&$('.themify-wp-editor-holder').addClass('themify-active-holder')}function t(e){const a=j.Views.init_module(e,!0),d=a.view.render();function t(e){m||a.model.set({is_new:1},{silent:!0});const t=!0===e?a.model.getPreviewSettings():a.model.get('mod_settings');let i,s=!1;if(c?c.hasClass('tb_module_front')?c.after(d.el):c.append(d.el):r.replaceWith(d.el),m?j.activeModel=a.model:a.model.trigger('edit',null),j.hasChanged=!0,'visual'===j.mode&&'layout-part'!==a.model.get('mod_name')&&1<=Object.keys(t).length&&(i=t.cid,'part'===_||'ajax'===r.data('type')?(s=!0,a.model.trigger('custom:preview:refresh',t)):'module'!==_?a.model.trigger('custom:preview:live',t):j.Utils.runJs(d.$el,'module')),m){if(s){const l=a.view.$el.find('.tb_preview_component').detach();a.view.el.prepend(l)}if(u){const o=d.$el.closest('.module_row'),n=(o.removeClass('tb_row_empty').find('.tb_module_dragging_helper').remove(),d.$el.closest('.active_subrow').removeClass('tb_row_empty'),u[0].getElementsByClassName('tb_library_item'));n[0]&&n[0].remove(),j.undoManager.push(o.data('cid'),u,o,'row'),i=o.data('cid'),j.Instances.Builder[j.builderIndex].removeLayoutButton(),j.activeModel=null}j.Utils.calculateHeight()}j.Utils.scrollToDropped(null,i)}if('visual'===j.mode&&m){const i=new Array;i[a.model.cid]=1,j.bootstrap(i,t)}else t(!0);return d}},toJSON(e){const i=[],s=e.children;for(let t=0,e=s.length;t<e;++t)if(s[t].classList.contains('module_row')){let e=j.Utils._getRowSettings(s[t]);0<Object.keys(e).length&&i.push(e)}return i},columnHover(e){let s=e.closest('.sub_column'),t=j.Instances.Builder[j.builderIndex].el,i=t.getElementsByClassName('tb_hover_sub_column'),l=e.closest('.tb_action_wrap');for(let e=i.length-1;-1<e;--e)i[e].classList.remove('tb_hover_sub_column');for(let e=(i=t.getElementsByClassName('tb_action_overlap')).length-1;-1<e;--e)i[e].classList.remove('tb_action_overlap');for(let e=(i=t.getElementsByClassName('active_action_bar')).length-1;-1<e;--e)i[e].classList.remove('active_action_bar');if(null!==l&&null!==(l=l.closest('.active_module'))&&l.classList.add('active_action_bar'),null!==s){const o=s.parentNode.closest('.module_column');if(!o.classList.contains('tb_hover_sub_column')){o.classList.add('tb_hover_sub_column');const n=s.getElementsByClassName('tb_column_action')[0];if(void 0!==n){let e=n.getBoundingClientRect(),t=!0,i=(e.left<5?o.closest('.module_row').getElementsByClassName('tb_row_action'):s.closest('.module_subrow').getElementsByClassName('tb_subrow_action'))[0];if(void 0!==i){const a=i.getBoundingClientRect();t=!(Math.abs(e.left-a.left)<e.width)||Math.abs(a.top-e.top)>e.height}n.classList.toggle('tb_action_overlap',!1===t)}}}if(!0!==this.isFullWidth){const d=(null!==s?s.parentNode:e).closest('.module_column');if(!1!==this.isFullWidth){const r=(null!==d?d:e).closest('.module_row');null!==r&&(this.isFullWidth=r.offsetWidth<O.body.clientWidth,O.body.classList.toggle('tb_page_row_fullwidth',!this.isFullWidth))}if(null!==d&&null!==d.parentNode.parentNode.closest('.fullwidth')){const c=d.getElementsByClassName('tb_column_action')[0];void 0!==c&&c.getBoundingClientRect().right>=O.body.clientWidth&&c.classList.add('tb_action_outside')}}}},j.undoManager={stack:[],is_working:!1,index:-1,btnUndo:null,btnRedo:null,compactBtn:null,init(){this.btnUndo=j.toolbar.el.getElementsByClassName('tb_undo_btn')[0],this.btnRedo=j.toolbar.el.getElementsByClassName('tb_redo_btn')[0],this.compactBtn=j.toolbar.el.getElementsByClassName('tb_compact_undo')[0],j.toolbar.$el.find('.tb_undo_redo').on('click',this.do_change.bind(this)),themifyBuilder.disableShortcuts||(R.document.addEventListener('keydown',this.keypres.bind(this)),'visual'===j.mode&&O.addEventListener('keydown',this.keypres.bind(this)))},push(e,t,i,s,l){j.hasChanged&&(j.editing=!1,i&&i instanceof HTMLElement&&(i=U.clone(i)),'visual'!==j.mode||'duplicate'!==s&&'sort'!==s||D.trigger('tfsmartresize'),this.stack.splice(this.index+1,this.stack.length-this.index),this.stack.push({cid:e,type:s,data:l,before:t,after:i}),this.index=this.stack.length-1,this.updateUndoBtns(),'visual'===j.mode&&(j.Forms.LayoutPart.isSaved=null,D.body.triggerHandler('builder_dom_changed',[s])))},set(e){let i=e[0].querySelectorAll('[data-cid]');(i=[].slice.call(i)).unshift(e[0]);for(let t=i.length-1;-1<t;--t){let e=j.Models.Registry.lookup(i[t].getAttribute('data-cid'));e&&e.trigger('change:view',i[t])}},doScroll(e){return e},keypres(e){if(!0===e.ctrlKey||!0===e.metaKey){const t=O.activeElement.tagName,i=R.document.activeElement.tagName,s=e.which;'INPUT'!==t&&'TEXTAREA'!==t&&'INPUT'!==i&&'TEXTAREA'!==i&&(89===s||90===s&&!0===e.shiftKey?(e.preventDefault(),this.hasRedo()&&this.changes(!1)):90===s&&(e.preventDefault(),this.hasUndo()&&this.changes(!0)))}},changes(o){j.ActionBar.clearClicked();const e=o?0:1;if(null!==j.activeModel&&('visual'!==j.mode||!O.activeElement.contentEditable&&j.liveStylingInstance.$liveStyledElmt[0].contains(O.activeElement))){if(!0===j.hasChanged)return ThemifyConstructor.saveComponent(!1),void $(this.btnUndo).triggerHandler('click');U.Lightbox.close()}const l=this.stack[this.index+e];if(void 0!==l){this.is_working=!0;let t='',e=l.type,i=$('.tb_element_cid_'+l.cid),s=!1;if('row'===(j.eventName=e))o?(t=U.clone(l.before),s=l.cid):(t=U.clone(l.after),s=l.before.data('cid'),i=$('.tb_element_cid_'+s)),this.doScroll(i),this.set(t),t.toggleClass('tb_row_empty',0===t.find('.active_module').length),i.replaceWith(t);else if('duplicate'===e)o?this.doScroll($('.tb_element_cid_'+l.after.data('cid'))).remove():(this.doScroll(i),t=U.clone(l.after),s=l.before.data('cid'),this.set(t),i.after(t));else if('delete_row'===e)if(o){t=U.clone(l.before),s=l.cid;const n=$('.tb_element_cid_'+l.data.pos_cid);this.doScroll(n),this.set(t),'after'===l.data.pos?n.after(t):n.before(t)}else this.doScroll(i).remove();else if('sort'===e){s=l.cid;let e;t=o?(e=l.data.before,U.clone(l.before)):(e=l.data.after,U.clone(l.after)),this.doScroll(t),this.set(t);const a=$('.tb_element_cid_'+s).closest('.module_row'),d=($('.tb_element_cid_'+s).remove(),a.toggleClass('tb_row_empty',0===a.find('.active_module').length),$('.tb_element_cid_'+e).replaceWith(t),t.closest('.module_row'));d.toggleClass('tb_row_empty',0===d.find('.active_module').length)}else if('row_sort'===e){s=l.cid;const r=l.data[o?'bnext':'anext'],c=$('.tb_element_cid_'+l.data[o?'before':'after']),u=$('.tb_element_cid_'+s);t=U.clone(u),u.remove(),this.set(t),r?c.before(t):c.after(t),this.doScroll(t)}else if('save'===e){s=l.cid;const _=j.Models.Registry.lookup(s),m='module'===_.get('elType'),h=m?'mod_settings':'styling';if(m&&l.data.column){let e;o?(e=$('.tb_element_cid_'+s).closest('.module_row'),s=!1,this.doScroll(i).remove()):(s=l.data.column.data('cid'),t=U.clone(l.data.column),i=$('.tb_element_cid_'+s),this.doScroll(i),this.set(t),i.replaceWith(t),e=t.closest('.module_row')),e.toggleClass('tb_row_empty',0===e.find('.active_module').length),e=null}else{this.doScroll(i);const g={};if(o?(t='string'==typeof l.before?l.before:U.clone(l.before),g[h]=l.data.bsettings):(t='string'==typeof l.after?l.after:U.clone(l.after),g[h]=l.data.asettings),'string'==typeof t){const b=O.createElement('div');b.outerHTML=t,t=b.firstChild}if('visual'===j.mode){const p=$.extend(!0,{},l.data.styles);for(let l in p){let e=ThemifyStyles.getSheet(l),s=e.cssRules||e.rules;for(let i in p[l])if(s[i])for(let t in p[l][i]){let e='backgroundClip'===t||'background-clip'===t?'WebkitBackgroundClip':t;s[i].style[e]=o?p[l][i][t].b:p[l][i][t].a}}const f=j.activeModel,y=void 0!==g[h][j.GS.key]?g[h][j.GS.key].split(' '):[];j.activeModel=_,j.GS.liveInstance=null,j.GS.generateValues(null,y,!0),j.activeModel=f,j.GS.liveInstance=null}_.set(g,{silent:!0}),this.set(t),i.replaceWith(t)}}else if('inline'===e)l.data.innerHTML=o?l.before:l.after,D.triggerEvent(l.data,'change');else if('predesign'===e){const v=l.data.rows;if(o){this.doScroll($('.tb_element_cid_'+v[0].data('cid')));for(let e=0,t=v.length;e<t;++e)$('.tb_element_cid_'+v[e].data('cid')).remove()}else{const w=O.createDocumentFragment(),C=[];for(let t=0,e=C.length;t<e;++t){let e=U.clone(C[t]);w.appendChild(e[0]),C.push(e)}!1!==l.data.prev?this.doScroll($('.tb_element_cid_'+l.data.prev)).after(w):this.doScroll('visual'===j.mode?$('#themify_builder_content-'+l.data.bid):$('#tb_row_wrapper')).prepend(w);for(let e=0,t=C.length;e<t;++e)this.set(C[e]),j.Utils.runJs(C[e])}}else if('import'===e){const x=$('[data-postid="'+l.data.bid+'"]'),k=U.clone(o?l.data.before:l.data.after),L=this;x.children().remove(),x.prepend(k),k.each(function(){L.set($(this))})}else if('grid_sort'===e)if(o)$('.tb_element_cid_'+l.cid).remove();else{const B=$('.tb_element_cid_'+l.before),E=U.clone(l.after);s=l.cid,l.data.next?B.before(E):B.after(E),this.set(E)}s&&'inline'!==e&&(j.ActionBar.hoverCid=null,j.Utils.runJs($(t))),o?--this.index:++this.index,D.trigger('undo',[t,e,o,l]),this.is_working=!1,this.updateUndoBtns(),'inline'!==e&&j.toolbar.pageBreakModule.countModules(),j.Utils.calculateHeight()}},hasRedo(){return this.index<this.stack.length-1},hasUndo(){return-1!==this.index},disable(){this.btnUndo.classList.add('tb_disabled'),this.btnRedo.classList.add('tb_disabled'),this.compactBtn.classList.add('tb_disabled')},updateUndoBtns(){const e=this.hasUndo(),t=this.hasRedo();this.btnUndo.classList.toggle('tb_disabled',!e),this.btnRedo.classList.toggle('tb_disabled',!t),this.compactBtn.classList.toggle('tb_disabled',!(e||t))},reset(){this.stack=[],this.index=-1,this.updateUndoBtns()},do_change(e){e.preventDefault(),e.stopPropagation(),!1!==this.is_working||e.currentTarget.classList.contains('tb_disabled')||this.changes(e.currentTarget.classList.contains('tb_undo_btn'))}},j.Views.Toolbar=s.View.extend({events:{'click .tb_import':'import','click .tb_load_layout':'loadLayout','click .tb_save_layout':'saveLayout','click .tb_dup_link':'duplicate','click .tb_toolbar_save':'save','click .tb_toolbar_backend_edit a':'save','click .tb_toolbar_close_btn':'panelClose','click .tb_breakpoint_switcher':'breakpointSwitcher','click .tb_popular_devices li':'deviceSwitcher','change .tb_change_mode input':'modChange','click .tb_float_minimize':'minimize','click .tb_float_close':'closeFloat','click .tb_toolbar_add_modules':'openFloat','click .tb_custom_css':'addCustomCSS','click .tb_zoom':'zoom','click .tb_toolbar_zoom_menu_toggle':'zoom','click .tb_toolbar_builder_preview':'previewBuilder','click .js-tb_module_panel_acc':'toggleAccordion'},lightboxStorageKey:'tb_module_panel',render(){const e=this,a={};let d=1;for(let n in themifyBuilder.modules){let i=O.createElement('div'),e=O.createElement('span'),t=O.createElement('span'),s=O.createElement('a'),l=themifyBuilder.modules[n].icon,o=(i.className='tb_module tb-module-'+n,i.dataset.categories=themifyBuilder.modules[n].category,themifyBuilder.modules[n].favorite&&(i.className+=' favorited'),e.className='tb_favorite tb_disable_sorting',t.className='module_name',t.textContent=themifyBuilder.modules[n].name,s.href='#',s.className='tf_plus_icon add_module_btn tb_disable_sorting',s.dataset.type='module',s.title=themifyBuilder.i18n.add_module,i.dataset.moduleSlug=n,i.dataset.index=d++,i.draggable=!0,themifyBuilder.modules[n].type&&(i.dataset.type=themifyBuilder.modules[n].type),e.appendChild(j.Utils.getIcon('ti-star')),l&&i.appendChild(j.Utils.getIcon('ti-'+l)),i.appendChild(e),i.appendChild(t),i.appendChild(s),themifyBuilder.modules[n].favorite?['favorite']:themifyBuilder.modules[n].category);for(let e=0,t=o.length;e<t;++e)void 0===a[o[e]]&&(a[o[e]]=O.createDocumentFragment()),a[o[e]].appendChild(i.cloneNode(!0))}let i=this.el.getElementsByClassName('tb_module_category_content');for(let t=i.length-1;-1<t;--t){let e=i[t].getAttribute('data-category');e&&(void 0!==a[e]?i[t].appendChild(a[e]):i[t].parentNode.style.display='none')}'visual'===j.mode&&R.document.body.appendChild(this.el);const t=function(){e.Panel.init(),j.undoManager.init(),e.preDesignedRows.init(),e.libraryItems.init(),e.common.init(),e.darkMode(),'visual'===j.mode&&e.inlineEditorMode(),setTimeout(function(){e.setMode(),e.help.init(),setTimeout(function(){if(e.Revisions.init(),'visual'===j.mode){const i=O.createElement('div');for(let t=6;1<t;--t){let e=O.createElement('div');e.className+='tb_row_grid tb_row_grid_'+t,e.innerHTML='<div class="tb_row_grid_title"></div>',i.appendChild(e)}i.className='tf_abs',i.style.visibility='hidden',O.body.appendChild(i),setTimeout(function(){i.remove()},500),e.$el.on('click','.tb_favorite',e.toggleFavoriteModule),e.unload()}D.body.on('click','.tb_favorite',e.toggleFavoriteModule)},2e3),j.Mixins.Builder.updateModuleSort(j.Instances.Builder[j.builderIndex].el),j.Mixins.Builder.updateModuleSort(e.el.getElementsByClassName('tb_module_panel_container')[0]),D.LoadCss(themifyBuilder.meta_url+'css/themify.minicolors.css'),D.LoadCss(themifyBuilder.builder_url+'/css/editor/themify.combobox.css'),'visual'===j.mode&&(R.Themify.LoadCss(themifyBuilder.meta_url+'css/themify.minicolors.css'),R.Themify.LoadCss(themifyBuilder.builder_url+'/css/editor/themify.combobox.css'))},800),e.draggable(),'true'===localStorage.getItem('tb_panel_closed')?e.closeFloat():e.Panel.setFocus()};'visual'===j.mode?R.Themify.on('themify_builder_ready',t,!0):t()},setMode(){localStorage.getItem('tb_mode')?j.ActionBar.isHoverMode=null:(j.ActionBar.isHoverMode=!0,this.el.getElementsByClassName('tb_change_mode')[0].getElementsByClassName('tb-checkbox')[0].checked=!0),!0===j.ActionBar.isInit&&j.ActionBar.changeMode()},darkMode(){localStorage.getItem('tb_dark_mode')?(j.ActionBar.darkMode=!0,this.el.getElementsByClassName('tb_dark_mode')[0].checked=!0,j.ActionBar.changeDarkMode()):j.ActionBar.darkMode=null},inlineEditorMode(){localStorage.getItem('tb_inline_editor')&&(j.ActionBar.inlineEditor=null,this.el.getElementsByClassName('tb_inline_editor')[0].checked=!1)},modChange(e){e.stopPropagation();const t=e.currentTarget.classList,i=!0===e.currentTarget.checked;t.contains('tb_mode')?(i?(localStorage.removeItem('tb_mode'),j.ActionBar.isHoverMode=!0):(localStorage.setItem('tb_mode',1),j.ActionBar.isHoverMode=null),j.ActionBar.clear(),j.ActionBar.clearClicked(),j.ActionBar.clearSelected(),j.ActionBar.changeMode()):t.contains('tb_right_click_mode')?(i?localStorage.removeItem('tb_right_click'):localStorage.setItem('tb_right_click',1),j.ActionBar.initRightClick()):t.contains('tb_padding_dragging_mode')?(i?localStorage.removeItem('tb_disable_padding_dragging'):localStorage.setItem('tb_disable_padding_dragging',1),j.EdgeDrag.init()):t.contains('tb_dark_mode')?(i?(localStorage.setItem('tb_dark_mode',1),j.ActionBar.darkMode=!0):(localStorage.removeItem('tb_dark_mode'),j.ActionBar.darkMode=null),j.ActionBar.changeDarkMode()):t.contains('tb_inline_editor')&&(i?(localStorage.removeItem('tb_inline_editor'),j.ActionBar.inlineEditor=!0):(localStorage.setItem('tb_inline_editor',1),j.ActionBar.inlineEditor=null),D.trigger('tb_inline_editor_changed'))},getStorage(){const e=localStorage.getItem(this.lightboxStorageKey);return e?JSON.parse(e):null},updateStorage(){const e=this.$el.find('#tb_module_panel'),t=e.position();let i=e.outerHeight();if(i<=0){const s=this.getStorage();i=s?s.height:''}localStorage.setItem(this.lightboxStorageKey,JSON.stringify({top:t.top,left:t.left,width:e.outerWidth(),height:i}))},getPanelClass(e){return e<=195?'tb_float_xsmall':e<=270?'tb_float_small':e<=400?'tb_float_medium':'tb_float_large'},_setResponsiveTabs(t){const i=j.toolbar.el.getElementsByClassName('tb_module_types');for(let e=i.length-1;-1<e;--e)'tb_float_xsmall'===t?(i[e].classList.add('tb_ui_dropdown_items'),i[e].parentNode.classList.add('tb_compact_tabs')):(i[e].classList.remove('tb_ui_dropdown_items'),i[e].parentNode.classList.remove('tb_compact_tabs'))},resize(){const f=this.el.getElementsByClassName('tb_modules_panel_wrap')[0],y=this,o=j.Utils.getMouseEvents(),t=f.getElementsByClassName('tb_resizable');for(let e=t.length-1;-1<e;--e)t[e].addEventListener(o.mousedown,function(t){if('touchstart'===t.type||1===t.which){t.stopImmediatePropagation();let d,e;const i=this.ownerDocument,r=.9*i.documentElement.clientHeight,c=50,u=parseInt($(f).css('min-width')),_=parseInt($(f).css('max-width')),m=this.dataset.axis,h=parseInt(f.offsetHeight,10),g=parseInt(f.offsetWidth,10),b=(t.touches?t.touches[0]:t).clientX,p=(t.touches?t.touches[0]:t).clientY,s=function(a){a.stopImmediatePropagation(),e&&cancelAnimationFrame(e),e=requestAnimationFrame(function(){let e;const t=(a.touches?a.touches[0]:a).clientX,i=(a.touches?a.touches[0]:a).clientY;if('w'===m){if((e=(e=b+g-t)>_?_:e)>=u&&e<=_){const s=f.style.width;f.style.width=e+'px',f.style.left=parseInt(f.style.left)+parseInt(s)-e+'px'}}else{const l='-y'===m||'ne'===m||'nw'===m?p+h-i:h+i-p;if((e='sw'===m||'nw'===m?b+g-t:g+t-b)>_&&(e=_),('se'===m||'x'===m||'sw'===m||'nw'===m||'ne'===m)&&e>=u&&e<=_){const o=f.style.width;f.style.width=e+'px','sw'!==m&&'nw'!==m||(f.style.left=parseInt(f.style.left)+parseInt(o)-e+'px')}('se'===m||'y'===m||'-y'===m||'sw'===m||'nw'===m||'ne'===m)&&l>=c&&l<=r&&('-y'!==m&&'nw'!==m&&'ne'!==m||(f.style.top=parseInt(f.style.top)+parseInt(f.style.height)-l+'px'),f.style.height=l+'px')}if('y'!==m&&'-y'!==m){const n=y.getPanelClass(e);d!==n&&(d&&f.classList.remove(d),f.classList.add(n),d=n,y._setResponsiveTabs(n))}})},l=function(){t.stopImmediatePropagation(),this.removeEventListener(o.mousemove,s,{passive:!0}),e&&cancelAnimationFrame(e),e=null,this.body.style.cursor='',this.body.classList.remove('tb_start_animate','tb_move_drag','tb_panel_resize'),y.updateStorage()};i.addEventListener(o.mousemove,s,{passive:!0}),i.addEventListener(o.mouseup,l,{passive:!0,once:!0}),i.body.classList.add('tb_start_animate','tb_move_drag','tb_panel_resize'),i.body.style.cursor=$(this).css('cursor')}},{passive:!0})},setFloat(){const e=this.Panel.el.find('#tb_module_panel')[0],t=this.getStorage(),i=(e.classList.add('tb_panel_floating'),t&&(e.style.width=t.width+'px',e.style.height=t.height+'px'),this.getPanelClass(e.offsetWidth));e.classList.add(i),this._setResponsiveTabs(i)},removeFloat(){this.Panel.el.find('#tb_module_panel').css({top:'',width:'',height:'',left:'',right:'',bottom:''}).removeClass('tb_panel_floating tb_float_xsmall tb_float_small tb_float_medium tb_float_large tb_is_minimize')},draggable(){const a=this.el.querySelector('#tb_module_panel'),d=j.Utils.getMouseEvents(),r=this;if(!U.Lightbox.dockMode.get()){let t=this.getStorage(),e;if(t){t.top>R.innerHeight&&delete t.top,t.left>R.innerWidth&&delete t.left;for(let e in t)a.style[e]=t[e]+'px';e=t.width}else e=a.offsetWidth;const i=this.getPanelClass(e);a.classList.add('tb_panel_floating',i),this._setResponsiveTabs(i)}a.getElementsByClassName('tb_drag_handle')[0].addEventListener(d.mousedown,function(e){if('touchstart'===e.type||1===e.which){e.stopImmediatePropagation();let s;const i=this.ownerDocument,l=a.offsetLeft-(e.touches?e.touches[0]:e).clientX,o=a.offsetTop-(e.touches?e.touches[0]:e).clientY,t=function(i){i.stopImmediatePropagation(),s&&cancelAnimationFrame(s),s=requestAnimationFrame(function(){const e=l+(i.touches?i.touches[0]:i).clientX,t=o+(i.touches?i.touches[0]:i).clientY;a.style.left=e+'px',a.style.top=t+'px','visual'===j.mode&&U.Lightbox.dockMode.drag(i,e)})},n=function(e){i.body.classList.add('tb_start_animate','tb_move_drag','tb_panel_drag'),r.setFloat(),U.Lightbox.dockMode.get()&&(U.Lightbox.dockMode.close(),setTimeout(function(){j.Utils._onResize(!0)},100))};i.addEventListener(d.mouseup,function(e){e.stopImmediatePropagation(),this.removeEventListener(d.mousemove,n,{passive:!0,once:!0}),this.removeEventListener(d.mousemove,t,{passive:!0}),t(e),requestAnimationFrame(function(){if(i.body.classList.remove('tb_start_animate','tb_move_drag','tb_panel_drag'),U.Lightbox.dockMode.get())r.removeFloat(),r._setResponsiveTabs(!1);else{const e=$(R).height()-30,t=a.offsetTop;(t<0||e<t)&&(a.style.top=(t<0?0:e)+'px'),r.updateStorage()}s=null})},{passive:!0,once:!0}),i.addEventListener(d.mousemove,n,{passive:!0,once:!0}),i.addEventListener(d.mousemove,t,{passive:!0})}},{passive:!0}),this.resize()},minimize(e){e.preventDefault(),e.stopPropagation();const t=$(e.currentTarget).closest('#tb_module_panel');if(t.hasClass('tb_is_minimize')){t.removeClass('tb_is_minimize');const i=this.getStorage();t.css('height',i?i.height:'')}else t.addClass('tb_is_minimize')},import(t){t.preventDefault(),t.stopPropagation();const e=t.currentTarget.getAttribute('data-component'),i=R.document.getElementsByTagName('body')[0],s={contructor:'file'!==e,dataType:'json',data:{action:'builder_import',type:e}};if('file'!==e||confirm(themifyBuilder.i18n.importFileConfirm))if('file'===e){let e=R.document.getElementById('tb_import_filestb_plupload_browse_button');if(null===e){e=O.createElement('input');const l=O.createElement('div'),o=O.createElement('span');l.id='tb_import_filestb_plupload_upload_ui',l.style.display='none',e.type='button',e.id='tb_import_filestb_plupload_browse_button',o.className='ajaxnonceplu',o.id=themifyBuilder.import_nonce,l.appendChild(e),l.appendChild(o),i.appendChild(l),j.Utils.builderPlupload('',e.parentNode)}else e.click()}else{U.Lightbox.$lightbox[0].style.display='none';const n=$(t.currentTarget.closest('ul')),a=n.offset();let e=a.top+n.height()-40;D.body.off('themify_builder_lightbox_close.import'),n.addClass('tb_current_menu_selected'),null!==j.Forms.LayoutPart.id&&(e-=b.pageYOffset+60),U.Lightbox.open(s,function(){i.classList.add('tb_standalone_lightbox')},function(){this.$lightbox[0].classList.add('tb_import_post_lightbox'),this.setStandAlone(a.left,e,!0),D.body.one('themify_builder_lightbox_close.import',function(){i.classList.remove('tb_standalone_lightbox'),U.Lightbox.$lightbox[0].classList.remove('tb_import_post_lightbox'),n.removeClass('tb_current_menu_selected')}),$('#tb_submit_import_form',U.Lightbox.$lightbox).one('click',function(e){e.preventDefault();const t={buttons:{no:{label:ThemifyConstructor.label.replace_builder},yes:{label:ThemifyConstructor.label.append_builder}}};U.LiteLightbox.confirm(themifyBuilder.i18n.dialog_import_page_post,function(e){$.ajax({type:'POST',url:themifyBuilder.ajaxurl,dataType:'json',data:{action:'builder_import_submit',nonce:themifyBuilder.tb_load_nonce,data:j.Forms.serialize('tb_options_import'),importType:'no'===e?'replace':'append',importTo:themifyBuilder.post_ID},beforeSend(e){U.showLoader('show')},success(e){e.custom_css&&(u=e.custom_css),void 0!==e.builder_data?j.Forms.reLoad(e,themifyBuilder.post_ID):U.showLoader('error'),U.Lightbox.close()}})},t)})})}},unload(){'visual'===j.mode&&O.head.insertAdjacentHTML('afterbegin','<base target="_parent">'),R.onbeforeunload=function(){return j.editing||!j.hasChanged&&!j.undoManager.hasUndo()?null:'Are you sure'}},panelClose(e){e.preventDefault(),R.location.reload(!0)},loadLayout(e){e.preventDefault(),e.stopPropagation();var _=this,t=R.document.body,i=$(e.currentTarget.closest('ul')),e=_.layoutsList?{loadMethod:'html',data:_.layoutsList}:{data:{action:'tb_load_layout'}};U.Lightbox.$lightbox[0].style.display='none',i.addClass('tb_current_menu_selected'),D.body.off('themify_builder_lightbox_close.loadLayout'),U.Lightbox.open(e,function(){t.classList.add('tb_load_layout_active','tb_standalone_lightbox')},function(){const l=this.$lightbox,o=l.find('#tb_tabs_pre-designed');if(0===o.length)t.classList.remove('tb_load_layout_active','tb_standalone_lightbox'),i.removeClass('tb_current_menu_selected'),e();else{l[0].classList.add('tb_predesigned_lightbox'),this.setStandAlone(R.innerWidth/2,(R.document.documentElement.clientHeight-l.height())/2,!0);const n=o.find('.tb_ui_dropdown_items');function e(){l.on('click.loadLayout','.layout_preview img',function(e){e.preventDefault(),e.stopPropagation();const i=$(this).closest('.layout_preview'),t={buttons:{no:{label:ThemifyConstructor.label.layout_replace},yes:{label:ThemifyConstructor.label.layout_append}}};U.LiteLightbox.confirm(themifyBuilder.i18n.confirm_template_selected,function(l){const e=i.closest('ul').data('group'),o=function(t){if('no'!==l){const e='visual'!==j.mode?O.getElementById('tb_row_wrapper'):O.getElementsByClassName('themify_builder_content-'+themifyBuilder.post_ID)[0],i=j.Mixins.Builder.toJSON(e),s=[];for(let e in i)s.push(i[e]);for(let e in t)s.push(t[e]);t=s}!0!==_.is_set&&$.ajax({type:'POST',url:themifyBuilder.ajaxurl,data:{action:'set_layout_action',nonce:themifyBuilder.tb_load_nonce,mode:'no'!==l?1:0,id:themifyBuilder.post_ID},success(){_.is_set=!0}}),j.Forms.reLoad(t,themifyBuilder.post_ID),U.Lightbox.close()};if('pre-designed'===e){U.showLoader('show');const t=i.data('slug'),s=themifyBuilder.paths.layout_template.replace('{SLUG}',t);if(j.layouts_selected){if(j.layouts_selected[t])return j.Utils.clearElementId(j.layouts_selected[t]),void o(JSON.parse(j.layouts_selected[t]))}else j.layouts_selected={};$.get(s,null,null,'text').done(function(e){j.layouts_selected[t]=e;let s=JSON.parse(e);-1!==e.indexOf(j.GS.key)?$.getJSON(themifyBuilder.paths.layout_template.replace('{SLUG}',t+'-gs')).done(function(t){const i={};for(let e in t)void 0!==t[e].class?i[t[e].class]=t[e]:i[e]=t[e];j.GS.setImport(i,function(){o(s)},s)}).fail(function(e,t,i){o(s)}):o(s)}).fail(function(e,t,i){U.LiteLightbox.alert(ThemifyConstructor.label.layout_error.replace('{FILE}',s))}).always(function(){U.showLoader()})}else $.ajax({type:'POST',url:themifyBuilder.ajaxurl,dataType:'json',data:{action:'tb_set_layout',nonce:themifyBuilder.tb_load_nonce,layout_slug:i.data('slug'),layout_group:e,mode:'no'!==l?1:0},beforeSend(){'visual'===j.mode&&U.showLoader('show')},success(e){e.data?(e.gs&&(j.GS.styles=$.extend(!0,{},e.gs,j.GS.styles)),o(e.data),U.showLoader()):(U.showLoader('error'),alert(e.msg),U.Lightbox.close())}})},t)})}function s(){e();const s=o.find('.layout_preview_list');n.show().find('li').on('click',function(e){if(e.preventDefault(),e.stopPropagation(),!this.classList.contains('current')){let e=s;if(this.classList.contains('all'))e.show();else{s.hide();const t=''!==themifyBuilder.paths.layouts_index?'*':'';(e=s.filter('[data-category'+t+'="'+$(this).text()+'"]')).show()}$(this).addClass('current').siblings().removeClass('current'),n.parent().find('.tb_ui_dropdown_label').html($(this).text())}j.Utils.hideOnClick(n)}),n.find('.tb_selected_cat').trigger('click'),l.find('#tb_layout_search').on('keyup',function(){let e=this.value.trim(),t=s;if(''===e)t.show();else{const i=n.find('li.all');i[0].classList.contains('current')||i.click(),s.hide(),(t=s.find('.layout_title').filter(function(){return new RegExp(e,'i').test($(this).text())}).closest('.layout_preview_list')).show()}})[0].focus(),D.body.one('themify_builder_lightbox_close.loadLayout',function(){l.off('click.loadLayout')[0].classList.remove('tb_predesigned_lightbox'),o.find('#tb_layout_search').off('keyup'),t.classList.remove('tb_load_layout_active','tb_standalone_lightbox'),i.removeClass('tb_current_menu_selected')})}_.layoutsList?s():$.ajax({type:'POST',url:themifyBuilder.ajaxurl,dataType:'json',data:{action:'tb_load_predesigned_layouts',nonce:themifyBuilder.tb_load_nonce,src:themifyBuilder.paths.layouts_index,id:themifyBuilder.post_ID},success(e){const t=JSON.parse(e.data);if(''===themifyBuilder.paths.layouts_index){const i=Object.keys(t);j.layouts_selected={};for(let e=i.length-1;-1<e;--e)j.layouts_selected[t[i[e]].slug]=t[i[e]].data}{var a=t,d=e.selected;const r={},c=O.createDocumentFragment(),u=O.createDocumentFragment();for(let n=0,e=a.length;n<e;++n){let e=O.createElement('li'),t=O.createElement('div'),i=O.createElement('div'),s=O.createElement('img'),l=O.createElement('div'),o=O.createElement('div');if(e.className='layout_preview_list',e.dataset.category=a[n].category,t.className='layout_preview',t.dataset.id=a[n].id,t.dataset.slug=a[n].slug,i.className='thumbnail',s.src=a[n].thumbnail,s.alt=a[n].title,s.title=a[n].title,l.className='layout_action',o.className='layout_title',o.textContent=a[n].title,l.appendChild(o),void 0!==a[n].url){let e=O.createElement('a');e.className='layout-preview-link',e.href=a[n].url,e.target='_blank',e.title=themifyBuilder.i18n.preview,e.appendChild(j.Utils.getIcon('ti-search')),l.appendChild(e)}if(i.appendChild(s),t.appendChild(i),t.appendChild(l),e.appendChild(t),c.appendChild(e),a[n].category){let i=String(a[n].category).split(',');for(let t=0,e=i.length;t<e;++t)if(''!==i[t]&&1!==r[i[t]]){let e=O.createElement('li');e.textContent=i[t],u.appendChild(e),r[i[t]]=1,i[t]===d&&(e.className='tb_selected_cat')}}}n[0].appendChild(u),o[0].getElementsByClassName('tb_layout_lists')[0].appendChild(c),_.layoutsList=l[0].getElementsByClassName('tb_options_tab_wrapper')[0].cloneNode(!0),s()}},error(){U.LiteLightbox.alert($('#tb_load_layout_error',o).show().text())}})}})},saveLayout(e){e.preventDefault(),e.stopPropagation();const t={contructor:!0,loadMethod:'html',save:{},data:{save_as_layout:{options:[{id:'layout_title_field',type:'text',label:ThemifyConstructor.label.title},{id:'layout_img_field',type:'image',label:ThemifyConstructor.label.image_preview},{id:'layout_img_field_id',type:'hidden'},{id:'postid',type:'hidden',value:themifyBuilder.post_ID}]}}},i=$(e.currentTarget.closest('ul'));i.addClass('tb_current_menu_selected'),U.Lightbox.$lightbox[0].style.display='none',U.Lightbox.open(t,function(){R.document.body.classList.add('tb_standalone_lightbox')},function(){const t=this.$lightbox;t.find('.builder_save_button').one('click',function(e){e.stopPropagation(),e.preventDefault(),$.ajax({type:'POST',url:themifyBuilder.ajaxurl,dataType:'json',data:{action:'tb_save_custom_layout',nonce:themifyBuilder.tb_load_nonce,form_data:j.Forms.serialize(t[0])},beforeSend(){U.showLoader('show')},success(e){'success'===e.status?(U.showLoader(),U.Lightbox.close()):(U.showLoader('error'),alert(e.msg))}})}),t.addClass('tb_savead_lightbox'),this.setStandAlone(e.clientX,e.clientY),D.body.one('themify_builder_lightbox_close',function(){t.removeClass('tb_savead_lightbox').find('.builder_save_button').off('click'),R.document.body.classList.remove('tb_standalone_lightbox'),i.removeClass('tb_current_menu_selected')})})},duplicate(e){if(e.preventDefault(),e.stopPropagation(),confirm(themifyBuilder.i18n.confirm_on_duplicate_page)){const t=this;j.Utils.saveBuilder(function(){t.Revisions.ajax({action:'tb_duplicate_page',tb_is_admin:'visual'!==j.mode},function(e){e&&(R.location.href=$('<div/>').html(e).text())})})}},addCustomCSS(l){l.preventDefault(),l.stopPropagation(),null!==j.activeModel&&ThemifyConstructor.saveComponent(!0),null===u&&(u=themifyBuilder.custom_css,delete themifyBuilder.custom_css),u=u||'';const e={contructor:!0,loadMethod:'html',save:{},data:{css:{options:[{id:'custom_css',type:'textarea',rows:17,class:'fullwidth'},{id:'custom_css_m',type:'message',label:'',comment:ThemifyConstructor.label.cus_css_m},{id:'postid',type:'hidden',value:themifyBuilder.post_ID}]}}},o=l.currentTarget;o.classList.add('tb_tooltip_active'),U.Lightbox.$lightbox[0].style.display='none',R.document.body.classList.add('tb_standalone_lightbox'),U.Lightbox.open(e,function(){ThemifyConstructor.code_editor.load()},function(){const e=this.$lightbox,i='tb_custom_css_tmp',s=e[0].querySelector('#custom_css'),t=function(){setTimeout(function(){const e=themifyBuilder.c_e.config,t=(e.codemirror.mode='css',R.wp.codeEditor.initialize(s,e));ThemifyConstructor.code_editor.setHeight(t.codemirror.display.wrapper,'t'),t.codemirror.on('change',function(e){const t=e.getValue().trim();if(s.value=t,'visual'===j.mode){let e=O.getElementById(i);null===e&&((e=O.createElement('style')).type='text/css',e.id=i,O.head.appendChild(e)),e.innerHTML=t}})},100)};s.value=u,void 0===R.wp.codeEditor?D.on('codemirror_loaded',t):t(),e.addClass('tb_custom_css_lightbox').find('.builder_save_button').on('click',function(e){e.stopImmediatePropagation(),e.preventDefault();const t=s.value.trim(),i=R.wp.CodeMirror.lint.css(t,{errors:1});i&&0<i.length&&!confirm(themifyBuilder.c_e.err)||(u=t,U.Lightbox.close())}),this.setStandAlone(l.clientX,l.clientY),D.body.one('themify_builder_lightbox_close',function(){u||(u='',o.classList.add('tb_tooltip_active'));const e=O.getElementById(i);e&&(e.innerHTML=u),R.document.body.classList.remove('tb_standalone_lightbox')})})},Revisions:{init(){j.toolbar.$el.find('.tb_toolbar_revision_btn').on('click',this.revision.bind(this))},revision(e){const t=e.target.classList;t.contains('tb_toolbar_revision_btn')?null!==j.activeModel&&U.Lightbox.$lightbox.is(':visible')&&ThemifyConstructor.saveComponent():(t.contains('tb_save_revision')||t.contains('tb_load_revision'))&&(e.preventDefault(),e.stopPropagation(),t.contains('tb_save_revision')?this.saveEvent():this.load(e))},load(e){const t=this,i=$('body',R.document),s=$(e.target.closest('ul')),l=s.offset();s.addClass('tb_current_menu_selected'),U.Lightbox.$lightbox[0].style.display='none',D.body.off('themify_builder_lightbox_close.revisions'),t.ajax({action:'tb_load_revision_lists'},function(e){U.Lightbox.open({contructor:!0,loadMethod:'html',data:{revision:{html:$(e)[0]}}},function(){i.addClass('tb_standalone_lightbox')},function(){this.$lightbox[0].classList.add('tb_revision_lightbox'),this.setStandAlone(l.left,l.top,!0),i.on('click.revision','.js-builder-restore-revision-btn',t.restore.bind(t)).on('click.revision','.js-builder-delete-revision-btn',t.delete.bind(t)),D.body.one('themify_builder_lightbox_close.revisions',function(){s.removeClass('tb_current_menu_selected'),i.off('.revision').removeClass('tb_standalone_lightbox'),U.Lightbox.$lightbox[0].classList.remove('tb_revision_lightbox')})})})},ajax(e,t){const i={tb_load_nonce:themifyBuilder.tb_load_nonce,postid:themifyBuilder.post_ID,sourceEditor:'visual'===j.mode?'frontend':'backend'};return e=$.extend({},e,i),$.ajax({type:'POST',url:themifyBuilder.ajaxurl,data:e,beforeSend(){U.showLoader('show')},complete(){U.showLoader('hide')},success(e){'function'==typeof t&&t.call(this,e)}})},saveEvent(t){const i=this;U.LiteLightbox.prompt(themifyBuilder.i18n.enterRevComment,function(e){null!==e&&i.saveRevision(e,t)})},saveRevision(e,t){const i=j.Utils.saveBuilder(null,!0);this.ajax({action:'tb_save_revision',rev_comment:e,data:JSON.stringify(j.Utils.clear(i.data)),postid:i.id},t)},restore(e){e.preventDefault(),e.stopPropagation();const t=$(e.currentTarget).data('rev-id'),i=this,s=function(){i.ajax({action:'tb_restore_revision_page',revid:t},function(e){e.builder_data?(j.Forms.reLoad(e,themifyBuilder.post_ID),U.Lightbox.close()):(U.showLoader('error'),alert(e.data))})};U.LiteLightbox.confirm(themifyBuilder.i18n.confirmRestoreRev,function(e){'yes'===e?i.saveEvent(s):s()},{buttons:{no:{label:ThemifyConstructor.label.save_no},yes:{label:ThemifyConstructor.label.save}}})},delete(e){if(e.preventDefault(),e.stopPropagation(),confirm(themifyBuilder.i18n.confirmDeleteRev)){const t=$(e.currentTarget),i=t.data('rev-id');this.ajax({action:'tb_delete_revision',revid:i},function(e){e.success?t.closest('li').remove():(U.showLoader('error'),alert(e.data))})}}},save(e){e.preventDefault(),e.stopPropagation();const t=!!e.currentTarget.closest('.tb_toolbar_backend_edit')&&e.currentTarget.getAttribute('href');themifyBuilder.is_gutenberg_editor&&!1!==t?(j.undoManager.reset(),j._backendSwitchFrontend(t)):j.Utils.saveBuilder(function(e){!1!==t&&('visual'===j.mode?(j.editing=!0,sessionStorage.setItem('focusBackendEditor',!0),R.location.href=t):(j.undoManager.reset(),j._backendSwitchFrontend(t)))})},libraryItems:{items:[],is_init:null,init(){$(O).one('tb_panel_tab_tb_module_panel_library_wrap',this.load.bind(this))},load(e,t){const i=this;(t=$(t).find('.tb_module_panel_library_wrap')).addClass('tb_busy'),$.ajax({type:'POST',url:themifyBuilder.ajaxurl,data:{action:'tb_get_library_items',nonce:themifyBuilder.tb_load_nonce,part:'all',pid:themifyBuilder.post_ID},success(e){i.setData(e),t.removeClass('tb_busy'),i.is_init=!0},error(){t.removeClass('tb_busy'),U.showLoader('error'),i.init(),j.toolbar.$el.find('.tb_library_item_list').html('<h3>Failed to load Library Items.</h3>')}})},get(t,e,i){if(void 0!==this.items[t])i(this.items[t]);else{const s=this;$.ajax({type:'POST',url:themifyBuilder.ajaxurl,dataType:'json',data:{action:'tb_get_library_item',nonce:themifyBuilder.tb_load_nonce,type:e,id:t},beforeSend(e){U.showLoader('show')},success(e){e.content.gs&&(j.GS.styles=$.extend(!0,{},e.content.gs,j.GS.styles),delete e.content.gs),U.showLoader('hide'),'success'===e.status?(s.items[t]=e.content,i(e.content)):U.showLoader('error')},error(){U.showLoader('error')}})}},template(i){let s='';for(let t=0,e=i.length;t<e;++t){let e='part';-1!==i[t].post_type.indexOf('_rows',5)?e='row':-1!==i[t].post_type.indexOf('_module',5)&&(e='module'),s=(s+='<div class="tb_library_item tb_item_'+e+'" draggable="true" data-type="'+e+'" data-id="'+i[t].id+'">')+'<div class="tb_library_item_inner"><span>'+i[t].post_title+"</span><a href=\"#\" class=\"remove_item_btn tb_disable_sorting tf_close\" title=\"Delete\"></a></div></div>"}return s},setData(e){let t='<span class="tb_no_content" style="display:none">No library content found.</span>'+this.template(e),i=$('.tb_library_item_list');for(let e=(i=(i='visual'===j.mode?i.add(j.toolbar.$el.find('.tb_library_item_list')):i).get()).length-1;-1<e;--e)i[e].insertAdjacentHTML('afterbegin',t),i[e].previousElementSibling.getElementsByClassName('current')[0].click();D.body.on('click','.remove_item_btn',this.delete.bind(this)),'visual'===j.mode&&j.toolbar.$el.on('click','.remove_item_btn',this.delete.bind(this))},delete(e){e.preventDefault(),e.stopPropagation();let l=$(e.currentTarget).closest('.tb_library_item'),o=l.data('type');if(confirm(themifyBuilder.i18n[o+'LibraryDeleteConfirm'])){const n=l.data('id');$.ajax({type:'POST',url:themifyBuilder.ajaxurl,data:{action:'tb_remove_library_item',nonce:themifyBuilder.tb_load_nonce,id:n},beforeSend(e){U.showLoader('show')},success(t){if(U.showLoader('hide'),t){const e=(0<l.closest('#'+j.toolbar.common.btn.prop('id')).length?j.toolbar.$el:j.toolbar.common.btn).find('.tb_item_'+o+'[data-id="'+n+'"]');if(l=l.add(e),'part'===o){l=l.add($('.themify_builder_content-'+n).closest('.active_module'));const s=ThemifyConstructor.layoutPart.data;for(let e=s.length-1;-1<e;--e)if(s[e].post_name===t){ThemifyConstructor.layoutPart.data.splice(e,1);break}}const i=l.parent().siblings('.tb_library_types').find('.current');l.remove(),i.trigger('click')}else U.showLoader('error')},error(){U.showLoader('error')}})}}},preDesignedRows:{is_init:null,rows:{},items:{},currentCategory:'All',categories:{All:{isLoaded:!1}},loadingItems:!1,init(){setTimeout(function(){const e=R.document.createElement('meta'),i=R.document.head,s=[{href:'//themify.me',rel:'dns-prefetch preconnect'},{href:'//fonts.googleapis.com',rel:'dns-prefetch preconnect'},{href:'//maps.googleapis.com',rel:'dns-prefetch preconnect'},{href:themifyBuilder.paths.rows_index,rel:'prefetch',as:'fetch'}];e.content='on',e.setAttribute('http-equiv','x-dns-prefetch-control'),i.appendChild(e);for(let t in s){let e=R.document.createElement('link');e.setAttribute('crossorigin',!0),e.rel=s[t].rel,e.href=s[t].href,s[t].as&&e.setAttribute('as',s[t].as),i.appendChild(e)}},7e3),$(O).one('tb_panel_tab_tb_module_panel_rows_wrap',this.load.bind(this))},load(e,s){const l=this;(s=$(s).find('.tb_predesigned_rows_list')).addClass('tb_busy'),$.getJSON(themifyBuilder.paths.rows_index).done(function(e){l.setData(e,s)}).fail(function(e,t,i){l.setData({},s),l.is_init=null,U.showLoader('error'),j.toolbar.$el.find('.tb_predesigned_rows_container').append('<h3>'+ThemifyConstructor.label.rows_fetch_error+'</h3>'),$(O).one('tb_panel_tab_tb_module_panel_rows_wrap',l.load.bind(l))})},masonry(i){const s=i.querySelectorAll('.predesigned_row:not([data-masonry="done"])');for(let e=0,t=s.length;e<t;e++){var l=void 0,l=s[e];const o=parseInt(b.top.getComputedStyle(i).getPropertyValue('grid-row-gap')),n=parseInt(b.top.getComputedStyle(i).getPropertyValue('grid-auto-rows'));if(!isNaN(o)&&!isNaN(n)){const a=l.getElementsByClassName('tb_predesigned_rows_image')[0].getBoundingClientRect().height+l.getElementsByClassName('tb_predesigned_rows_title')[0].getBoundingClientRect().height,d=Math.ceil((a+o)/(n+o));l.style.gridRowEnd='span '+d,5<d&&(l.dataset.masonry='done')}}},loadItems(t){this.loadingItems=!0;const i=this.currentCategory,u=O.createDocumentFragment();if(!0===this.categories.All.isLoaded||!0===this.categories[i].isLoaded)this.loadingItems=!1;else{let r=0,c=Object.keys(this.items),e=c.length;for(let d=0;d<e&&!(10<=r&&null==t);++d){let a=this.items[c[d]],e=''!==t&&new RegExp(t,'i');if(e&&e.test(a.title)){let n=a.category.split(',');if('All'===i||-1!==n.indexOf(i)){delete this.items[c[d]];let i='';for(let e=0,t=n.length;e<t;++e)i+=this.categories[n[e]].hash;let e=O.createElement('div'),t=O.createElement('figure'),s=O.createElement('div'),l=new Image,o=O.createElement('a');e.className='predesigned_row '+i,e.draggable=!0,e.setAttribute('data-slug',a.slug),t.className='tb_predesigned_rows_image',s.className='tb_predesigned_rows_title',s.textContent=l.alt=l.title=a.title,l.src=void 0===a.thumbnail||''===a.thumbnail?'https://placeholdit.imgix.net/~text?txtsize=24&txt='+encodeURI(a.title)+'&w=181&h=77':a.thumbnail,l.width=500,l.height=300,o.href='#',o.className='tf_plus_icon add_module_btn tb_disable_sorting',o.dataset.type='predesigned',t.appendChild(l),t.appendChild(o),e.appendChild(t),e.appendChild(s),u.appendChild(e),++r}}}this.categories[i].isLoaded=r<10&&void 0===t}return u},setData(e){this.items=e;const l=[],i=O.createDocumentFragment(),s=this;for(let e=0,t=this.items.length;e<t;++e){let i=this.items[e].category.split(','),s='';for(let t=0,e=i.length;t<e;++t){let e=D.hash(i[t]);-1===l.indexOf(i[t])&&(l.push(i[t]),this.categories[i[t]]={hash:'tb'+e}),s+=' tb'+e}}l.sort();for(let t=0,e=l.length;t<e;++t){let e=O.createElement('li');e.setAttribute('data-slug',D.hash(l[t])),e.textContent=l[t],i.appendChild(e)}let o=$('.tb_module_panel_container .tb_ui_dropdown .tb_ui_dropdown_items'),n=$('.tb_predesigned_rows_container');'visual'===j.mode&&(n=n.add(j.toolbar.$el.find('.tb_predesigned_rows_container')),o=o.add(j.toolbar.$el.find('.tb_module_panel_container .tb_ui_dropdown .tb_ui_dropdown_items'))),o=o.get(),n=n.get();const a=this.loadItems();for(let t=o.length-1;-1<t;--t){o[t].appendChild(i.cloneNode(!0)),n[t].appendChild(a.cloneNode(!0));let e=n[t].getElementsByTagName('img');0<e.length?(e=e[e.length-1],$(e).one('load',function(){s.initCallback($(this).closest('.tb_predesigned_rows_container')[0],!0)})):s.initCallback(n[t],!0)}D.body.on('click','.tb_module_panel_container .tb_ui_dropdown_items li',this.filter.bind(this)),'visual'===j.mode&&$('body',R.document).on('click','.tb_module_panel_container .tb_ui_dropdown_items li',this.filter.bind(this))},initCallback:function(e,t){t&&(e.closest('.tb_module_panel_rows_wrap').addEventListener('scroll',this.scrollLoadMore.bind(this),{passive:!0}),this.is_init=!0);const i=$(e);t&&i.closest('.tb_predesigned_rows_list').removeClass('tb_busy').closest('.tb_module_panel_tab').find('.tb_ui_dropdown').css('visibility','visible'),i.parents('#tb_module_panel_dropdown').length&&this.masonry(e),this.loadingItems=!1},get(e,l){if(U.showLoader('show'),void 0!==this.rows[e])'function'==typeof l&&l(this.rows[e]);else{const t=this;$.getJSON(themifyBuilder.paths.row_template.replace('{SLUG}',e)).done(function(s){j.Utils.clearElementId(s),t.rows[e]=s,-1!==JSON.stringify(s).indexOf(j.GS.key)?$.getJSON(themifyBuilder.paths.row_template.replace('{SLUG}',e+'-gs')).done(function(t){const i={};for(let e in t)void 0!==t[e].class?i[t[e].class]=t[e]:i[e]=t[e];j.GS.setImport(i,l,s)}).fail(function(e,t,i){'function'==typeof l&&l(s)}):'function'==typeof l&&l(s)}).fail(function(e,t,i){U.showLoader('error'),alert(ThemifyConstructor.label.row_fetch_error)})}},filter(e){e.preventDefault(),e.stopPropagation();const t=$(e.currentTarget),i=t.data('slug'),s=t.closest('.tb_module_panel_tab'),l=s.find('.tb_ui_dropdown_label'),o=s.find('.predesigned_row'),n=t.text(),a=!!i&&'tb'+i;this.currentCategory=n,this.addNewItems(),l.text(n),s.find('.tb_module_panel_search_text').val(''),l.data('active',a),t.addClass('current').siblings().removeClass('current'),o.each(function(){!a||this.classList.contains(a)?$(this).show():$(this).hide()}).filter(':visible').each(function(e){(e+1)%4==0?$(this).addClass('tb_column_break'):$(this).removeClass('tb_column_break')}),j.Utils.hideOnClick(s.find('.tb_ui_dropdown_items'))},addNewItems:function(t){if(this.currentCategory=void 0!==t?'All':this.currentCategory,!this.categories[this.currentCategory].isLoaded){let e=$('.tb_module_panel_container .tb_ui_dropdown .tb_ui_dropdown_items'),i=$('.tb_predesigned_rows_container');'visual'===j.mode&&(i=i.add(j.toolbar.$el.find('.tb_predesigned_rows_container')),e=e.add(j.toolbar.$el.find('.tb_module_panel_container .tb_ui_dropdown .tb_ui_dropdown_items'))),e=e.get(),i=i.get();const s=this.loadItems(t),l=this;for(let t=e.length-1;-1<t;--t){i[t].appendChild(s.cloneNode(!0));let e=i[t].getElementsByTagName('img');0<e.length?(e=e[e.length-1],$(e).one('load',function(){l.initCallback($(this).closest('.tb_predesigned_rows_container')[0])})):l.initCallback(i[t])}}},scrollLoadMore:function(e){if(!this.loadingItems&&!0!==this.categories[this.currentCategory].isLoaded){const t=e.target,i=Math.max(t.scrollHeight-(t.scrollTop+t.offsetHeight),0);0<i&&i<=200&&this.addNewItems()}}},pageBreakModule:{countModules(){const t='visual'===j.mode,i=t?O.getElementsByClassName('module-page-break'):O.getElementsByClassName('tb-page-break');for(let e=i.length-1;-1<e;--e)1==t?i[e].getElementsByClassName('page-break-order')[0].textContent=e+1:i[e].getElementsByClassName('page-break-overlay')[0].textContent='PAGE BREAK - '+(e+1)},get(){return[{cols:[{grid_class:'col-full first last',modules:[{mod_name:'page-break'}]}],column_alignment:'col_align_middle',styling:{custom_css_row:'tb-page-break'}}]}},common:{btn:null,is_init:null,clicked:null,init(){const o=this;let e=O.createElement('div'),t=j.toolbar.$el;e.className='tb_modules_panel_wrap',e.id='tb_module_panel_dropdown',this.btn=$(e),t=t.add(U.Lightbox.$lightbox),('visual'!==j.mode&&null!==O.querySelector('.edit-post-layout__content')?$('.edit-post-layout__content'):D.body)[0].appendChild(this.btn[0]),'visual'===j.mode&&j.toolbar.$el.find('.tb_module_types li').on('click',this.tabs.bind(this)),D.body.on('click','.tb_module_types li',this.tabs.bind(this)).on('click','.tb_column_btn_plus',this.show.bind(this)),t.on('click','.tb_clear_input',this.clear),j.toolbar.$el.find('.tb_module_panel_search_text').on('keyup',this.search.bind(this)),this.btn.on('click','.add_module_btn,.js-tb_module_panel_acc',function(e){e.preventDefault(),e.stopPropagation();let t,i=null,s=this.classList,l=this.dataset.type;o.clicked||(o.clicked=j.Instances.Builder[j.builderIndex].newRowAvailable(1,!0),i=!0),'module'===l?(t=o.clicked.hasClass('tb_module_btn_plus')?o.clicked.parent():o.clicked.closest('.module_column').find('.tb_holder').last(),j.toolbar.Panel.add_module(e,t)):'row'===l?(t=o.clicked.hasClass('tb_module_btn_plus')?o.clicked.parent():o.clicked.closest('.module_column').find('.tb_holder').first(),j.toolbar.Panel.click_add_sub_row(e,t)):s.contains('js-tb_module_panel_acc')?j.toolbar.toggleAccordion(e):'predesigned'!==l&&'page_break'!==l||(t=o.clicked.closest('.module_row'),'page_break'===l?j.toolbar.Panel.click_add_page_break(e,t):j.toolbar.preDesignedRows.get($(e.currentTarget).closest('.predesigned_row').data('slug'),function(e){j.Mixins.Builder.rowDrop(e,i?t:$('<div>').insertAfter(t),!0)})),s.contains('js-tb_module_panel_acc')||o.hide(!0)}).on('keyup','.tb_module_panel_search_text',this.search.bind(this)).on('click','.tb_clear_input',this.clear)},run(){this.btn[0].insertAdjacentHTML('beforeend',j.toolbar.el.querySelector('#tb_module_panel').innerHTML),this.btn.find('.tb_module').show();const e=this.btn.find('.tb_module_types').closest('div')[0];e.parentNode.parentNode.insertBefore(e,e.parentNode),e.parentNode.removeChild(e.nextElementSibling),this.btn.find('.tb_compact_tabs').removeClass('tb_compact_tabs').find('.tb_ui_dropdown_items').removeClass('tb_ui_dropdown_items'),this.btn.find('.tb_module_panel_search_text').val(''),j.Mixins.Builder.updateModuleSort(this.btn[0]),this.is_init=!0},tabs(e){e.preventDefault(),e.stopPropagation();const t=$(e.currentTarget),i=t.closest('ul'),s=t.data('target'),l=t.closest('.tb_modules_panel_wrap'),o=(l.find('.'+t.data('hide')).hide(),l.find('.'+s)),n=l.find('.tb_no_content'),a=(0<o.length?(n.hide(),o.show()):n.show(),t.closest('li').addClass('current').siblings().removeClass('current'),l.find('.tb_module_panel_search_text').val('').focus().trigger('keyup'),$(O).triggerHandler('tb_panel_tab_'+s,l),i.parent().find('.tb_ui_dropdown_label'));0<a.length&&a.text(t.text()),j.Utils.hideOnClick(i)},show(e,t){e.preventDefault(),e.stopPropagation(),!j.activeModel&&R.document.body.classList.contains('tb_standalone_lightbox')&&U.Lightbox.close(),null===this.is_init&&this.run(),this.clicked&&this.clicked[0].classList.remove('clicked'),this.clicked=t||$(e.currentTarget);const i=this.clicked.offset(),s='visual'!==j.mode&&$('.edit-post-layout__content');let l=D.body,o=i.left+this.clicked.width()/2,n=i.top;!1!==s&&0<s.length&&(n+=s.scrollTop()-70,o=s.width()/2),(o-=this.btn.outerWidth()/2)<0&&(o=0),this.btn[0].classList.toggle('tb_subrow_open',0<this.clicked.parents('.sub_column').length),this.btn.css({top:n,left:o}).show(),this.resize();const a=this.btn[0].getElementsByClassName('tb_predesigned_rows_container')[0];if(a.closest('.tb_module_panel_rows_wrap').addEventListener('scroll',j.toolbar.preDesignedRows.scrollLoadMore.bind(j.toolbar.preDesignedRows),{passive:!0}),'visual'===j.mode&&(l=l.add($('body',R.document)),'desktop'!==j.activeBreakPoint&&($('body',R.document).height(O.body.scrollHeight+this.btn.outerHeight(!0)),D.body.css('padding-bottom',180))),l.addClass('tb_panel_dropdown_openend'),this.clicked.addClass('clicked'),'desktop'===j.activeBreakPoint&&setTimeout(function(){this.btn.find('.tb_module_panel_search_text').focus()}.bind(this),50),this.hide(),j.ActionBar.clear(),null!==j.activeModel){const r=U.Lightbox.$lightbox[0].getElementsByClassName('builder_save_button')[0];void 0!==r&&r.click()}let d=a.getElementsByTagName('img');0<d.length?(d=d[d.length-1],$(d).one('load',function(){j.toolbar.preDesignedRows.masonry(a)})):j.toolbar.preDesignedRows.masonry(a),D.trigger('disableInline')},resize(){null!==this.btn&&j.Utils.addViewPortClass(this.btn[0])},hide(e){const t=this;function i(){if(!0===e||!t.btn.is(':hover')){let e=D.body;null!==t.btn&&(t.btn.hide().css('width',''),t.clicked&&t.clicked[0].classList.remove('clicked'),t.clicked=null),$(O).off('click',i),$(R.document).off('click',i),'visual'===j.mode&&(e=e.add($('body',R.document)),'desktop'!==j.activeBreakPoint&&($('body',R.document).height(O.body.scrollHeight),D.body.css('padding-bottom',''))),e.removeClass('tb_panel_dropdown_openend')}}!0===e?i():('visual'===j.mode&&$(R.document).on('click',i),$(O).on('click',i))},search(e){const t=$(e.currentTarget),i=t.closest('.tb_modules_panel_wrap'),s=i.find('.tb_module_types .current').first().data('target'),l=t.val().trim();let o=!1,n=!1,a=!1,d=!1,r=!1;if('tb_module_panel_modules_wrap'===s?(o=i.find('.tb_module'),a=!0):'tb_module_panel_rows_wrap'===s&&j.toolbar.preDesignedRows.is_init?(j.toolbar.preDesignedRows.addNewItems(l),n=i.find('.tb_ui_dropdown_label').data('active'),o=i.find('.predesigned_row'),r=!0):'tb_module_panel_library_wrap'===s&&(o=i.find('.tb_library_item'),n=i.find('.tb_library_types .current').data('target'),d=!0),!1!==o){const c=''===l,u=!c&&new RegExp(l,'i');o.each(function(){if(n&&!this.classList.contains(n))return!0;let e=a?$(this).find('.module_name'):d?$(this).find('.tb_library_item_inner span'):$(this).find('.tb_predesigned_rows_title'),t=c||u.test(e.text())?'':'none';if(!t){let e=this.closest('.tb_module_category_content');e&&(e.parentNode.style.display='')}this.style.display=t}),i[0].classList.toggle('tb_module_panel_searching',!c),a?i.find('.tb_module_category_content').each(function(){this.parentNode.style.display=0===$(this).find('.tb_module:visible').length?'none':''}):r&&j.toolbar.preDesignedRows.masonry(i[0].getElementsByClassName('tb_predesigned_rows_container')[0])}},clear(e){e.preventDefault(),e.stopPropagation();const t=$(this).parent().children('input').first();0<t.length&&(t.val(''),t[0].hasAttribute("data-search")?t.trigger('keyup').focus():(t.trigger('change'),D.triggerEvent(t[0],'change')))}},help:{init(){$('.tb_help_btn',j.toolbar.$el).on('click',this.show.bind(this))},show(e){e.preventDefault(),e.stopPropagation();const i=this,t=function(e){R.document.body.insertAdjacentHTML('beforeend',e);const t=$('#tb_help_lightbox',R.document.body);$('.tb_help_tab_link',t).on('click',i.mainTabs.bind(i)),$('.tb_player_btn',t).on('click',i.play.bind(i)),$('.tb_help_menu a',t).on('click',i.tabs.bind(i)),$('.tb_close_lightbox',t).on('click',i.close.bind(i)),t.slideDown()};let s=!1;U.showLoader('show'),R.Themify.LoadCss(themifyBuilder.builder_url+'/css/editor/help-lightbox.css',null,null,null,function(){s||t(s),s=!0}),$.ajax({type:'POST',url:themifyBuilder.ajaxurl,data:{tb_load_nonce:themifyBuilder.tb_load_nonce,action:'tb_help'},complete(){U.showLoader('spinhide')},success(e){s?t(e):s=e}})},play(e){e.preventDefault(),e.stopPropagation();const t=$(e.currentTarget).closest('a'),i=t.prop('href'),s=O.createElement('iframe');s.setAttribute('frameborder','0'),s.setAttribute('allow','autoplay; fullscreen'),s.setAttribute('src',i+'?rel=0&showinfo=0&autoplay=1&enablejsapi=1&html5=1&version=3'),t.replaceWith(s)},tabs(e){e.preventDefault(),e.stopPropagation();const t=$(e.currentTarget),i=$('.tb_help_video_wrapper',R.document),s=i.find(t.attr('href')),l=s.find('.tb_player_btn');i.find('.tb_player_wrapper').removeClass('current').hide(),s.addClass('current').show(),t.closest('li').addClass('current').siblings().removeClass('current'),this.stopPlay(),0<l.length?l.trigger('click'):this.startPlay()},execute(e,t){e.contentWindow.postMessage('{"event":"command","func":"'+t+'","args":""}','*')},stopPlay(){const t=this;$('.tb_player_wrapper',R.document).each(function(){if(!this.classList.contains('current')){let e=$(this).find('iframe');0<e.length&&t.execute(e[0],'pauseVideo')}})},startPlay(){const e=$('.tb_player_wrapper.current',R.document).find('iframe');0<e.length&&this.execute(e[0],'playVideo')},close(e,t){e.preventDefault(),e.stopPropagation(),$(e.currentTarget).closest('#tb_help_lightbox').slideUp('normal',function(){$(this).next('.tb_overlay').remove(),$(this).remove(),t&&t()})},mainTabs(e){e.preventDefault(),e.stopPropagation();const t=$(e.currentTarget),i=$('.tb_help_lightbox_inner_wrapper',R.document);t.hasClass('tb_help_active_tab')||(i.find('.tb_help_active_tab').removeClass('tb_help_active_tab'),t.addClass('tb_help_active_tab'),i.attr('data-active-tab',t.data('type')))}},deviceSwitcher(e){const t=e.target,i=t.parentNode.previousElementSibling;i.classList.contains('tb_breakpoint_switcher')&&(e.tb_device=[t.dataset.height,t.dataset.width],e.target=i,e.currentTarget=i,this.breakpointSwitcher(e))},breakpointSwitcher(i){i.preventDefault(),i.stopPropagation();let s='desktop',l=$('body',R.document);const t=this,e=i.currentTarget,o='visual'===j.mode&&j.iframe[0].classList.contains('tb_resizing_start'),n=j.activeBreakPoint,a=function(){t.responsive_grids(s,n);const e=function(){j.Utils.setCompactMode(O.getElementsByClassName('module_column')),l.removeClass('tb_start_animate tb_start_change_mode').toggleClass('tb_responsive_mode','desktop'!==s).removeClass('builder-breakpoint-'+n).addClass('builder-breakpoint-'+s),D.body.triggerHandler('themify_builder_change_mode',[n,s]),'visual'===j.mode&&(j.iframe[0].style.willChange='',setTimeout(function(){'desktop'!==j.activeBreakPoint?j.Utils.calculateHeight():R.document.body.style.height='',!o&&j.scrollTo&&($(b).add(R.document).scrollTop(j.scrollTo.offset().top),j.scrollTo=!1),D.trigger('tf_isotop_layout')},150)),j.ActionBar.disable=j.clearOnModeChange=null};'visual'===j.mode?j.Utils._onResize(!0,function(){t.iframeScroll('desktop'!==s),j.ActionBar.hoverCid=null,j.EdgeDrag.clearEdges(),setTimeout(e,o?1:100)}):e()};if(e.classList.contains('breakpoint-tablet')?s='tablet':e.classList.contains('breakpoint-tablet_landscape')?s='tablet_landscape':e.classList.contains('breakpoint-mobile')&&(s='mobile'),void 0!==i.tb_device||!D.body[0].classList.contains('builder-breakpoint-'+s)){let e,t;if(e='desktop'!==s?void 0!==i.tb_device&&i.tb_device[1]?i.tb_device[1]:j.Utils.getBPWidth(s)-1:'',j.isPreview){const r={tablet_landscape:768,tablet:1024,mobile:667};void 0!==r[s]&&(t=void 0!==i.tb_device&&i.tb_device[0]?i.tb_device[0]:r[s])}if(n===s&&void 0!==i.originalEvent&&(e&&e+'px')===j.iframe[0].style.width&&(t&&t+'px')===j.iframe[0].style.height)return l.removeClass('tb_start_animate tb_start_change_mode'),!1;j.ActionBar.disable=!0;const d=[];if('visual'===j.mode){if(null===j.clearOnModeChange&&j.ActionBar.clear(),!o&&!j.isPreview){const c=j.Instances.Builder[0].el.children,u=b.innerHeight,_=function(e){if(null!=e){const t=e.getBoundingClientRect();(t.bottom<0&&t.top<0||t.top>u)&&(e.style.display='none',d.push(e))}};for(let e=c.length-1;-1<e;--e)_(c[e]);_(O.getElementById('headerwrap')),_(O.getElementById('footerwrap'))}l=l.add(D.body)}if(j.activeBreakPoint=s,l.addClass('tb_start_animate tb_start_change_mode'),'visual'===j.mode){j.iframe[0].style.willChange='width';const m=R.document.getElementsByClassName('tb_toolbar_zoom_menu')[0];if(m.classList.remove('tb_toolbar_zoom_active'),m.getElementsByClassName('tb_toolbar_zoom_menu_toggle')[0].dataset.zoom=100,'tablet_landscape'===s&&U.Lightbox.dockMode.get()){const h=$('.tb_workspace_container',R.document).width();h<e&&(e=h)}j.iframe[0].parentNode.classList.remove('tb_zoom_bg'),o?a():(R.document.body.offsetHeight,j.iframe.one('transitionend',function(){for(let e=d.length-1;-1<e;--e)d[e].style.display='';setTimeout(a,10)}),j.iframe[0].style.height=t?t+'px':'',e&&j.iframe[0].style.width===e+'px'?a():j.iframe[0].style.width=e?e+'px':'')}else a()}},iframeScroll(e){const t=$(R.document);t.off('scroll.themifybuilderresponsive'),e&&t.on('scroll.themifybuilderresponsive',function(){b.scrollTo(0,$(this).scrollTop())})},responsive_grids(a,d){D.LoadCss(tbLocalScript.builder_url+'/css/modules/responsive-column.css');const r=O.querySelectorAll('.row_inner,.subrow_inner'),c='desktop'===a,u=c||'desktop'===d;for(let n=r.length-1;-1<n;--n){let o=r[n].getAttribute('data-basecol');if(null!==o){let i=r[n].children,e=r[n].dataset['col_'+a],t=i[0],s=i[i.length-1];if(!c){if('desktop'!==d){r[n].classList.remove('tb_3col');let e=r[n].getAttribute('data-col_'+d);e&&r[n].classList.remove(e.replace('tb_3col','').replace('mobile','column').replace('tablet','column').trim())}if(e&&'-auto'!==e&&e!==a+'-auto'){let i=r[n].getAttribute('data-col_'+a);if(i){r[n].classList.add('tb_grid_classes','col-count-'+o);for(let e=0,t=(i=i.split(' ')).length;e<t;++e)r[n].classList.add(i[e].replace('mobile','column').replace('tablet','column').trim())}}else r[n].classList.remove('tb_grid_classes','col-count-'+o)}if(u)for(let t=0,e=i.length;t<e;++t){let e=i[t].dataset.w;void 0!==e&&(i[t].style.width=c?e+'%':'')}let l=r[n].getAttribute('data-'+a+'_dir');'rtl'===l?(t.classList.remove('first'),t.classList.add('last'),s.classList.remove('last'),s.classList.add('first'),r[n].classList.add('direction-rtl')):(t.classList.remove('last'),t.classList.add('first'),s.classList.remove('first'),s.classList.add('last'),r[n].classList.remove('direction-rtl'))}}},Panel:{el:null,init(){this.el=j.toolbar.$el.find('.tb_toolbar_add_modules_wrap'),this.el.on('click','.add_module_btn',this.initEvents.bind(this)),this.compactToolbar(),'visual'===j.mode&&U.Lightbox.dockMode.setDoc()},initEvents(e){e.preventDefault(),e.stopPropagation();const t=e.currentTarget.dataset.type;'module'===t?this.add_module(e):'row'===t?this.click_add_sub_row(e):'page_break'===t?this.click_add_page_break(e):'predesigned'===t&&j.toolbar.preDesignedRows.get(e.currentTarget.closest('.predesigned_row').dataset.slug,function(e){const t=j.Instances.Builder[j.builderIndex].$el.find('.module_row').last();j.Mixins.Builder.rowDrop(e,$('<div>').insertAfter(t),!0)})},setFocus(){j.toolbar.el.getElementsByClassName('tb_module_panel_search_text')[0].focus()},add_module(e,t){e.preventDefault(),e.stopPropagation(),t&&0!==t.length||(t=j.Instances.Builder[j.builderIndex].newRowAvailable(1,!0).find('.tb_holder').first()),j.Mixins.Builder.moduleDrop($(e.currentTarget).closest('.tb_module'),t)},click_add_sub_row(e,t){e.preventDefault(),e.stopPropagation();const i=!!t,s=$(e.currentTarget).closest('.tb_row_grid').data('slug');let l=!1;0===(t=t||j.Instances.Builder[j.builderIndex].$el.find('.module_row').last()).length&&(t=j.Instances.Builder[j.builderIndex].$el.find('#tb_add_container'),l=!0),i?t.hasClass('tb_module_front')?j.Mixins.Builder.subRowDrop(s,$('<div>').insertAfter(t)):j.Mixins.Builder.subRowDrop(s,$('<div>').appendTo(t)):j.Mixins.Builder.rowDrop(j.Utils.grid(s),!1===l?$('<div>').insertAfter(t):$('<div>').insertBefore(t),!0,!0)},click_add_page_break(e,t){e.preventDefault(),e.stopPropagation(),t=t||j.Instances.Builder[j.builderIndex].$el.find('.module_row').last(),j.Mixins.Builder.rowDrop(j.toolbar.pageBreakModule.get(),$('<div>').insertAfter(t),!0),j.toolbar.pageBreakModule.countModules()},compactToolbar(){const e='visual'===j.mode?850:750;function t(){j.toolbar.$el.outerWidth()<e?R.document.body.classList.add('tb_compact_toolbar'):R.document.body.classList.remove('tb_compact_toolbar'),j.toolbar.common.resize()}$(R).on('resize.compact',t),'visual'===j.mode?R.Themify.on('themify_builder_ready',t,!0):t()}},toggleFavoriteModule(){var e=$(this),t=e.closest('.tb_module'),l=e.parent().data('module-slug');$.ajax({type:'POST',url:themifyBuilder.ajaxurl,dataType:'json',data:{action:'tb_module_favorite',module_name:l,module_state:+!t.hasClass('favorited')},beforeSend(e){!function i(a,s){function e(){if(a.length){var e;s&&(e=0<a.closest('#tb_module_panel_dropdown').length?j.toolbar.$el:$('#tb_module_panel_dropdown')),a.removeAttr('style');const o=a.data('categories').split(','),n=a.closest('.tb_module_panel_modules_wrap'),t=n.find('.tb_module_category_content[data-category="favorite"]');if(a.hasClass('favorited')){for(let t=o.length-1;-1<t;--t){let e=n.find('.tb_module_category_content[data-category="'+o[t]+'"]').parent();e.find('.tb_module.tb-module-'+l).css({opacity:0,transform:'scale(0.5)'}).remove(),e.find('.tb_module').length||e.css({display:'none'})}t.parent().css({display:'block'}),a.clone().css({opacity:0,transform:'scale(0.5)'}).appendTo(t).css({opacity:1,transform:'scale(1)'})}else for(let l=o.length-1;-1<l;--l){let e=n.find('.tb_module_category_content[data-category="'+o[l]+'"]'),t=a.clone().css({opacity:0,transform:'scale(0.5)'}),i=null,s=parseInt(t[0].dataset.index);for(;0!=--s&&!(0<(i=e.find('[data-index="'+s+'"]')).length););i?t.insertAfter(i):e.prepend(t),e.parent().css({display:'block'}),t.css({opacity:1,transform:'scale(1)'})}s&&i(e.find('.tb_module.tb-module-'+l),!1),a.remove(),t.find('.tb_module').length||t.parent().css({display:'none'})}}a.length&&!a.is(':visible')?(a.toggleClass('favorited'),e()):a.css({opacity:0,transform:'scale(0.5)'}).one('transitionend',function(){a.toggleClass('favorited').one('transitionend',e)})}(t,!0)}})},zoom(e){if(e.preventDefault(),'desktop'!==j.activeBreakPoint)return!0;function t(){j.Utils._onResize(!0)}let i,s=$(e.currentTarget),l=s.data('zoom'),o=$('.tb_iframe',R.document),n=s.closest('.tb_toolbar_zoom_menu');if(s.hasClass('tb_toolbar_zoom_menu_toggle')?(l='100'==l?50:100,s.data('zoom',l),i=s.next('ul').find('[data-zoom="'+l+'"]')):(i=s,n.find('.tb_toolbar_zoom_menu_toggle').data('zoom',l)),o.removeClass('tb_zooming_50 tb_zooming_75'),i.parent().addClass('selected-zoom-size').siblings().removeClass('selected-zoom-size'),'50'==l||'75'==l){const a='50'==l?2:1.25;o.addClass('tb_zooming_'+l).one('transitionend',t).parent().addClass('tb_zoom_bg').css('height',Math.max(R.innerHeight*a,600)),n.addClass('tb_toolbar_zoom_active'),j.zoomMeta.isActive=!0,j.zoomMeta.size=l,D.body.addClass('tb_zoom_only')}else o.addClass('tb_zooming_'+l).one('transitionend',t).parent().css('height',''),n.removeClass('tb_toolbar_zoom_active'),j.zoomMeta.isActive=!1,D.body.removeClass('tb_zoom_only')},previewBuilder(e){if(e.preventDefault(),$(e.currentTarget).toggleClass('tb_toolbar_preview_active'),j.isPreview=!j.isPreview,j.isPreview||(j.iframe[0].style.height=''),D.body.toggleClass('tb_preview_only themify_builder_active'),$('body',R.document).toggleClass('tb_preview_parent'),j.isPreview){const s=O.getElementsByClassName('row_inner');for(let i=s.length-1;-1<i;--i)if(s[i].classList.contains('col-count-1')&&0===s[i].getElementsByClassName('active_module').length){let e=s[i].getElementsByClassName('module_column')[0],t=j.Models.Registry.lookup(e.getAttribute('data-cid'));if(t&&0===Object.keys(t.get('styling')).length){let e=s[i].closest('.module_row'),t=j.Models.Registry.lookup(e.getAttribute('data-cid'));t&&0===Object.keys(t.get('styling')).length&&e.classList.add('tf_hide')}}}else $('.tf_hide.module_row').removeClass('tf_hide');'visual'===j.mode&&(!R.document.body.classList.contains('tb_panel_minimized')&&U.Lightbox.dockMode.get()&&j.Utils._onResize(!0),j.isPreview||'desktop'===j.activeBreakPoint||(e.tb_device='mobile'===j.activeBreakPoint?[tbLocalScript.breakpoints[j.activeBreakPoint],'']:tbLocalScript.breakpoints[j.activeBreakPoint],e.currentTarget=e.target=j.toolbar.el.getElementsByClassName('breakpoint-'+j.activeBreakPoint)[0],this.breakpointSwitcher(e))),j.vent.trigger('dom:preview')},toggleAccordion(e){$(e.currentTarget).closest('.tb_module_panel_tab_acc_component').toggleClass('tb_collapsed')},closeFloat(e){e&&(e.preventDefault(),e.stopPropagation(),localStorage.setItem('tb_panel_closed',!0)),R.document.body.classList.add('tb_panel_closed')},openFloat(e){e&&(e.preventDefault(),e.stopPropagation(),localStorage.removeItem('tb_panel_closed')),R.document.body.classList.remove('tb_panel_closed'),j.toolbar.common.hide(!0)}}),j.Forms={Data:{},Validators:{},parseSettings(i,e){const t=i.classList,s=e?i.getAttribute('data-input-id'):i.getAttribute('id');if(!t.contains('tb_row_js_wrapper')){let e=i.closest('.tb_field');if(null!==e&&!e.classList.contains('_tb_hide_binding')&&('none'!==e.style.display||-1===e.className.indexOf('tb_group_element_'))&&(e=e.parentNode).classList.contains('tb_multi_fields')&&e.parentNode.classList.contains('_tb_hide_binding'))return!1}let o='';if(t.contains('tb_lb_wp_editor'))if('undefined'!=typeof tinyMCE){const l=i.id,n=tinyMCE.get(l);o=null!==n?!1===n.hidden?n.getContent():switchEditors.wpautop(tinymce.DOM.get(l).value):i.value}else o=i.value;else if(t.contains('themify-checkbox')){const a=[],d=i.getElementsByClassName('tb-checkbox'),r=t.contains('tb_switcher');for(let e=0,t=d.length;e<t;++e)!0!==r&&!0!==d[e].checked||''===d[e].value||a.push(d[e].value);o=0<a.length?a.join('|'):!!r&&''}else if(t.contains('themify-layout-icon'))o=void 0!==(o=i.getElementsByClassName('selected')[0])?o.id:'';else if(t.contains('tb_search_input')){o=i.getAttribute('data-value');let e=i.closest('.tb_input'),t=e.getElementsByClassName('query_category_multiple')[0];t&&(''!==(t=void 0===t?'':t.value.trim())?o=t+'|'+(-1!==t.indexOf(',')?'multiple':'single'):o+='|single')}else if(t.contains('tb_radio_input_container')){const c=i.getElementsByTagName('input');let t=null;for(let e=c.length-1;-1<e;--e)if(!0===c[e].checked){t=c[e];break}null===t||'desktop'!==j.activeBreakPoint&&t.classList.contains('responsive_disable')||(o=t.value)}else if(t.contains('tb_search_container'))o=i.previousElementSibling.dataset.value;else if(t.contains('tb_row_js_wrapper')){o=[];const u=i.getElementsByClassName('tb_repeatable_field_content');for(let s=0,e=u.length;s<e;++s){let i=u[s].getElementsByClassName('tb_lb_option_child');o[s]={};for(let t=0,e=i.length;t<e;++t){let e=this.parseSettings(i[t],!0);e&&(o[s][e.id]=e.v)}}}else if(t.contains('module-widget-form-container'))o=$(i).find(':input').themifySerializeObject();else if(t.contains('tb_widget_select'))o=void 0!==(o=i.getElementsByClassName('selected')[0])?o.dataset.value:'';else if(t.contains('tb_sort_fields_parent')){const _=i.children;o=[];for(let i=0,e=_.length;i<e;++i){let t=_[i].getAttribute('data-type');if(t){let e=_[i].getElementsByClassName('tb_sort_field_dropdown')[0],s={type:t,id:_[i].getAttribute('data-id')};if(void 0!==e){s.val={};let i=e.getElementsByClassName('tb_lb_sort_child');for(let t=i.length-1;-1<t;--t){let e=this.parseSettings(i[t],!0);e&&(s.val[e.id]=e.v)}}else{let e=_[i].getElementsByTagName('input')[0],t=e.value;''!==t&&(s.val=JSON.parse(t))}o.push(s)}}0===o.length&&(o='')}else if(t.contains('tb_accordion_fields')){const m=i.children;o={};for(let l=0,e=m.length;l<e;++l){let s=m[l].getAttribute('data-id');if(s){let t=m[l].getElementsByTagName('input')[0],e=m[l].getElementsByClassName('tb_accordion_fields_options')[0],i={};if(void 0!==e)i.val=this.serialize(e,null,!0);else{let e=t.value;''!==e&&(i.val=JSON.parse(e))}o[s]=i}}}else if(t.contains('tb_toggleable_fields')){const h=i.children;o={};for(let l=0,e=h.length;l<e;++l){let s=h[l].getAttribute('data-id');if(s){let t=h[l].getElementsByTagName('input')[0],e=h[l].getElementsByClassName('tb_toggleable_fields_options')[0],i={on:h[l].getElementsByClassName('tb_switcher')[0].getElementsByClassName('toggle_switch')[0].value};if(void 0!==e)i.val=this.serialize(e,null,!0);else{let e=t.value;''!==e&&(i.val=JSON.parse(e))}o[s]=i}}}else if('SELECT'===i.nodeName&&i.multiple){o=[];for(let e=i.selectedOptions.length-1;-1<e;--e)o.push(i.selectedOptions[e].value)}else if(o=i.value,void 0!==b.tbpDynamic&&s===tbpDynamic.field_name){if(''===o)return!1;'string'==typeof o&&(o=JSON.parse(o))}else{if(s===j.GS.key&&'desktop'!==j.activeBreakPoint)return!1;if(''!==o)if('builder_content'===s)'string'==typeof o&&(o=JSON.parse(o));else{const g=i.getAttribute('data-opacity');null!==g&&''!==g&&1!=g&&'0.99'!=g&&(o+='_'+g)}}return{id:s,v:o=void 0!==o&&null!==o?o:''}},serialize(e,i,s){const l={},t='object'==typeof e?e:R.document.getElementById(e);if(s=s||!1,null!==t){const o=t.getElementsByClassName(s?'tb_lb_option_child':'tb_lb_option');for(let t=o.length-1;-1<t;--t){let e=this.parseSettings(o[t],s);!1===e||!0!==i&&''===e.v||(l[e.id]=e.v)}}return l},LayoutPart:{cache:[],undo:null,old_id:null,isReload:null,id:null,init:!1,html:null,el:null,options:null,isSaved:null,scrollTo(e,t){j.scrollTo=j.Forms.LayoutPart.el},edit(e){if(j.ActionBar.disable=!0,U.showLoader('show'),O.body.classList.add('tb_layout_part_edit'),null!==j.activeModel){const i=U.Lightbox.$lightbox[0].getElementsByClassName('builder_save_button')[0];void 0!==i&&i.click()}R.document.body.classList.add('tb_layout_part_edit');const l=this,o=$(e).closest('.active_module'),n=o.find('.themify_builder_content'),a=U.templateCache.get('tmpl-small_toolbar');function t(e){j.ActionBar.clear(),O.getElementById('themify_builder_content-'+themifyBuilder.post_ID).insertAdjacentHTML('afterbegin','<div class="tb_overlay"></div>'),o.addClass('tb_active_layout_part').closest('.row_inner').find('.active_module').each(function(){this.classList.contains('tb_active_layout_part')||this.insertAdjacentHTML('afterbegin','<div class="tb_overlay"></div>')});const t='themify_builder_content-'+l.id,i=[],s=(l.html=o[0].innerHTML,themifyBuilder.post_ID=ThemifyStyles.builder_id=l.id,o[0].insertAdjacentHTML('afterbegin',a.replace('#postID#',l.id)),$('.'+t).each(function(){$(this).closest('.active_module').find('.themify-builder-generated-css').first().prop('disabled',!0)}),j.Instances.Builder[0].el.classList.remove('tb_active_builder'),o.removeClass('active_module module').closest('.tb_holder').removeClass('tb_holder').addClass('tb_layout_part_parent').closest('.module_row').addClass('tb_active_layout_part_row'),n.attr('id',t).removeClass('not_editable_builder').addClass('tb_active_builder').empty(),l.el=o,j.id=l.id,j.builderIndex=1,j.Instances.Builder[j.builderIndex]=new j.Views.Builder({el:n,collection:new j.Collections.Rows(e),type:j.mode}),j.Instances.Builder[j.builderIndex].render().el.querySelectorAll('[data-cid]'));for(let e=0,t=s.length;e<t;++e)i[s[e].dataset.cid]=1;j.bootstrap(i,function(){o.triggerHandler('tb_layout_part_before_init'),j.activeModel=null,j.Utils.runJs(n),j.id=!1,D.body.on('themify_builder_change_mode',l.scrollTo),j.hasChanged=null,j.Instances.Builder[j.builderIndex].$el.triggerHandler('tb_init'),o.find('.tb_toolbar_save').on('click',l.save.bind(l)),o.find('.tb_toolbar_close_btn').on('click',l.close.bind(l)),o.find('.tb_load_layout').on('click',j.Views.Toolbar.prototype.loadLayout),o.find('.tb_toolbar_import ul a').on('click',j.Views.Toolbar.prototype.import),U.showLoader('hide'),l.init=!1,l.undo=j.undoManager.stack,j.undoManager.btnUndo=o[0].getElementsByClassName('tb_undo_btn')[0],j.undoManager.btnRedo=o[0].getElementsByClassName('tb_redo_btn')[0],j.undoManager.reset(),o.find('.tb_undo_redo').on('click',function(e){j.undoManager.do_change(e)}),j.ActionBar.disable=j.ActionBar.hoverCid=null,o.triggerHandler('tb_layout_part_after_init')})}this.id=n.data('postid'),this.old_id=themifyBuilder.post_ID,this.init=!0,this.isSaved=null,void 0!==this.cache[this.id]?t(this.cache[this.id]):$.ajax({type:'POST',dataType:'json',url:themifyBuilder.ajaxurl,data:{action:'tb_layout_part_swap',nonce:themifyBuilder.tb_load_nonce,id:l.id},success(e){e.data&&(l.cache[l.id]=e.data,e.gs&&(j.GS.styles=$.extend(!0,{},e.gs,j.GS.styles)),t(e.data))}})},close(e){if(e.preventDefault(),e.stopPropagation(),!j.hasChanged&&!j.undoManager.hasUndo()||null!==this.isSaved||confirm(themifyBuilder.i18n.layoutEditConfirm)){null!==j.activeModel&&U.Lightbox.close();const o=this;let l=this.el.find('.themify_builder_content');if(null!==this.options){U.showLoader('show');const t=j.Models.Registry.lookup(this.el.data('cid')),n=(this.cache[this.id]=this.options,function(e,t,i){if(-1!==i.data.indexOf('tb_load_module_partial',3))if($(this).off('ajaxComplete',n),200===t.status){o.el=j.liveStylingInstance.$liveStyledElmt;let t=(l=o.el.find('.themify_builder_content'))[0].innerHTML,i='';o.el.find('.themify-builder-generated-css').each(function(){i+=this.outerHTML}),$('.themify_builder_content-'+o.id).each(function(){const e=$(this).closest('.module');e.children('link.themify-builder-generated-css').remove(),''!==i&&e[0].insertAdjacentHTML('afterbegin',i),this.innerHTML=t,j.Utils.runJs($(this))}),U.showLoader('hide'),s()}else U.showLoader('error')}),i=($(O).ajaxComplete(n),$.extend(!0,{},t.get('mod_settings')));i.unsetKey=!0,t.trigger('custom:preview:refresh',i)}else this.el[0].innerHTML=o.html,s(),$('.themify_builder_content-'+o.id).each(function(){$(this).closest('.active_module').find('.themify-builder-generated-css').removeAttr('disabled')}),j.Utils.runJs(l);function s(){o.el.removeClass('tb_active_layout_part').addClass('active_module module').closest('.tb_layout_part_parent').addClass('tb_holder').removeClass('tb_layout_part_parent').closest('.module_row').removeClass('tb_active_layout_part_row'),$('#tb_small_toolbar',o.el).remove();const s=l[0].querySelectorAll('[data-cid]');for(let i=s.length-1;-1<i;--i){let e=s[i].dataset.cid,t=j.Models.Registry.lookup(e);t&&(t.destroy(),j.Models.Registry.remove(e))}l.removeAttr('id').addClass('not_editable_builder').removeClass('tb_active_builder'),O.body.classList.remove('tb_layout_part_edit'),R.document.body.classList.remove('tb_layout_part_edit'),$('.tb_overlay').remove(),j.undoManager.stack=o.undo,j.undoManager.index=o.undo.length-1,j.undoManager.btnUndo=j.toolbar.el.getElementsByClassName('tb_undo_btn')[0],j.undoManager.btnRedo=j.toolbar.el.getElementsByClassName('tb_redo_btn')[0],themifyBuilder.post_ID=ThemifyStyles.builder_id=o.old_id,o.undo=o.isSaved=o.old_id=o.html=o.id=o.options=o.isReload=o.el=j.Instances.Builder[j.builderIndex]=null,delete j.Instances.Builder[j.builderIndex],j.builderIndex=0,D.body.off('themify_builder_change_mode',o.scrollTo),j.undoManager.updateUndoBtns(),j.ActionBar.hoverCid=null,j.ActionBar.clear(),j.Instances.Builder[j.builderIndex].el.classList.add('tb_active_builder'),j.Instances.Builder[j.builderIndex].lastRowAddBtn()}}},save(t,i){if(t.preventDefault(),t.stopPropagation(),null!==j.activeModel){const e=U.Lightbox.$lightbox[0].getElementsByClassName('builder_save_button')[0];void 0!==e&&e.click()}if(j.undoManager.hasUndo()||null!==this.isReload||i){const s=this;this.html=null,this.old_settings=null,U.showLoader('show'),j.Utils.saveBuilder(function(e){s.options=e.data.builder_data,j.hasChanged=null,s.isSaved=!0,i&&s.close(t)})}else U.showLoader('show'),setTimeout(function(){U.showLoader('hide')},100)}},reLoad(e,t,i){const s=void 0!==e.builder_data?e.builder_data:e,l=null!==j.Forms.LayoutPart.id,o=j.builderIndex;void 0!==e.used_gs&&(j.GS.styles=$.extend(!0,{},e.used_gs,j.GS.styles));let n=null,a='';if(l||(j.Models.Registry.destroy(),j.Instances.Builder={}),'visual'===j.mode)a='#themify_builder_content-'+t,j.id=t,l||(j.liveStylingInstance.reset(),j.editing=!1,themifyBuilder.is_themify_theme&&(D.body.addClass('sidebar-none full_width'),$('#sidebar, #sidebar-alt, .page-title').remove()));else if(a='#tb_row_wrapper',themifyBuilder.is_themify_theme){const r=O.querySelector('#themify-meta-boxes .themify_field-page_layout img[alt="full_width"]');r&&r.parentNode.click()}if(l){const c=j.Instances.Builder[o].el.querySelectorAll('[data-cid]');j.Forms.LayoutPart.isReload=!0;for(let i=0,e=c.length;i<e;++i){let e=c[i].dataset.cid,t=j.Models.Registry.lookup(e);t&&(t.destroy(),j.Models.Registry.remove(e))}j.Instances.Builder[o].$el.empty()}if(j.Instances.Builder[o]=new j.Views.Builder({el:a,collection:new j.Collections.Rows(s),type:j.mode}),j.Instances.Builder[o].render(),j.undoManager.reset(),l){n=[];const u=j.Instances.Builder[o].el.querySelectorAll('[data-cid]');for(let e=0,t=u.length;e<t;++e)n[u[e].dataset.cid]=1}function d(){'visual'===j.mode&&(j.liveStylingInstance.setCss(j.Mixins.Builder.toJSON(j.Instances.Builder[o].el)),j.Utils.runJs(j.Instances.Builder[o].$el),j.id=!1),j.Instances.Builder[j.builderIndex].$el.triggerHandler('tb_init'),U.showLoader('hide'),'visual'===j.mode&&'desktop'!==j.activeBreakPoint&&($('body',R.document).height(O.body.scrollHeight),setTimeout(function(){$('body',R.document).height(O.body.scrollHeight)},2e3)),i&&i(),j.hasChanged=!0}'visual'===j.mode?j.bootstrap(n,d,void 0!==e.used_gs?e.used_gs:null):d()},isValidate(e){const l=e.getElementsByClassName('tb_must_validate'),t=l.length;if(0===t)return!0;let o=!0;for(let s=t-1;-1<s;--s){let i=l[s].getElementsByClassName('tb_lb_option')[0];if(function(e,t){const i=j.Forms.get_validator(e);return i(t)}(l[s].getAttribute('data-validation'),i.value)){i.classList.remove('tb_field_error');let t=l[s].getElementsByClassName('tb_field_error_msg');for(let e=t.length-1;-1<e;--e)t[e].parentNode.removeChild(t[e])}else{if(!i.classList.contains('tb_field_error')){let e=O.createElement('span'),t='SELECT'===i.tagName?i.parentNode:i;e.className='tb_field_error_msg',e.textContent=l[s].getAttribute('data-error-msg'),i.classList.add('tb_field_error'),t.parentNode.insertBefore(e,t.nextSibling)}o=!1}}if(!1===o){const i=U.Lightbox.$lightbox.find('[href="#'+e.getAttribute('id')+'"]')[0];i.parentNode.classList.contains('current')||i.click()}return o}},j.Utils={onResizeEvents:[],gridClass:['col-full','col2-1','col3-1','col4-1','col5-1','col6-1','col4-2','col4-3','col3-2'],_onResize(e,t){let i=$._data(b,'events'),s;if(i=i&&i.resize,$(R).off('resize.tb_visual').on('resize.tb_visual',function(e){s&&clearTimeout(s),s=setTimeout(function(){if(D.trigger('tfsmartresize'),$(b).triggerHandler('tfsmartresize'),j.zoomMeta.isActive){let e='50'==j.zoomMeta.size?2:1.25;$('.tb_workspace_container',R.document).css('height',Math.max(R.innerHeight*e,600))}},400)}),i)for(let e=0,t=i.length;e<t;++e)void 0!==i[e].handler&&this.onResizeEvents.push(i[e].handler);if($(b).off('resize'),e){const l=$.Event('resize',{type:'resize',isTrigger:!1});for(let e=0,t=this.onResizeEvents.length;e<t;++e)try{this.onResizeEvents[e].apply(b,[l,$])}catch(e){}D.trigger('tfsmartresize'),$(b).triggerHandler('tfsmartresize'),'function'==typeof t&&t()}},_addNewColumn(e,t){const i=j.Views.init_column({grid_class:e.newclass,component_name:e.component});t.appendChild(i.view.render().el)},filterClass(e){const t=e.split(' '),i=[];for(let e=t.length-1;-1<e;--e)-1!==this.gridClass.indexOf(t[e])&&i.push(t[e]);return i.join(' ')},_getRowSettings(e,t){t=t||'row';let i={},n;const s=j.Models.Registry.lookup(e.getAttribute('data-cid'));if(s){const l=e.getElementsByClassName(t+'_inner')[0],a=[];for(let s=0,o=l.children,e=o.length;s<e;++s){let i=j.Models.Registry.lookup(o[s].getAttribute('data-cid'));if(i){let l=o[s].getElementsByClassName('tb_holder')[0],e=a.push({element_id:i.get('element_id'),grid_class:this.filterClass(o[s].className)});if(--e,void 0!==l){let s=[];for(let i=0,e=(l=l.children).length;i<e;++i){let t=j.Models.Registry.lookup(l[i].getAttribute('data-cid'));if(t){n=t.get('mod_settings');let e=s.push({mod_name:t.get('mod_name'),element_id:t.get('element_id')})-1;n&&0<Object.keys(n).length&&(delete n.cid,s[e].mod_settings=n),l[i].classList.contains('active_subrow')&&(s[e]=this._getRowSettings(l[i],'subrow'))}}0<s.length&&(a[e].modules=s)}let t=parseFloat(o[s].style.width);0<t&&!isNaN(t)&&(a[e].grid_width=t),(n=i.get('styling'))&&0<Object.keys(n).length&&(delete n.cid,a[e].styling=n)}}i={element_id:s.get('element_id'),cols:a,column_alignment:s.get('column_alignment'),gutter:s.get('gutter'),column_h:s.get('column_h')};const o={gutter:'gutter-default',column_alignment:themifyBuilder.is_fullSection?'col_align_middle':'col_align_top'},d={desktop_dir:'ltr',tablet_dir:'ltr',tablet_landscape_dir:'ltr',mobile_dir:'ltr',col_tablet_landscape:'-auto',col_tablet:'-auto',col_mobile:'-auto'};for(let e in i)''!==i[e]&&null!==i[e]&&i[e]!==o[e]||delete i[e];n=s.get('styling');for(let t in d){let e=l.getAttribute('data-'+t);null===e||''===e||e===d[t]||'-auto'===d[t]&&-1!==e.indexOf('-auto')||(i[t]=e.trim())}n&&0<Object.keys(n).length&&(delete n.cid,i.styling=n)}return i},selectedGridMenu(e,t){const i=ThemifyConstructor.breakpointsReverse,s=j.Models.Registry.lookup(e.getAttribute('data-cid')),l=e.getElementsByClassName(t+'_inner')[0],o=s.get('desktop_dir'),n='row'===t?s.get('styling'):null,a=[],d={},r=l.children,c=s.get('sizes'),u=r.length;let _=s.get('gutter'),m=s.get('column_alignment'),h=s.get('column_h');c&&(_||(_='narrow'===c.desktop_gutter||'none'===c.desktop_gutter?'gutter-'+c.desktop_gutter:'gutter-default',s.set({gutter:_},{silent:!0})),!m&&c.desktop_align&&(m='center'===(m=c.desktop_align)?'col_align_middle':'end'===m?'col_align_bottom':'col_align_top',s.set({column_alignment:m},{silent:!0})),!h&&c.desktop_auto_h&&(h=!0,s.set({column_h:!0},{silent:!0}))),m=m||'col_align_top';for(let e=u-1;-1<e;--e)r[e].className=r[e].className.replace(/first|last/gi,''),1!==u&&(0===e?r[e].className+='rtl'===o?' last':' first':e===u-1&&(r[e].className+='rtl'===o?' first':' last'));a.push('col-count-'+u),d['data-basecol']=u,null!==n&&void 0!==n.row_anchor&&''!==n.row_anchor&&(e.getElementsByClassName('tb_row_anchor')[0].textContent=n.row_anchor),null!==n&&void 0!==n.custom_css_id&&''!==n.custom_css_id&&(e.getElementsByClassName('tb_row_id')[0].textContent=n.custom_css_id),'gutter-default'!==_&&a.push(_),h&&a.push('col_auto_height'),a.push(m),'ltr'!==o&&a.push('direction-rtl');for(let t=i.length-1;-1<t;--t){let e=s.get(i[t]+'_dir');if('ltr'!==e&&''!==e&&(d['data-'+i[t]+'_dir']=e),'desktop'!==i[t]){let e=s.get('col_'+i[t]);'-auto'!==e&&''!==e&&void 0!==e&&(d['data-col_'+i[t]]=e)}}for(let e=a.length-1;-1<e;--e)a[e]&&l.classList.add(a[e]);for(let e in d)l.setAttribute(e,d[e])},clear(n,t){const a=!0===(t=void 0===t?Array.isArray(n):t)?[]:{},e=void 0!==b.tbpDynamic&&tbpDynamic.field_name;for(let o in n)if(n.hasOwnProperty(o)&&'null'!==o)if(Array.isArray(n[o])){let e=this.clear(n[o],!0);0<e.length&&(!0===t?a.push(e):a[o]=e)}else if(o===e)if('{}'===n[o]||''===n[o])delete n[o],delete a[o];else{let t=n[o];for(let e in t='string'==typeof t?JSON.parse(t):t)void 0===t[e].repeatable&&(void 0===t[e].item?delete t[e]:void 0!==n[e]&&(delete n[e],delete a[e]));n[o]=a[o]=t}else if('object'==typeof n[o]){let i;if('breakpoint_mobile'===o||'breakpoint_tablet'===o||'breakpoint_tablet_landscape'===o){for(let t in i=n[o])if(void 0===i[t]||null===i[t]||''===i[t])delete i[t];else if('px'===i[t]&&-1!==t.indexOf('_unit',2)){let e=t.replace('_unit','');void 0!==i[e]&&''!==i[e]||(delete i[t],''===i[e]&&delete i[e])}}else i=this.clear(n[o],!1);i&&0<Object.keys(i).length&&(a[o]=i)}else if(null!==n[o]&&void 0!==n[o]&&''!==n[o]&&'def'!==n[o]&&''!==o&&'pixels'!==n[o]&&'default'!==n[o]&&'|'!==n[o]&&!('hide_anchor'===o&&!n[o]||'show'===n[o]&&0===o.indexOf('visibility_')||'unstick_when_condition'===o&&'hits'===n[o]||'unstick_when_pos'===o&&'this'===n[o]||'unstick_when_element'===o&&'builder_end'===n[o]||('stick_at_pos_val_unit'===o||'unstick_when_pos_val_unit'===o)&&'px'===n[o]))if('custom_parallax_scroll_speed'!==o||n[o])if('unstick_when_check'!==n[o]&&('unstick_when_check'===o||'unstick_when_check_tl'===o||'unstick_when_check_t'===o||'unstick_when_check_m'===o)||'builder_end'===n[o]&&('unstick_when_element'===o||'unstick_when_element_tl'===o||'unstick_when_element_t'===o||'unstick_when_element_m'===o)||'stick_at_check'===o&&'stick_at_check'!==n[o]||!('-1'!=n[o]&&n[o]||'stick_at_check_tl'!==o&&'stick_at_check_t'!==o&&'stick_at_check_m'!==o)){let e='';'unstick_when_element_tl'===o||'stick_at_check_tl'===o||'unstick_when_check_tl'===o?e='_ti':'unstick_when_element_t'===o||'stick_at_check_t'===o||'unstick_when_check_t'===o?e='_t':'unstick_when_element_m'!==o&&'stick_at_check_m'!==o&&'unstick_when_check_m'!==o||(e='_m'),delete a['unstick_when_el_row_id'+e],delete a['unstick_when_el_mod_id'+e],delete a['unstick_when_condition'+e],delete n['unstick_when_el_row_id'+e],delete n['unstick_when_el_mod_id'+e],delete n['unstick_when_condition'+e],delete a['unstick_when_pos'+e],delete a['unstick_when_pos_val'+e],delete a['unstick_when_element'+e],delete a['unstick_when_pos_val_unit'+e],delete n['unstick_when_pos'+e],delete n['unstick_when_pos_val'+e],delete n['unstick_when_pos_val_unit'+e],delete n['unstick_when_element'+e],'stick_at_check'!==o&&'stick_at_check_tl'!==o&&'stick_at_check_t'!==o&&'stick_at_check_m'!==o||('stick_at_check'!==o&&'-1'!=n[o]||(delete n[o],delete a[o]),delete n['stick_at_position'+e],delete a['stick_at_position'+e])}else if(void 0===o||null===o||''===o||!1===o||'stick_at_position'===o&&'top'===n[o]||o===j.GS.key&&''===n[o].trim()||'background_gradient-css'===o||'cover_gradient-css'===o||'cover_gradient_hover-css'===o||'background_image-type_image'===o||'custom_parallax_scroll_reverse_reverse'===o||'|single'===n[o]||'|multiple'===n[o]||('custom_parallax_scroll_reverse'===o||'custom_parallax_scroll_fade'===o||'visibility_all'===o||'sticky_visibility'===o||'resp_no_bg'===o||'background_zoom'===o||'b_sh_inset'===o||'background_image-circle-radial'===o)&&!n[o])delete n[o],delete a[o];else{if('builder_content'===o)'string'==typeof n[o]&&(n[o]=JSON.parse(n[o])),n[o]=this.clear(n[o],!0);else{let l=[];if(0===o.indexOf('checkbox_')&&-1!==o.indexOf('_apply_all',6)){n[o]?a[o]=n[o]:l.push(o);let i=o.replace('_apply_all','').replace('checkbox_',''),s=['top','left','right','bottom'];for(let t=3;-1<t;--t){let e=i+'_'+s[t]+'_unit';'px'===n[e]?l.push(e):void 0!==n[e]&&null!==n[e]&&''!==n[e]&&(a[e]=n[e])}}else-1!==o.indexOf('gradient',3)?('180'==n[o]||'linear'===n[o]||n[o]===$.ThemifyGradient.default||!1===n[o]&&-1!==o.indexOf('-circle-radial',3))&&l.push(o):('px'===n[o]&&-1!==o.indexOf('_unit',2)&&-1===o.indexOf('frame_')||'%'===n[o]&&-1!==o.indexOf('_unit',2)&&-1!==o.indexOf('frame_')||'background_zoom'===o&&''===n[o]||'none'===n[o]&&-1!==o.indexOf('frame_layout')||'solid'===n[o]||!1===n[o]&&(-1!==o.indexOf('_user_role',3)||-1!==o.indexOf('_appearance',3))||!(n[o]&&'false'!==n[o]||'margin-top_opp_top'!==o&&'m_t_h_opp_top'!==o&&0!==o.indexOf('padding_opp_')&&0!==o.indexOf('margin_opp_')))&&l.push(o);if(0<l.length){for(let e=l.length-1;-1<e;--e)delete a[l[e]],delete n[l[e]];l.length=0,l=[];continue}}!0===t?a.push(n[o]):a[o]=n[o]}else delete a.custom_parallax_scroll_reverse,delete a.custom_parallax_scroll_fade,delete a[o],delete n.custom_parallax_scroll_reverse,delete n.custom_parallax_scroll_fade,delete n[o];return a},clearElementId(t,i){for(let e in t){!0===i?t[e].element_id=j.Utils.generateUniqueID():delete t[e].element_id;let s=void 0!==t[e].styling?t[e].styling:t[e].mod_settings;if(void 0!==s){if(void 0!==s.custom_css_id&&''!==s.custom_css_id){let i=2;for(;;){let e=s.custom_css_id+'-'+i.toString(),t=O.getElementById(e);if(null===t||null===t.closest('.module_row')){s.custom_css_id=e;break}++i}}if(void 0!==s.builder_content){let e='string'==typeof s.builder_content?JSON.parse(s.builder_content):s.builder_content;this.clearElementId(e,!0),s.builder_content=e}}void 0!==t[e].cols?this.clearElementId(t[e].cols,i):void 0!==t[e].modules&&this.clearElementId(t[e].modules,i)}},clearLastEmptyRow(l){for(let s=l.length-1;-1<s;--s){let e=void 0!==l[s].attributes?l[s].attributes:l[s];if(void 0!==e.styling&&null!==e.styling&&0!==Object.keys(e.styling).length)break;{let t=e.cols,i=!0;for(let e in t)if(void 0!==t[e].modules&&(0<t[e].modules.length||0<Object.keys(t[e].modules).length)||void 0!==t[e].styling&&null!==t[e].styling&&0<Object.keys(t[e].styling).length){i=!1;break}if(!0!==i)break;void 0!==l[s].cid&&(j.Models.Registry.remove(l[s].cid),l[s].destroy()),l.splice(s,1)}}},builderPlupload(e,t){const c=!!t,a=c?[t]:U.Lightbox.$lightbox[0].getElementsByClassName('tb_plupload_upload_uic'),i=a.length;if(0<i){const s=!c&&'new_elemn'===e&&'.plupload-clone';void 0===this.pconfig&&(this.pconfig=JSON.parse(JSON.stringify(themify_builder_plupload_init)),this.pconfig.multipart_params._ajax_nonce=themifyBuilder.tb_load_nonce,this.pconfig.multipart_params.topost=themifyBuilder.post_ID);for(let n=i-1;-1<n;--n)if(!a[n].classList.contains('tb_plupload_init')&&(!1===s||a[n].classList.contains(s))){let e=a[n],t=e.getAttribute('id').replace('tb_plupload_upload_ui',''),i=$.extend(!0,{},this.pconfig),s=e.getAttribute('data-extensions'),l=['browse_button','container','drop_element','file_data_name'];i.multipart_params.imgid=t;for(let e=l.length-1;-1<e;--e)i[l[e]]=t+this.pconfig[l[e]];i.filters[0].extensions=null!==s?s:null!==j.activeModel?i.filters[0].extensions.replace(/\,zip|\,txt/,''):'zip,txt';let o=new R.plupload.Uploader(i);e.classList.add('tb_plupload_init'),c&&o.bind('init',function(e){$(e.settings.browse_button).click()}),o.bind('FilesAdded',function(e,t){e.refresh(),e.start(),U.showLoader('show')}),o.bind('Error',function(e,t){const i=$('.prompt-box .show-error');$('.prompt-box .show-login').hide(),i.show(),0<i.length&&i.html('<p class="prompt-error">'+t.message+'</p>'),$('.overlay, .prompt-box').fadeIn(500)}),o.bind('FileUploaded',function(e,t,i){const s=JSON.parse(i.response),l=$('#tb_alert',R.document),o=200!==i.status||s.error?'error':'done';if(s.error)U.showLoader(o),alert(s.error);else if(c){const n=$('#tb_row_wrapper').children().clone(!0);l.promise().done(function(){s.custom_css&&(u=s.custom_css),j.Forms.reLoad(s,themifyBuilder.post_ID);const e=$('#tb_row_wrapper').children().clone(!0);U.Lightbox.close(),j.undoManager.push('','','','import',{before:n,after:e,bid:themifyBuilder.post_ID})})}else{U.showLoader(o);const a=this.getOption().container.closest('.tb_input'),d=a.getElementsByClassName('tb_uploader_input')[0],r=a.getElementsByClassName('thumb_preview')[0];d.value=s.large_url||s.url,void 0!==r&&ThemifyConstructor.file.setImage(r,s.thumb),D.triggerEvent(d,'change')}}),o.init(),e.classList.remove('plupload-clone')}}},grid(t){const i=[];if(1===(t=parseInt(t)))i.push({grid_class:"col-full"});else for(let e=0;e<t;++e)i.push({grid_class:"col"+t+"-1"});return[{cols:i}]},setCompactMode(t){for(let e=(t=t instanceof jQuery?t.get():t).length-1;-1<e;--e)t[e].clientWidth<185?t[e].classList.add('compact-mode'):t[e].classList.remove('compact-mode')},initNewEditor(e){if(3<parseInt(tinyMCE.majorVersion)){const t=tinyMCEPreInit.mceInit.tb_lb_hidden_editor,i=(t.elements=e,t.selector='#'+e,new tinyMCE.Editor(e,t,tinyMCE.EditorManager));return i.render(),i}},initQuickTags(e){'function'==typeof R.QTags&&(R.quicktags({id:e}),R.QTags._buttonsInit())},_getColClass(i){for(let e=0,t=i.length;e<t;++e)if(-1!==this.gridClass.indexOf(i[e]))return i[e].replace('col','')},getMouseEvents(){const e={mousedown:'mousedown',mousemove:'mousemove',mouseup:'mouseup'};return D.isTouch&&(e.mousedown='touchstart',e.mousemove='touchmove',e.mouseup='touchend'),e},saveBuilder(i,e){if(null!==j.activeModel||0===j.builderIndex&&0<U.Lightbox.$lightbox.length&&U.Lightbox.$lightbox[0].classList.contains('tb_custom_css_lightbox')){const n=U.Lightbox.$lightbox[0].getElementsByClassName('builder_save_button')[0];n&&n.click()}const t=j.Instances.Builder[j.builderIndex],s=this,l=t.$el.data('postid');let o=j.Mixins.Builder.toJSON(t.el);if(!0===e)return{id:l,data:o};j.GS.setImport(j.GS.styles,null,null,!0),null===u&&(u=themifyBuilder.custom_css,delete themifyBuilder.custom_css),U.showLoader('show'),s.saveCss(o,u,l).then(function(){let e=new FormData;o=JSON.stringify(j.Utils.clear(o));const t=function(e){const t=e.responseJSON;'function'==typeof i&&i.call(s,t),U.showLoader('hide'),j.editing=!0,D.body.triggerHandler('themify_builder_save_data',[t])};e.append('action','tb_save_data'),e.append('tb_load_nonce',themifyBuilder.tb_load_nonce),e.append('id',l),e.append('custom_css',u),e.append('data',o),e.append('sourceEditor','visual'===j.mode?'frontend':'backend'),$.ajax({type:'POST',url:themifyBuilder.ajaxurl,cache:!1,data:e,processData:!1,contentType:!1,success:function(e){t(e)},error:function(){e.set('data',new Blob([o],{type:"application/json"})),$.ajax({type:'POST',url:themifyBuilder.ajaxurl,cache:!1,data:e,processData:!1,contentType:!1,success:function(e){t(e)},error:function(e,t,i){console.log(t,i),U.showLoader('error'),alert(themifyBuilder.i18n.errorSaveBuilder)}})}})}).catch(function(e){console.log(e),U.showLoader('error')})},saveCss(e,t,i){let s=new FormData;const l=JSON.stringify(j.GS.createCss(e,e[0]&&e[0].mod_name||null,!0));return s.append('action','tb_save_css'),s.append('custom_css',t),s.append('tb_load_nonce',themifyBuilder.tb_load_nonce),s.append('id',i),s.append('css',l),new Promise(function(e,t){$.ajax({type:'POST',url:themifyBuilder.ajaxurl,cache:!1,data:s,processData:!1,contentType:!1,success:function(){e()},error:function(){s.set('css',new Blob([l],{type:"application/json"})),$.ajax({type:'POST',url:themifyBuilder.ajaxurl,cache:!1,data:s,processData:!1,contentType:!1,success:function(){e()},error:function(){t()}})}})})},runJs(t,s,e){if(!s)if(null!==j.activeModel)s=j.activeModel.get('elType');else if(t){const i=j.Models.Registry.lookup(t.data('cid'));i&&(s=i.get('elType'))}const l=[];if('visual'===j.mode){'module'===s&&!0===D.is_builder_loaded&&D.fontAwesome(t);const o=t?t[0]:O,n=o.querySelectorAll('img[data-w]');for(let i=n.length-1;-1<i;--i)if(!0===e&&(n[i].style.display=''),!n[i].classList.contains('tf_large_img'))if(2560<n[i].naturalWidth||2560<n[i].naturalHeight)n[i].className+=' tf_large_img',D.checkLargeImages(n[i]);else if(!0!==e){let e=n[i].getAttribute('width'),t=n[i].getAttribute('height');(e||t)&&l.push(j.Utils.resizeImage(n[i],e,t))}}Promise.all(l).then(e=>{if(t&&b.Isotope){const i=D.selectWithParent('masonry-done',t);for(let t=i.length-1;-1<t;--t){let e=Isotope.data(i[t]);e&&e.destroy(),i[t].classList.remove('masonry-done')}}D.reRun(t,s)})},createClearBtn(e){e.siblings('.tb_clear_btn tf_close').click(function(){$(this).hide(),e.val('').trigger('keyup')})},toRGBA(e){return ThemifyStyles.toRGBA(e)},getColor(e){let t=e.value;if(''!==t)if(null!==e.getAttribute('data-tfminicolors-initialized'))t=$(e).tfminicolors('rgbaString');else{const i=e.getAttribute('data-opacity');''!==i&&null!==i&&'1'!=i&&'0.99'!=i&&(t=this.toRGBA(t+'_'+i))}return t},getIcon(e,t){if(void 0!==themifyBuilder.fontello_prefix){const n=new RegExp(themifyBuilder.fontello_use_suffix?themifyBuilder.fontello_prefix+'$':'^'+themifyBuilder.fontello_prefix);if(n.test(e)){const a=O.createElement('i');return a.setAttribute('class',e),a}}e='tf-'+e.trim().replace(' ','-');const i='http://www.w3.org/2000/svg',s=O.createElementNS(i,'use'),l=O.createElementNS(i,'svg');let o='tf_fa '+e;return t&&(o+=' '+t),l.setAttribute('class',o),s.setAttributeNS(null,'href','#'+e),l.appendChild(s),l},getBPWidth(e){const t=Array.isArray(themifyBuilder.breakpoints[e])?themifyBuilder.breakpoints[e]:themifyBuilder.breakpoints[e].toString().split('-');return t[t.length-1]},generateUniqueID(){return(Math.random().toString(36).substr(2,4)+(new Date).getUTCMilliseconds().toString()).substr(0,7)},scrollTo(e){const t='desktop'===j.activeBreakPoint?$('html,body'):$('body',R.document);t.scrollTop(e)},scrollToDropped(i,e){if(i=i||j.Instances.Builder[j.builderIndex].el.getElementsByClassName('tb_element_cid_'+e)[0])if('visual'===j.mode)this.scrollTo($(i).offset().top-120);else{const s=O.getElementsByClassName('edit-post-layout__content')[0];if(void 0!==s){let t;if(i.classList.contains('module_row'))t=i.offsetTop;else{let e=i.closest('.module_row');t=null!==e?(e=$(e)).offset().top+200-e.offsetParent().offset().top:i.offsetTop}$(s).scrollTop(t)}}},addViewPortClass(t){t.style.transition='none',this.removeViewPortClass(t);let i=this.isInViewport(t);if(!1!==i)for(let e=(i=i.split(' ')).length-1;-1<e;--e)''!==i[e]&&t.classList.add(i[e]);t.style.transition=''},removeViewPortClass(t){const i=['top','left','bottom','right'];for(let e=4;-1<e;--e)t.classList.remove('tb_touch_'+i[e])},isInViewport(e){const t=e.getBoundingClientRect();let i='';return t.left<0?i='tb_touch_left':t.right-1>=O.documentElement.clientWidth&&(i='tb_touch_right'),t.top<0?i+=' tb_touch_top':(t.bottom+1>=O.documentElement.clientHeight||b.innerHeight+b.scrollY>=O.body.offsetHeight&&t.bottom+20>=O.documentElement.clientHeight)&&(i+=' tb_touch_bottom'),''!==i&&i},canvas:null,ctx:null,cache_images:{},resizeImage(d,y,v,w){if(!(y='0'===y?'':y)&&!v)return new Promise((e,t)=>{'string'!=typeof d&&(d.style.visibility=d.style.display=''),e([d,y,v,y,v])});null===this.canvas&&(this.canvas=O.createElement('canvas'),this.ctx=this.canvas.getContext('2d'),this.ctx.imageSmoothingQuality='high',this.ctx.imageSmoothingEnabled=!0);const C=this;return new Promise((p,n)=>{let f=O.createElement('span');const o=function(g){let e=g.getAttribute('data-orig');const b=function(){y?(g.setAttribute('width',y),g.style.width&&(g.style.width=y+'px')):g.removeAttribute('width'),v?(g.setAttribute('height',v),g.style.height&&(g.style.height=v+'px')):g.removeAttribute('height')},t=function(){y=y&&parseInt(y),v=v&&parseInt(v);const t=w.naturalWidth,i=w.naturalHeight,s=t/i;let l=y,o=v,n=y,a=v;if(t<=2560&&i<=2560){const d=(l=l||(y=parseInt(o*s)))/t,r=(o=o||(v=parseInt(l/s)))/i,c=g.currentSrc,u=r<d?d:r,_=(n=l/u+.5>>0,a=o/u+.5>>0,(t-n)/2>>0),m=(i-a)/2>>0,h=g.getAttribute('srcset');let e=g.getAttribute('data-ext');e||g.hasAttribute('data-ext')||(e='image/'+(e='jpg'===(e=c.slice(2+(c.lastIndexOf('.')-1>>>0)))?'jpeg':e),g.setAttribute('data-ext',e)),C.canvas.width=n,C.canvas.height=a,C.ctx.drawImage(w,_,m,n,a,0,0,n,a),h&&-1!==h.indexOf(c)?g.setAttribute('srcset',h.replaceAll(c,C.canvas.toDataURL(e,1))):g.setAttribute('src',C.canvas.toDataURL(e,1)),b()}else g.classList.add('tf_large_img');f&&f.remove(),g.style.visibility=g.style.display='',f=e=null,p([g,y,v,n,a])};if(!e){if(0!==(e=g.getAttribute('src').trim()).indexOf(themifyBuilder.upload_url)||g.closest('[data-hasEditor]'))return f&&f.remove(),g.style.visibility=g.style.display='',b(),f=e=null,void p([g,y,v,y,v]);{const i=g.getAttribute('width'),s=g.getAttribute('height');if(i&&s){const l='-'+i+'x'+s;-1!==e.indexOf(l)&&(e=e.replace(l,''))}g.dataset.orig=e}}if(w)t();else{const o=D.hash(e+y+v);void 0!==C.cache_images[o]?(w=C.cache_images[o],t(),w=null):((w=new Image).src=e,w.crossOrigin='anonymous',w.decode().then(function(){t(),C.cache_images[o]=w}).catch(e=>{f&&f.remove(),g.style.visibility=g.style.display='',n()}))}};if('string'==typeof d){let l=0;const a=setInterval(function(){8<++l&&clearInterval(a);const e=j.Instances.Builder[j.builderIndex].el.querySelector(d);if(null!==e){clearInterval(a),f.className='tf_loader tf_loader_center';const t=e.closest('.active_module');if(t){const i=t.getElementsByClassName('tf_loader_center')[0];void 0!==i&&i.parentNode===t||t.prepend(f)}else{const s=e.nextElementSibling;null!==s&&s.classList.contains('tf_loader_center')||e.after(f)}o(e)}},8)}else{if(!w){f.className='tf_loader tf_loader_center';const e=d.closest('.active_module');if(e){const t=e.getElementsByClassName('tf_loader_center')[0];void 0!==t&&t.parentNode===e||e.prepend(f)}else{const i=d.nextElementSibling;null!==i&&i.classList.contains('tf_loader_center')||d.after(f)}}o(d)}})},hideOnClick(e){((e=void 0!==e[0]?e[0]:e).classList.contains('tb_ui_dropdown_items')||e.classList.contains('tb_down'))&&(e.classList.add('tb_hide_option'),e.previousElementSibling.blur(),setTimeout(function(){e.classList.remove('tb_hide_option'),e=null},500))},calculateHeight(){'visual'===j.mode&&'desktop'!==j.activeBreakPoint&&(R.document.body.style.height=O.body.scrollHeight+'px')},changeOptions(e,_){const m='INPUT'===e.tagName&&'hide_anchor'!==_?'keyup':'change',h=this;'keyup'==m&&e.setAttribute('data-prev',e.value),h.custom_css_id=function(e,t,i,s){const l=O.getElementById(s);return(null===l||i[0].getAttribute('id')===s||null===l.closest('.module_row'))&&(i[0].setAttribute('id',s),i.find('.tb_row_id').first().text(s),!0)},h.row_anchor=function(e,t,i,s){return'visual'===j.mode&&(i.removeClass(j.liveStylingInstance.getRowAnchorClass(e.getAttribute('data-prev'))),''!==s&&i.addClass(j.liveStylingInstance.getRowAnchorClass(s)),i.data('anchor',s).attr('data-anchor',s)),j.hasChanged=!0,i.find('.tb_row_anchor').first().text(s.replace('#','')),!0},h.custom_css=function(e,t,i,s){return'visual'===j.mode&&i.removeClass(e.getAttribute('data-prev')).addClass(s),!0},h.layout=function(e,t,i,s){return'visual'===j.mode&&j.liveStylingInstance.bindRowWidthHeight(t,s,i),!0},h.hide_anchor=function(e,t,i,s){return'visual'===j.mode&&'1'===s&&i.data('hideAnchor',s).attr('data-hide-anchor',s),j.hasChanged=!0},e.addEventListener(m,function(e){let o,t=null!==j.activeModel&&j.ActionBar.cid===j.activeModel.cid,i=!U.Lightbox.$lightbox[0].contains(this),n='hide_anchor'!==_?this.id:'hide_anchor',s='custom_css_id'===n,l=1!=s||0!=i&&1!=t?void 0:U.Lightbox.$lightbox[0].getElementsByClassName('builder_save_button')[0],a;a=1==i&&0==t?$('.tb_element_cid_'+j.ActionBar.cid):'visual'===j.mode?j.liveStylingInstance.$liveStyledElmt:$('.tb_element_cid_'+j.activeModel.cid);const d=0==t&&1==i?U.clone(a[0]):null;if(o=this.value,'keyup'==m&&'custom_css'!==_?(o=(o=o.trim())&&o.replace(/[^a-zA-Z0-9\-\_]+/gi,''),this.value=o):'layout'===_?o=e.detail.val:'hide_anchor'===_&&(o=this.checked?'1':'0'),h[_].call(h,this,n,a,o)){if(s&&($(this).next('.tb_field_error_msg').remove(),void 0!==l&&l.classList.remove('tb_disable_save')),1==i){const r=function(){let e=o,t=('keyup'==m&&(this.removeEventListener('change',r,{passive:!0,once:!0}),this.removeAttribute('data-isInit'),e=this.value.trim()),a.data('cid')),i=j.Models.Registry.lookup(t),s=$.extend(!0,{},i.get('styling'));s=s||{};const l=$.extend(!0,{},s);s[n]=e,i.set({styling:s},{silent:!0}),null!==d&&j.undoManager.push(t,d,a,'save',{bsettings:l,asettings:$.extend(!0,{},s)})};'keyup'==m?this.getAttribute('data-isInit')||(this.setAttribute('data-isInit',1),this.addEventListener('change',r,{passive:!0,once:!0})):r()}j.hasChanged=!0}else if(s){if(0===this.parentNode.getElementsByClassName('tb_field_error_msg').length){const c=O.createElement('span');c.className='tb_field_error_msg',c.textContent=ThemifyConstructor.label.errorId,this.parentNode.insertBefore(c,this.nextSibling)}void 0!==l&&l.classList.add('tb_disable_save')}if(1==t){const u=(i?U.Lightbox.$lightbox:$('#'+j.ActionBar.el.id)).find('#'+n);'keyup'==m?u.val(o).attr('data-prev',o):'layout'===_?(u.find('.selected').removeClass('selected'),(''!==o?u.find('#'+o):u.children().first()).addClass('selected')):'hide_anchor'===_&&(u.find('INPUT')[0].checked=this.checked)}'keyup'==m&&this.setAttribute('data-prev',o)},{passive:!0})},visibilityLabel(e,t){const i=t.cid;let s=null!==j.activeModel&&i===j.activeModel.cid&&'visibility'===ThemifyConstructor.clicked?j.Forms.serialize('tb_options_visibility'):void 0;if(s=void 0===s?'module'!==t.get('elType')?t.get('styling'):t.get('mod_settings'):s){let i='';const l=e.classList.contains('tb_visibility_hint')?e:e.getElementsByClassName('tb_visibility_hint')[0],o={visibility_desktop:themifyBuilder.i18n.de,visibility_mobile:themifyBuilder.i18n.mo,visibility_tablet:themifyBuilder.i18n.ta,visibility_tablet_landscape:themifyBuilder.i18n.ta_l,sticky_visibility:themifyBuilder.i18n.s_v};if(void 0!==l){if('hide_all'===s.visibility_all)i=themifyBuilder.i18n.h_a;else{let t;for(let e in o)t=''===i?'':', ',i+='hide'===s[e]?t+o[e]:''}if(''!==i){let e=l.getElementsByTagName('span')[0];void 0===e&&(e=O.createElement('span'),l.appendChild(e)),e.textContent=i,l.classList.add('tb_has_visiblity')}else l.classList.remove('tb_has_visiblity')}}}},j.ActionBar={cid:null,topH:null,type:null,disable:null,prevExpand:null,needClear:!0,el:null,breadCrumbs:null,breadCrumbsPath:{lightbox:null,rightClick:null},disablePosition:null,isInit:null,isHoverMode:!0,darkMode:null,inlineEditor:!0,hoverCid:null,contextMenu:null,contextMenuAnimate:null,init(){if(null===this.isInit&&!0!==j.GS.isGSPage){this.isInit=!0,this.el=O.createElement('div'),this.breadCrumbs=O.createElement('ul'),this.el.id='tb_component_bar',this.breadCrumbs.className='tb_action_breadcrumb',this.el.addEventListener('mousedown',this.mouseDown.bind(this)),this.topH=j.toolbar.$el.height(),('visual'===j.mode?O.body:j.Instances.Builder[j.builderIndex].el.parentNode).appendChild(this.el),O.addEventListener('click',this.click.bind(this)),O.addEventListener('dblclick',this.click.bind(this)),j.Instances.Builder[0].el.addEventListener('mouseover',this.enter),'visual'===j.mode&&R.document.addEventListener('click',this.click.bind(this));const e='visual'===j.mode?null:O.getElementById('tb_canvas_block');null===e?(O.addEventListener('keydown',this.actions.bind(this),{passive:!0}),R.document.addEventListener('keydown',this.actions.bind(this),{passive:!0})):e.addEventListener('keydown',this.actions.bind(this),{passive:!0}),this.changeMode(),this.initRightClick(!0)}},changeMode(){this.hoverCid=null;const e=O.body.classList;!0===this.isHoverMode?(e.remove('tb_click_mode'),e.add('tb_hover_mode'),this.el.removeEventListener('click',this.actions)):(e.remove('tb_hover_mode'),e.add('tb_click_mode'),this.el.addEventListener('click',this.actions))},changeDarkMode(){const e=O.getElementById('darkmode-ui'),t='visual'===j.mode?R.document.getElementById('darkmode-ui'):null;if(!0===this.darkMode)if(e)e.disabled=!1,t&&(t.disabled=!1);else{const i=R.document.createElement('link'),s=O.getElementById('visual'!==j.mode?'themify-builder-admin-ui-css':'themify-builder-inline-editor-css');i.rel='stylesheet',i.href=themifyBuilder.builder_url+'/css/editor/darkmode-ui.css',i.id='darkmode-ui',s.parentNode.insertBefore(i,s.nextSibling),'visual'===j.mode&&R.document.head.appendChild(i.cloneNode())}else e.disabled=!0,t&&(t.disabled=!0)},initRightClick(e){localStorage.getItem('tb_right_click')?!0===e?j.toolbar.el.getElementsByClassName('tb_right_click_mode')[0].checked=!1:(j.Instances.Builder[0].el.removeEventListener('contextmenu',this.rightClick),this.contextMenu=this.contextMenuAnimate=null):(j.Instances.Builder[0].el.addEventListener('contextmenu',this.rightClick),j.ActionBar.el.removeEventListener('contextmenu',this.rightClick),!0!==this.isHoverMode&&j.ActionBar.el.addEventListener('contextmenu',this.rightClick))},enter(l){const o=j.ActionBar;if(null===o.disable&&(j.Mixins.Builder.columnHover(l.target),!0===o.isHoverMode&&null===o.disablePosition)){'click'===l.type&&l.preventDefault(),l.stopPropagation();let t=l.target,e=null,i=t.classList,s;if(null!==o.prevExpand&&void 0!==o.prevExpand)if(o.prevExpand.contains(t)){if(i.contains('tb_inner_action_more')||i.contains('tb_action_more')){const a=t.getElementsByTagName('ul')[0];void 0!==a&&j.Utils.addViewPortClass(a)}const n=o.prevExpand.getElementsByClassName('tb_row_settings')[0];if(void 0!==n){const d=O.getElementById(n.getAttribute('data-href'));if(d.contains(t))return;d.classList.remove('selected'),n.classList.remove('selected')}if('module'===o.type||'column'===o.type)return void('column'===o.type&&(o.hoverCid=t.parentNode.getAttribute('data-cid')))}else{let e='module'!==o.type;if(!1===e)if('visual'!==j.mode){const r=t.closest('.active_module');e=null===r||r.getAttribute('data-cid')!==o.hoverCid}else{const c=t.closest('.tb_dragger_top');null!==c&&c.classList.contains('tb_dragger_padding')&&j.EdgeDrag.setModulePosition(c)}else if(i.contains('tb_clicked'))return;!0===e&&o.clear()}if(null===t.closest('.tb_dragger_lightbox')){if(i.contains('tb_action_wrap'))e=!i.contains('tb_clicked');else{if('LI'===t.nodeName&&i.contains('tb_row_settings')&&!i.contains('selected'))return void o.actions(l);if(!i.contains('tb_grid_drag')){const u=t.closest('[data-cid]');if(!u)return;const _=u.getAttribute('data-cid');if(o.hoverCid===_)return;o.hoverCid=_;const m=j.Models.Registry.lookup(_);if('module'===(s=m.get('elType')))e=!0;else if('visual'===j.mode)return o.clear(),void j.EdgeDrag.addEdges(s,m,u)}}!0===e&&o.click(l)}}},rightClickGS(r,c,u){this.disable=!0,null!==j.activeModel&&$('.builder_save_button',ThemifyBuilderCommon.Lightbox.$lightbox).click();const _=j.Instances.Builder[j.builderIndex].el.getElementsByClassName('tb_element_clicked'),m=j.GS.key;c=c.split(' ');for(let a=_.length-1,d=c.length;-1<a;--a){let e=j.Models.Registry.lookup(_[a].getAttribute('data-cid')),t=U.clone(_[a]),i=e.get('elType'),s='module'===i?'mod_settings':'styling',l=$.extend(!0,{},e.get(s)),o=$.extend(!0,{},l);if(j.activeModel=e,l[m])if(!0===u)r&&-1!==l[m].indexOf(r)&&(l[m]=l[m].split(' '),l[m].splice(l[m].indexOf(r),1),l[m]=l[m].join(' '));else for(let e=0;e<d;++e)-1===l[m].indexOf(c[e])&&(l[m]+=' '+c[e]);else{if(0===d)continue;l[m]=c.join(' ')}let n={};n[s]=l,e.set(n,{silent:!0}),j.GS.generateValues(r,l[m].split(' '),u),j.undoManager.push(e.cid,t,$(_[a]),'save',{bsettings:o,asettings:l})}this.disable=null,j.activeModel=null},rightClick(r,c){r.stopImmediatePropagation();const u=j.ActionBar;if(!(null!==u.contextMenuAnimate||'visual'===j.mode&&O.activeElement.contentEditable&&j.liveStylingInstance.$liveStyledElmt&&j.liveStylingInstance.$liveStyledElmt[0].contains(O.activeElement))){if(u.contextMenuAnimate=!0,null===u.contextMenu){const e=function(g){if(g.stopPropagation(),'click'===g.type&&null===g.target.closest('.tb_visibility_wrap')&&g.preventDefault(),'LI'===g.target.nodeName||g.target.classList.contains('toggle_switch')){const b='LI'===g.target.nodeName?g.target.getAttribute('data-action'):'visibility';if(b){if(u.disable=!0,u.hoverCid=null,'undo'===b||'redo'===b){const e='undo'===b?j.undoManager.btnUndo:j.undoManager.btnRedo;if(!('undo'===b&&j.undoManager.hasUndo()||'redo'===b&&j.undoManager.hasRedo()))return void(u.disable=null);$(e).triggerHandler('click'),u.disable=null}else{let t=this.classList.contains('tb_multiply_selected'),_,e,i,s,l,o,n,m=j.Instances.Builder[j.builderIndex].el.getElementsByClassName('tb_element_clicked'),h=void 0;if('gs_in'!==b&&'move'!==b&&(!0!==t||'delete'!==b&&'paste'!==b||(h=!0),$('.builder_save_button',ThemifyBuilderCommon.Lightbox.$lightbox).click()),'reset'===b)_=j.activeModel,e=$.extend(!0,{},ThemifyConstructor.values),i=ThemifyConstructor.component,s=ThemifyConstructor.beforeData,l=!0===j.hasChanged,o='visual'===j.mode?j.liveStylingInstance.prefix:null,n='visual'===j.mode?j.liveStylingInstance.$liveStyledElmt:null;else{if('move'===b)return void(u.disable=null);if('gs_in'===b){let e;if(!1===t){const d=j.Models.Registry.lookup(m[0].dataset.cid);e=$.extend(!0,{},ThemifyConstructor.values),ThemifyConstructor.values='module'===d.get('elType')?d.get('mod_settings'):d.get('styling')}const a=j.GS.globalStylesHTML();if(a){const r=u.contextMenu.querySelector('#tb_inline_gs');r.innerHTML='',r.appendChild(a),r.getElementsByClassName('tb_gs_icon')[0].click(),r.querySelector('[data-action="insert"]').click(),r.classList.add('tb_inline_gs_show'),j.Utils.addViewPortClass(u.contextMenu)}return!1===t&&(ThemifyConstructor.values=e),void(u.disable=null)}}for(let u=m.length-1;-1<u;--u){let a=m[u].getAttribute('data-cid'),d=j.Models.Registry.lookup(a),r=d.get('elType'),c='module'===r?d.get('mod_settings'):d.get('styling');if('reset'===b||'gs_r'===b){if('gs_r'!==b||void 0!==c[j.GS.key]){if(null!==j.activeModel&&j.activeModel.cid===a){let e=ThemifyBuilderCommon.Lightbox.$lightbox.find('.reset-styling')[0];if(void 0!==e){e.click();continue}}let e=U.clone(m[u]),t,i=(j.activeModel=d,'reset'===b&&(ThemifyConstructor.component=r,ThemifyConstructor.values=c),'module'===r?'mod_setting':'styling'),s,l,o,n=('visual'===j.mode&&(j.liveStylingInstance.$liveStyledElmt?j.liveStylingInstance.prefix=ThemifyStyles.getBaseSelector('module'===r?j.activeModel.get('mod_name'):r,j.activeModel.get('element_id')):j.liveStylingInstance.init(!0),j.liveStylingInstance.$liveStyledElmt=$(m[u])),s=$.extend(!0,{},c),'reset'===b?(o=ThemifyConstructor.resetStyling(g,null!==_&&_.cid!==a),'visual'===j.mode&&(t=$.extend(!0,{},o)),l=$.extend(!0,{},ThemifyConstructor.values)):(delete c[j.GS.key],l=c,j.GS.generateValues(null,[],!0)),{});n[i]=l,d.set(n,{silent:!0}),j.hasChanged=!0,j.undoManager.push(a,e,$(m[u]),'save',{bsettings:s,asettings:l,styles:t}),d=l=t=o=null}}else('delete'!==b&&'visibility'!==b||'column'!==r)&&d.trigger(b,g,g.target,h)}'reset'===b?(j.hasChanged=l,j.activeModel=_,ThemifyConstructor.values=e,ThemifyConstructor.component=i,ThemifyConstructor.beforeData=s,'visual'===j.mode&&(j.liveStylingInstance.$liveStyledElmt=n,j.liveStylingInstance.prefix=o),i=s=e=o=null):'edit'!==b&&(j.activeModel=null),u.disable=null}'visibility'!==b&&u.hideContextMenu()}}},t=function(e){if(e.stopPropagation(),e.target.classList.contains('tb_inner_action_more')){const t=e.target.getElementsByTagName('ul')[0];t&&j.Utils.addViewPortClass(t)}};u.contextMenu=O.getElementById('tb_right_click'),null===u.contextMenu&&(u.contextMenu=O.getElementById('tmpl-builder_right_click').content,O.body.appendChild(u.contextMenu),u.contextMenu=O.getElementById('tb_right_click'),u.contextMenu.addEventListener('click',e),u.contextMenu.addEventListener('mouseover',t,{passive:!0}),u.contextMenu.getElementsByClassName('tb_r_name')[0].addEventListener('mousedown',function(e){if(1===e.which&&!u.contextMenu.classList.contains('tb_multiply_selected')&&!u.contextMenu.classList.contains('tb_component_column')){e.preventDefault(),e.stopPropagation();const t=j.Instances.Builder[j.builderIndex].el.getElementsByClassName('tb_element_clicked')[0];t&&(u.hideContextMenu(),u.cid=t.dataset.cid,u.moveComponent())}}))}let d=!0;if(!0!==u.isHoverMode&&null!==u.cid?c=j.Instances.Builder[j.builderIndex].el.querySelector('[data-cid="'+u.cid+'"]'):c?d=!1:c=$(r.target).closest('[data-cid]')[0],void 0===c)u.contextMenuAnimate=null;else{r.preventDefault(),u.hideContextMenu(r.target.classList.contains('tb_bread')),u.disablePosition=!0,O.body.classList.add('tb_right_click_open'),u.contextMenu.className='tb_show_context';const _=r.pageX,m=r.pageY,h=j.Models.Registry.lookup(c.dataset.cid),g=h.get('elType'),b=function(e){if('transform'===e.propertyName){let t;const i=j.Instances.Builder[j.builderIndex].el,s=this.getElementsByClassName('tb_r_name')[0],l=this.getElementsByClassName('tb_action_breadcrumb')[0],o=function(e){e.preventDefault(),e.stopPropagation();const t=e.target.getAttribute('data-id');if(t){this.removeEventListener('click',o),u.hideContextMenu(!0);const i=j.Instances.Builder[j.builderIndex].el.getElementsByClassName('tb_element_cid_'+t)[0];void 0!==i&&u.rightClick(e,i)}};if(this.removeEventListener('transitionend',b,{passive:!0}),this.className='tb_component_'+g,'module'===g&&(this.className+=' tb_module_'+h.get('mod_name')),!(l.innerHTML='')===r.ctrlKey||!0===r.metaKey)c.classList.add('tb_element_clicked');else if(!c.classList.contains('tb_element_clicked')){for(let e=(t=i.getElementsByClassName('tb_element_clicked')).length-1;-1<e;--e)t[e].classList.remove('tb_element_clicked');c.classList.add('tb_element_clicked')}if(1<(t=i.getElementsByClassName('tb_element_clicked').length))this.className+=' tb_multiply_selected',s.textContent=themifyBuilder.i18n.multiSelected;else{const a=null===u.breadCrumbsPath.rightClick?h.cid:u.breadCrumbsPath.rightClick[u.breadCrumbsPath.rightClick.length-1];u.breadCrumbsPath.rightClick=u.getBreadCrumbPath(j.Instances.Builder[0].el.getElementsByClassName('tb_element_cid_'+a)[0],'rightClick'),l.appendChild(u.getBreadCrumbs(c,'rightClick')),s.textContent='module'===g?themifyBuilder.modules[h.get('mod_name')].name:g}l.addEventListener('click',o);const n=function(e){'transform'===e.propertyName?(this.removeEventListener('transitionend',n,{passive:!0}),j.Utils.addViewPortClass(this),u.contextMenuAnimate=null):(this.style.top=m+'px',!0===d&&(this.style.left=_+'px'))};this.addEventListener('transitionend',n,{passive:!0}),j.undoManager.hasUndo()||(this.className+=' tb_undo_disabled'),'column'===g&&(this.className+=' tb_visibility_disabled'),j.undoManager.hasRedo()||(this.className+=' tb_redo_disabled'),this.className+=' tb_show_context'}};u.contextMenu.addEventListener('transitionend',b,{passive:!0}),setTimeout(function(){u.contextMenu.className=''},18)}}},hideContextMenu(e){if(null!==this.contextMenu){this.contextMenu.style.top='';const t=this.contextMenu.querySelector('#tb_inline_gs');t.classList.remove('tb_inline_gs_show'),O.body.classList.remove('tb_right_click_open'),!(this.disablePosition=this.hoverCid=null)!==e&&(j.ActionBar.breadCrumbsPath.rightClick=null)}},mouseDown(e){1!==e.which||'row'!==this.type&&'subrow'!==this.type||!e.target.classList.contains('tb_move')||(e.preventDefault(),e.stopPropagation(),this.moveComponent())},moveComponent(){const s=j.Instances.Builder[j.builderIndex].el.getElementsByClassName('tb_element_cid_'+this.cid)[0];if(void 0!==s){let e=s.classList.contains('module_row')?s.getElementsByClassName('tb_row_action')[0]:s,t=$(s).offset(),i;this.clear(),'function'==typeof Event?i=new Event('mousedown',{bubbles:!0,cancelable:!1}):(i=O.createEvent('Event')).initEvent('mousedown',!0,!1),i.pageX=t.left,i.pageY=t.top,i.which=1,e.dispatchEvent(i)}},click(i){if(j.isPreview||!0===this.disable)return!0;let e=i.target,t=e.tagName,s=null,l=j.Instances.Builder[j.builderIndex].lastRow,o='visual'===j.mode&&e.ownerDocument===R.document?void 0:$(e).closest('[data-cid]')[0],n=i.type;if('click'===n){const d=U.Lightbox.$lightbox[0];if(this.hideContextMenu(),s=!0===i.ctrlKey||!0===i.metaKey,R.document.body.classList.contains('tb_standalone_lightbox')&&!R.document.body.classList.contains('modal-open')){j.toolbar.el.contains(e)||d.contains(e)||d.classList.contains('tb_predesigned_lightbox')||d.classList.contains('tb_custom_css_lightbox')||U.Lightbox.close();const r=R.document.getElementsByClassName('tb_current_menu_selected')[0];void 0!==r&&r.classList.remove('tb_current_menu_selected')}if(l&&!l.contains(e)&&l.classList.remove('expanded'),!d.contains(e)&&(!1===s&&this.clearClicked(),void 0!==o)){if(!0===s&&o.classList.contains('tb_element_clicked'))return void o.classList.remove('tb_element_clicked');o.classList.add('tb_element_clicked')}}else if('dblclick'===n&&null!==j.Forms.LayoutPart.id&&e.classList.contains('tb_overlay'))return void j.Forms.LayoutPart.save(i,!0);const a=('click'===n||'dblclick'===n)&&'visual'===j.mode&&U.Lightbox.dockMode.get();if(void 0===o||o.classList.contains('tb_active_layout_part'))if('LI'===t&&e.classList.contains('tb_bread')){const c=j.Models.Registry.lookup(e.getAttribute('data-id'));if('setting'!==ThemifyConstructor.clicked&&'module'===ThemifyConstructor.component){const _=U.Lightbox.$lightbox[0].getElementsByClassName('tb_lightbox_top_bar')[0].querySelector('.current a').getAttribute('href');U.Lightbox.$lightbox.off('themify_opened_lightbox.tb_breadCrumbs').on('themify_opened_lightbox.tb_breadCrumbs',function(){'row'===ThemifyConstructor.component?U.Lightbox.$lightbox.off('themify_opened_lightbox.tb_breadCrumbs')[0].getElementsByClassName('tb_lightbox_top_bar')[0].querySelector('a[href="'+this+'"]').click():null===j.activeModel&&U.Lightbox.$lightbox.off('themify_opened_lightbox.tb_breadCrumbs')}.bind(_))}const u=null===this.breadCrumbsPath.lightbox?j.activeModel.cid:this.breadCrumbsPath.lightbox[this.breadCrumbsPath.lightbox.length-1];this.breadCrumbsPath.lightbox=this.getBreadCrumbPath(j.Instances.Builder[0].el.getElementsByClassName('tb_element_cid_'+u)[0]),c.trigger('edit','breadcrumb')}else this.el.contains(e)||'click'===i.type&&e.classList.contains('tb_dragger')||this.clear();else{'visual'!==j.mode||'A'!==t&&null===e.closest('a')||i.preventDefault();const m=o.getAttribute('data-cid'),h=j.Models.Registry.lookup(m),g=h.get('elType'),b='row'===g&&o.classList.contains('tb-page-break');if(h){if('dblclick'===n){if((!0===a||'INPUT'===t||!0===b||e.classList.contains('tb_dragger_lightbox')||null!==e.closest('.tb_clicked'))&&'tb_row_options'!==e.id)return;if(i.preventDefault(),i.stopPropagation(),!1===a&&!0!==this.isHoverMode?(o.classList.add('tb_element_clicked'),D.body[0].classList.add('tb_action_active'),'visual'===j.mode&&j.EdgeDrag.addEdges('module'===g?h.get('mod_name'):g,h,o)):o.classList.remove('tb_element_clicked'),!e.classList.contains('tb_row_settings'))return this.hoverCid=null,void h.trigger('edit',i,e)}else if('click'===n&&!1===a&&(e.classList.contains('tb_dragger')||null!==e.closest('.tb_dragger_options')))return;const isHoverMode=!0===this.isHoverMode,p=1!=isHoverMode&&null!==this.cid,f='module'!==g?e.classList.contains('tb_action_wrap'):1==isHoverMode;if(this.cid=m,this.type=g,!0===b&&'row'===g)this.clear(),e.classList.contains('tb_row_anchor')&&(i.preventDefault(),i.stopPropagation(),h.trigger('delete',i,e));else if((!1===f||'module'===g&&1==isHoverMode)&&null!==e.closest('.tb_action_wrap'))'click'===n&&this.actions(i);else if(1==isHoverMode&&'click'===n&&!0===this.needClear)!0===a&&!1===s&&h.trigger('edit',i,e);else if(this.clear(),1==p&&'click'===n&&!1===s&&!1===a&&!0===this.needClear){D.body[0].classList.add('tb_action_active');const y=this,v=function(){this.removeEventListener('mousemove',v,{passive:!0,once:!0}),null===y.cid&&(D.body[0].classList.remove('tb_action_active'),y.clearClicked())};O.addEventListener('mousemove',v,{passive:!0,once:!0})}else{this.cid=m,this.type=g;const w=O.getElementById('tmpl-builder_'+g+'_action').content.cloneNode(!0);if(!0===f){if(this.prevExpand='module'===g?o.getElementsByClassName('tb_module_action')[0]:e,void 0===this.prevExpand)return void this.clear();if(this.prevExpand.appendChild(w),this.prevExpand.setAttribute('id',this.el.id),this.prevExpand.closest('.tb_action_wrap').classList.add('tb_clicked'),1==isHoverMode&&'module'===g){let e=o.getBoundingClientRect(),t=this.prevExpand.classList;if(e.height<70||e.width<200){t.add('tb_small_action_bar'),t.remove('tb_small_action_bar_top','tb_small_action_bar_bottom');const C=this.prevExpand.getBoundingClientRect().top;C<40||C-j.Instances.Builder[j.builderIndex].el.getBoundingClientRect().top<40?t.add('tb_small_action_bar_top'):t.add('tb_small_action_bar_bottom'),t.toggle('tb_small_action_bar_height',e.height<70),t.toggle('tb_small_action_bar_width',e.width<200)}else t.remove('tb_small_action_bar');'visual'===j.mode&&j.EdgeDrag.addEdges(h.get('mod_name'),h,o),'visual'===j.mode&&'module'===g&&(this.prevExpand.dataset.module=h.get('mod_name'))}}else{('row'!==g||'row'===g&&null!==this.breadCrumbsPath.lightbox)&&this.setBreadCrumbs(o),this.el.className='tb_show_toolbar tb_'+g+'_action';const x=O.createElement('div');if(x.className='tb_action_label_wrap',x.appendChild(w),'visual'===j.mode){let t;if('module'===g)t=h.get('mod_name'),this.el.className+=' tb_'+t+'_action',t=themifyBuilder.modules[t].name;else if('row'===(t=g)){let e=h.get('styling').row_anchor;void 0!==e&&''!==(e=e.trim())&&(t+=' #'+e)}const k=O.createElement('div');k.className='tb_data_mod_name',k.textContent=t.charAt(0).toUpperCase()+t.slice(1),x.appendChild(k)}this.el.appendChild(x)}if(1!=isHoverMode&&(o.classList.add('tb_element_clicked'),D.body[0].classList.add('tb_action_active'),'visual'===j.mode&&j.EdgeDrag.addEdges('module'===g?h.get('mod_name'):g,h,o)),!(!0===a&&(h.trigger('edit',i,e),1==isHoverMode||null!==this.disablePosition&&!1!==f&&1==isHoverMode)||null!==this.disablePosition))if(!1===f&&1!=isHoverMode){let e=i.pageX,t=i.pageY;if('visual'!==j.mode){const L=j.Instances.Builder[0].el.getBoundingClientRect();e=i.clientX-L.left,t=i.clientY-L.top+30}this.setPosition(this.el,{left:e,top:t})}else j.Utils.addViewPortClass(this.prevExpand)}}else!0!==isHoverMode&&this.clear()}},setBreadCrumbs(e){for(;null!==this.breadCrumbs.firstChild;)this.breadCrumbs.removeChild(this.breadCrumbs.lastChild);this.breadCrumbs.appendChild(this.getBreadCrumbs(e)),null===this.el.firstChild?this.el.appendChild(this.breadCrumbs):this.el.insertBefore(this.breadCrumbs,this.el.firstChild)},getBreadCrumbPath(t,e){const i=null!==this.breadCrumbsPath[e='rightClick'!==e?'lightbox':e]?this.breadCrumbsPath[e]:[];if(!(0<i.length)&&void 0!==t){let e=t.getAttribute('data-cid');for(e&&i.push(e);!t.classList.contains('module_row');){let e=(t=t.parentNode).getAttribute('data-cid');e&&i.push(e)}}return i},getBreadCrumbs(e,t){const l=this.getBreadCrumbPath(e,t),o=O.createDocumentFragment();if(void 0!==e){const n=('rightClick'===t?e.dataset:j.activeModel||j.ActionBar).cid;for(let s=l.length-1;-1<s;--s){let e=O.createElement('li'),t=j.Models.Registry.lookup(l[s]),i=t.get('elType');e.textContent='column'===i?t.get('component_name'):'module'===i?t.get('mod_name'):i,e.className='tb_bread tb_bread_'+i,n===l[s]&&(e.className+=' tb_active_bc'),e.setAttribute('data-id',l[s]),o.appendChild(e)}}return o},actions(a){const d=j.ActionBar,o=a.target,t=o.tagName;if('keydown'===a.type){if('INPUT'!==t&&'TEXTAREA'!==t&&!themifyBuilder.disableShortcuts&&!U.Lightbox.$lightbox[0].contains(o)&&('visual'!==j.mode||!O.activeElement.contentEditable&&j.liveStylingInstance.$liveStyledElmt[0].contains(O.activeElement))){const r=a.keyCode,c=O.getElementsByClassName('tb_element_clicked');let n=c.length;if(0<n){'keydown'!==a.type&&(a.preventDefault(),a.stopPropagation());let t=null,i=null,l=void 0,o=!0===a.ctrlKey||!0===a.metaKey;46===r||8===r?t='delete':1==o&&(67===r?(t='copy',n=1):68===r?t='duplicate':86===r&&(t='paste',!0===a.shiftKey&&(i='style'))),1<n&&('delete'===t||'paste'===t)&&(l=!0,null!==j.activeModel&&U.Lightbox.$lightbox.is(':visible')&&ThemifyConstructor.saveComponent());for(let e=n-1;-1<e;--e){let s=c[e];if(null===t){if(1==o&&1===n&&(38===r||40===r)){let e,t=38===a.which?'up':'down',i='up'==t?s.previousElementSibling:s.nextElementSibling;if(null!==i){if(s.classList.contains('module_row')){if(!i.classList.contains('module_row'))continue;e=j.Instances.Builder[j.builderIndex].$el}else{if(!s.classList.contains('active_module'))continue;if(!i.classList.contains('active_module'))continue;e=$(s.parentNode.closest('.tb_holder'))}if(i){let e=$(s);'up'==t?e.prev().before(e):e.next().after(e),!0!==d.isHoverMode&&s.classList.add('tb_element_clicked')}}}}else if('delete'!==t||!s.classList.contains('module_column')){let e=j.Models.Registry.lookup($(s).closest('[data-cid]')[0].getAttribute('data-cid'));e.trigger(t,a,i,l)}}'delete'!==t&&!0===d.isHoverMode||d.clear()}}}else if(a.stopPropagation(),'click'===a.type&&null!==o.closest('.switch-wrapper'))o.classList.contains('toggle_switch')&&j.Models.Registry.lookup($(o).closest('[data-cid]')[0].getAttribute('data-cid')).trigger('visibility',a,o);else if(a.preventDefault(),null===d.cid||'LI'!==t&&'SPAN'!==t&&'A'!==t)o.parentNode.classList.contains('tb_help')&&o.focus();else{const i=o.classList.contains('tb_bread'),s=i?o.getAttribute('data-id'):d.cid,l=j.Models.Registry.lookup(s),n=o.classList;let e=null;if(l)if(D.body[0].classList.remove('tb_component_menu_active'),!0===i){if(d.needClear=null,d.disablePosition=!0,O.getElementsByClassName('tb_element_cid_'+s)[0].click(),d.disablePosition=null,'visual'===j.mode){const u=d.el.getBoundingClientRect();u.right>=O.body.clientWidth&&d.setPosition(d.el,{left:u.left,top:d.el.offsetTop+55})}d.needClear=!0}else{const _=o.getAttribute('data-href');if(!0===d.isHoverMode&&n.contains('tb_row_settings')&&'click'===a.type)l.trigger('edit',a,o);else if(_){const m=o.parentNode.getElementsByTagName('li');for(let s=m.length-1;-1<s;--s){let e=m[s].getAttribute('data-href'),t=e?O.getElementById(e):null,i=m[s].classList.contains('selected');m[s].classList.remove('selected'),null!==t&&t.classList.remove('selected'),e!==_||i||('tb_row_options'===e||'tb_rgrids'===e?d.gridMenu(t):'tb_roptions'===e&&0===t.children.length&&d.setRowOptions(t),t.classList.add('selected'),m[s].classList.add('selected'),j.Utils.addViewPortClass(t),D.body[0].classList.add('tb_component_menu_active'))}}else{if(n.contains('tb_edit')||n.contains('tb_styling')||n.contains('tb_visibility_component')||n.contains('tb_settings'))e='edit';else if(n.contains('tb_duplicate'))e='duplicate';else if(n.contains('tb_save_component'))e='save';else if(n.contains('tb_delete'))e='delete';else if(n.contains('tb_import')||n.contains('tb_export'))e='importExport';else if(n.contains('tb_copy_component'))e='copy';else{if(!n.contains('tb_paste_component')&&!n.contains('tb_paste_style')){if('LI'===t||'SPAN'===t||n.contains('tb_action_more')||n.contains('tb_inner_action_more')){const h=o.closest('li');if(null===h)return;let e=h.parentNode,t=e.classList,i=t.contains('tb_grid_list')||t.contains('tb_column_alignment')||t.contains('tb_column_gutter')||t.contains('tb_column_direction')||t.contains('tb_column_height')||t.contains('grid_tabs'),s=o.classList.contains('selected'),l=e.children;if(i&&s)return;for(let e=l.length-1;-1<e;--e)if(l[e].classList.remove('selected'),!1===i){let t=l[e].getElementsByClassName('selected');for(let e=t.length-1;-1<e;--e)t[e].classList.remove('selected')}if(s||(h.classList.add('selected'),D.body[0].classList.add('tb_component_menu_active')),i)t.contains('tb_column_alignment')?d._columnAlignmentClicked(h):t.contains('tb_column_gutter')?d._gutterChange(h):t.contains('tb_column_direction')?d._columnDirectionClicked(h):t.contains('tb_column_height')?d._columnHeight(h):t.contains('grid_tabs')?d._switchGridTabs(h):t.contains('tb_grid_list')&&d._gridClicked(h);else{for(let e=(l=(null!==d.prevExpand?d.prevExpand:d.el.getElementsByClassName('tb_action_label_wrap')[0]).children).length-1;-1<e;--e)l[e].classList.remove('selected');if(!s&&(null===d.prevExpand||'column'===d.type)){const g=h.getElementsByTagName('ul')[0];void 0!==g&&j.Utils.addViewPortClass(g)}}return}return}e='paste'}if(!0!==d.isHoverMode)d.clear();else{let e=o.closest('.tb_action_more');null!==e&&((e=e.getElementsByTagName('ul')[0]).style.display='none',setTimeout(function(){null!==e&&(e.style.display='')},100))}l.trigger(e,a,o)}}}},_switchGridTabs(e){j.ActionBar.disable=j.clearOnModeChange=!0,j.ActionBar.hoverCid=null,j.scrollTo=$('.tb_element_cid_'+this.cid),ThemifyConstructor.lightboxSwitch(e.getAttribute('data-id')),'visual'!==j.mode&&this.gridMenu(e.closest('.tb_toolbar_tabs'))},_gridClicked(e){let i=$(e),s=i.data('grid'),t=this.type,l,o=$('.tb_element_cid_'+this.cid).first(),n,a=j.activeBreakPoint,d='desktop'===a,r=U.clone(o.closest('.module_row'));if(n='subrow'===t,l=o.find('.'+t+'_inner').first(),!d){if('-auto'!==s[0]){let e='column'+s.join('-'),t=i.data('col');3===t&&l.attr('data-basecol')>t&&(e+=' tb_3col'),l.removeClass(l.attr('data-col_tablet')+' '+l.attr('data-col_tablet_landscape')+' '+l.attr('data-col_mobile')).addClass(e+' tb_grid_classes col-count-'+l.attr('data-basecol')).attr('data-col_'+a,e)}else l.removeClass('tb_grid_classes tb_3col col-count-'+l.attr('data-basecol')+' '+l.attr('data-col_'+a)).attr('data-col_'+a,'');return'visual'===j.mode&&($('body',R.document).height(O.body.scrollHeight),j.Utils.calculateHeight()),j.Utils.setCompactMode(l.children('.module_column')),!1}{let t=l,s=i.data('col');t=t.add($('#tb_rgrids')),void 0===s&&(s=1,i.data('col',s));for(let e=6;0<e;--e)t.removeClass('col-count-'+e);t.addClass('col-count-'+s),l.attr('data-basecol',s),d&&i.closest('.tb_grid_menu').find('.tb_grid_reposnive .tb_grid_list').each(function(){let e=$(this).find('.selected'),t=$(this).data('type'),i=e.data('col');void 0!==i&&(i>s||4===s&&3===i||4<=s&&4<=i&&s!=i)&&(e.removeClass('selected'),l.removeClass('tb_grid_classes col-count-'+l.attr('data-basecol')+' '+l.attr('data-col_'+t)).attr('data-col_'+t,''),$(this).closest('.tb_grid_list').find('.'+t+'-auto').addClass('selected'))})}const c=l.children('.module_column'),u=s.length,_='module_column'+(n?' sub_column':'')+' col';for(let t=0;t<u;++t){let e=c.eq(t);0<e.length?e.removeClass(j.Utils.gridClass.join(' ')).addClass(_+s[t]):j.Utils._addNewColumn({newclass:_+s[t],component:n?'sub-column':'column'},l[0])}u<l.children().length&&l.children('.module_column').eq(u-1).nextAll().each(function(){const e=$(this).find('.tb_holder').first();e.children().appendTo($(this).prev().find('.tb_holder').first()),$(this).remove()});const m=l.children();m.removeClass('first last'),l.hasClass('direction-rtl')?(m.last().addClass('first'),m.first().addClass('last')):(m.first().addClass('first'),m.last().addClass('last')),j.hasChanged=!0,o=l.closest('.module_row'),j.Mixins.Builder.columnDrag(null,c),D.body.triggerHandler('tb_grid_changed',[o,l]),j.undoManager.push(o.data('cid'),r,o,'row')},_columnHeight(e){const t=$(e),i=t.data('value');if(void 0!==i){const s=$('.tb_element_cid_'+this.cid).first(),l=j.Models.Registry.lookup(this.cid),o=U.clone(s),n=s.find('.'+this.type+'_inner').first();''===i?n.removeClass('col_auto_height'):n.addClass('col_auto_height'),l.set({column_h:i},{silent:!0}),j.undoManager.push(this.cid,o,$('.tb_element_cid_'+this.cid).first(),'row')}},_columnAlignmentClicked(e){const t=(e=$(e)).data('alignment');if(t){const i=$('.tb_element_cid_'+this.cid).first(),s=j.Models.Registry.lookup(this.cid),l=U.clone(i);i.find('.'+this.type+'_inner').first().removeClass(s.get('column_alignment')).addClass(t),s.set({column_alignment:t},{silent:!0}),j.undoManager.push(this.cid,l,$('.tb_element_cid_'+this.cid).first(),'row')}},_columnDirectionClicked(e){const t=(e=$(e)).data('dir');if(t){const i=$('.tb_element_cid_'+this.cid).first(),s=i.find('.'+this.type+'_inner').first(),l=s.children('.module_column'),o=l.first(),n=l.last(),a=j.Models.Registry.lookup(this.cid),d={};d[j.activeBreakPoint+'_dir']=t,a.set(d,{silent:!0}),'rtl'===t?(o.removeClass('first').addClass('last'),n.removeClass('last').addClass('first'),s.addClass('direction-rtl')):(o.removeClass('last').addClass('first'),n.removeClass('first').addClass('last'),s.removeClass('direction-rtl')),s.attr('data-'+j.activeBreakPoint+'_dir',t)}},_gutterChange(e){const t=$(e),i=t.data('value');if(i){const s=$('.tb_element_cid_'+this.cid).first(),l=j.Models.Registry.lookup(this.cid),o=l.get('gutter'),n=U.clone(s),a=s.find('.'+this.type+'_inner').first();j.Mixins.Builder.columnDrag(null,a[0].children,o,i),a.removeClass(o).addClass(i),l.set({gutter:i},{silent:!0}),j.undoManager.push(this.cid,n,$('.tb_element_cid_'+this.cid).first(),'row')}},gridMenu(e){const t=j.activeBreakPoint,i='desktop'===t,l=j.Models.Registry.lookup(this.cid),s=l.get(t+'_dir'),o=e.closest('.module_'+this.type)||O.getElementsByClassName('tb_element_cid_'+this.cid)[0],n=o.getElementsByClassName(this.type+'_inner')[0],a=n.children,d=a.length,r=e.getElementsByClassName('tb_grid_'+t)[0],c='tb_rgrids'===e.id?e:e.querySelector('#tb_rgrids');let u=1==i?void 0:n.getAttribute('data-col_'+t),_=[],m=r.getElementsByClassName('tb_grid_list')[0].getElementsByTagName('li');for(let e=0;e<d;++e)_.push(j.Utils._getColClass(a[e].className.split(' ')));for(let e=6;-1<e;--e)c.classList.remove('col-count-'+e);c.classList.add('col-count-'+d),_='grid-layout-'+(_='2-1-2-1'===(_=_.join('-'))?'4-2-4-2':_),u=!('-auto'===u||!u)&&'grid-layout-'+u.replace(/column|tb_3col/gi,'').trim(),0!=i||!1!==u&&1!==d||(u=t+'-auto');for(let t=m.length-1;-1<t;--t){let e=1==i&&m[t].classList.contains(_)||0==i&&m[t].classList.contains(u);m[t].classList.toggle('selected',e)}if('ltr'!==s)for(let e=(m=r.getElementsByClassName('tb_column_direction')[0].getElementsByTagName('li')).length-1;-1<e;--e)m[e].classList.toggle('selected',m[e].getAttribute('data-dir')===s);if(1==i){let t=l.get('column_alignment'),i=l.get('column_h'),s=l.get('gutter'),e=l.get('sizes');if(e&&(s||(s='narrow'===e.desktop_gutter||'none'===e.desktop_gutter?'gutter-'+e.desktop_gutter:'gutter-default',l.set({gutter:s},{silent:!0})),!t&&e.desktop_align&&(t='center'===(t=e.desktop_align)?'col_align_middle':'end'===t?'col_align_bottom':'col_align_top',l.set({column_alignment:t},{silent:!0})),!i&&e.desktop_auto_h&&(i=!0,l.set({column_h:i},{silent:!0}))),'col_align_top'!==t||!0===themifyBuilder.is_fullSection){const h=r.getElementsByClassName('tb_column_alignment')[0].getElementsByTagName('li');for(let e=h.length-1;-1<e;--e)h[e].classList.toggle('selected',h[e].getAttribute('data-alignment')===t)}if('gutter-default'!==s){const g=r.getElementsByClassName('tb_column_gutter')[0].getElementsByTagName('li');for(let e=g.length-1;-1<e;--e)g[e].classList.toggle('selected',g[e].getAttribute('data-value')===s)}if(i){const b=r.getElementsByClassName('tb_column_height')[0].getElementsByTagName('li');for(let e=b.length-1;-1<e;--e)b[e].classList.toggle('selected',b[e].getAttribute('data-value')==i)}}},setRowOptions(e){let t=null;const i=j.activeModel,s=ThemifyConstructor.component,l=j.Models.Registry.lookup(this.cid),o=l.get('styling')||{};if(null!==i){const n='module'===j.activeModel.get('elType')?'mod_settings':'styling';t=j.activeModel.get(n)}if(void 0!==e.children[0])for(;e.firstChild;)e.removeChild(e.lastChild);ThemifyConstructor.values=o,ThemifyConstructor.component=this.type,j.activeModel=l,e.appendChild(ThemifyConstructor.create(ThemifyConstructor.data.row.setting.options.slice(0,6))),ThemifyConstructor.values=t,j.activeModel=i,ThemifyConstructor.component=s},clear(){if(null!==this.type){for(this.cid=this.type=null,this.el.classList.remove('tb_show_toolbar');null!==this.el.firstChild;)this.el.removeChild(this.el.lastChild);if(null!==this.prevExpand&&void 0!==this.prevExpand){for(;null!==this.prevExpand.firstChild;)this.prevExpand.removeChild(this.prevExpand.lastChild);this.prevExpand.removeAttribute('id'),'visual'===j.mode&&(this.prevExpand.style.top=''),this.prevExpand.closest('.tb_action_wrap').classList.remove('tb_clicked'),this.prevExpand=null}this.clearSelected(),D.body[0].classList.remove('tb_action_active','tb_component_menu_active')}},clearSelected(){'visual'===j.mode&&j.EdgeDrag.clearEdges()},clearClicked(){const t=j.Instances.Builder[0].el.getElementsByClassName('tb_element_clicked');for(let e=t.length-1;-1<e;--e)t[e].classList.remove('tb_element_clicked')},setPosition(t,e){t.removeAttribute('data-top');const i=t.getBoundingClientRect(),s=i.width,l=i.height+40,o='visual'===j.mode?b.pageYOffset:j.toolbar.el.offsetTop+this.topH,n='visual'===j.mode?O.body:j.Instances.Builder[0].el,a=n.clientWidth;let d={};(d=void 0!==e.nodeType?$(e).offset():(e.top,e)).right=d.bottom='',d.left-=parseFloat(s/2),d.top-=l,d.left+s>a?(d.left='auto',d.right=10):d.left<0&&(d.left=30),d.top>n.clientHeight?'visual'!==j.mode&&(d.top='auto',d.bottom=50):o>d.top&&(t.dataset.top=!0,d.top+=2*l-25,'visual'!==j.mode&&(d.top-=l/2));for(let e in d)t.style[e]='auto'!==d[e]&&''!==d[e]?d[e]+'px':d[e]}},j.Forms.register_validator=function(e,t){this.Validators[e]=t},j.Forms.get_validator=function(e){return void 0!==this.Validators[e]?this.Validators[e]:this.Validators.not_empty},j.Forms.register_validator('email',function(e){const t=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,i=e.split(',');for(let e=i.length-1;-1<e;--e)if(!t.test(i[e]))return!1;return!0}),j.Forms.register_validator('not_empty',function(e){return!(!e||''===e.trim())}),j.GS={styles:{},initContent:!1,loadingPosts:!1,allLoaded:!1,el:null,dropdown:null,isShown:null,field:null,isGSPage:O.body.classList.contains('gs_post'),activeGS:null,xhr:null,key:'global_styles',previousModel:null,liveInstance:null,init(){if(!0===this.isGSPage)if(R.document.body.classList.add('gs_post'),'visual'!==j.mode||!0===D.is_builder_loaded)this.openStylingPanel();else{const t=this;R.Themify.on('themify_builder_ready',function(e){t.openStylingPanel()},!0)}else null!==themifyBuilder.globalStyles&&(this.extend(this.styles,themifyBuilder.globalStyles),themifyBuilder.globalStyles=null)},extend(t,i){for(let e in i)void 0!==i[e]&&(t[e]=i[e]);return t},openStylingPanel(){const s=function(){null===ThemifyConstructor.label&&(ThemifyConstructor.label=themifyBuilder.i18n.label);const e=themifyBuilder.globalStyleData.type;let t;switch(e){case'row':case'column':t='module_'+e;break;case'subrow':t='active_subrow';break;default:t='active_module';break}const i=j.Models.Registry.lookup(j.Instances.Builder[j.builderIndex].el.getElementsByClassName(t)[0].dataset.cid);i.set('styleClicked',{silent:!0}),j.isPreview=!1,i.trigger('edit',null),j.isPreview=!0,D.body.one('themify_builder_save_data',s)};s(),j.toolbar.el.getElementsByClassName('tb_toolbar_builder_preview')[0].click()},setCss(e,t,i){'visual'===j.mode&&j.liveStylingInstance.setCss(e,t,i)},createCss(e,t,i){ThemifyStyles.GS={};const s=ThemifyStyles.createCss(e,t,i,this.styles);if(!0===i&&0<Object.keys(this.styles).length&&s.gs){s.gs.used='';for(let e in this.styles)s.gs.used+=''===s.gs.used?'':', ',s.gs.used+=this.styles[e].title}return s},findUsedItems(e){e=JSON.stringify(e);let t=/"global_styles":"(.*?)"/gm,i,s='';for(;null!==(i=t.exec(e));)s+=' '+i[1].trim();if(i=null,''===(s=s.trim()))return!1;{const l=[];for(let e=(s=$.unique(s.split(' '))).length-1;-1<e;--e)void 0!==this.styles[s[e]]&&l.push(s[e]);return l}},globalStylesHTML(){if(!0===this.isGSPage||null!==this.activeGS)return!1;const e=O.createElement('div'),t=O.createElement('div'),i=O.createElement('span');if(this.isShown=null,this.field=ThemifyConstructor.hidden.render({id:j.GS.key,is_responsive:!1,value:ThemifyConstructor.values[j.GS.key],control:!1},ThemifyConstructor),e.className='tb_gs_container',this.field.value){let t=this.field.value.split(' '),i='';for(let e=t.length-1;-1<e;--e)void 0!==this.styles[t[e]]&&(i+=' '+t[e]);i=i.trim(),this.field.value=i}else this.field.value='';if(t.className='tb_gs_icon',t.addEventListener('click',function(e){if(e.target.classList.contains('tb_gs_icon')){const t=this.el;if(t.classList.contains('tb_gs_dropdown_opened'))e.stopPropagation(),t.classList.remove('tb_gs_dropdown_action','tb_gs_dropdown_opened');else{t.classList.add('tb_gs_dropdown_opened','tb_gs_dropdown_action');const i=function(e){null===t||t.contains(e.target)||(O.removeEventListener('click',i,{passive:!0}),'visual'===j.mode&&R.document.removeEventListener('click',i,{passive:!0}),t.classList.remove('tb_gs_dropdown_action','tb_gs_dropdown_opened'))};O.addEventListener('mousedown',i,{passive:!0}),'visual'===j.mode&&R.document.addEventListener('mousedown',i,{passive:!0})}}}.bind(this),{passive:!0}),i.className='tb_gs_tooltip',i.textContent=themifyBuilder.i18n.gs,t.appendChild(j.Utils.getIcon('ti-brush-alt')),t.appendChild(i),e.appendChild(this.field),e.appendChild(t),this.el=e,''!==this.field.value){const s=this.stylingOverlay();null!==s&&e.appendChild(s)}return e.addEventListener('click',this.initClickEvent.bind(this)),this.initContent=!1,this.el},initHTML(){const i=O.createElement('div'),e=this.field.value.trim();if(''!==e){const s=e.split(' ');for(let e=0,t=s.length;e<t;++e)void 0!==this.styles[s[e]]&&i.appendChild(this.createSelectedItem(s[e]))}i.className='tb_gs_selected_styles',this.el.appendChild(i);const t=this.el.getElementsByClassName('tb_gs_icon')[0];t.parentNode.insertBefore(O.getElementById('tmpl-global_styles').content.cloneNode(!0),t.nextSibling),this.initContent=!0},createSelectedItem(e){const t=this.styles[e],i=O.createElement('div'),s=O.createElement('span'),l=O.createElement('span'),o=O.createElement('span');return i.className='tb_selected_style',i.dataset.styleId=e,o.className='tb_gs_edit',o.appendChild(j.Utils.getIcon('ti-pencil')),i.appendChild(o),s.innerText=t.title,i.appendChild(s),l.className='tb_delete_gs tf_close',i.appendChild(l),i},saveAs(){const t=this;U.LiteLightbox.prompt(themifyBuilder.i18n.enterGlobalStyleName,function(e){if(null!==e){if(''===e)return alert(themifyBuilder.i18n.enterGlobalStyleName),t.saveAs(),!1;t.saveAsCallback(e)}})},saveAsCallback(e){ThemifyConstructor.setStylingValues(j.activeBreakPoint);let t=j.activeModel.get('elType');const o=this,i=j.Utils.clear(ThemifyConstructor.values);'module'===t&&(t=j.activeModel.get('mod_name')),delete i[this.key],$.ajax({type:'POST',url:themifyBuilder.ajaxurl,dataType:'json',data:{action:'tb_save_as_new_global_style',tb_load_nonce:themifyBuilder.tb_load_nonce,type:t,styles:i,title:e},beforeSend(){U.showLoader('show')},error(){U.showLoader('error')},success(l){if(U.showLoader('hide'),'success'===l.status){l=l.post_data,o.styles[l.class]=l,j.Utils.saveCss(j.Utils.clear(l.data),'',l.id);const e={buttons:{no:{label:ThemifyConstructor.label.no},yes:{label:ThemifyConstructor.label.y}}};U.LiteLightbox.confirm(themifyBuilder.i18n.addSavedGS,function(e){if('yes'===e){o.isGSPage=!0;let i=o.field.value;U.Lightbox.$lightbox[0].getElementsByClassName('reset-styling')[0].click(),o.isGSPage=!1,i=(i=l.class+' '+i).trim(),i=(o.field.value=i).split(' ');const s=o.el.getElementsByClassName('tb_gs_selected_styles')[0];s.innerHTML='';for(let e=0,t=i.length;e<t;++e)s.appendChild(o.createSelectedItem(i[e]));j.GS.generateValues(null,i,!0);const t=o.stylingOverlay();null!==t&&o.el.appendChild(t)}o.addItemToDropdown([l.class])},e)}else alert(l.msg)}})},delete(t){if(null!==this.field){j.hasChanged=!0;const i=this.el.querySelector('.global_style_item[data-style-id="'+t+'"]'),s=this.el.querySelector('.tb_selected_style[data-style-id="'+t+'"]');null!==i&&i.classList.remove('selected'),null!==s&&s.parentNode.removeChild(s);let e=this.field.value.trim().split(' ');return e.splice(e.indexOf(t),1),this.field.value=e=e.join(' '),null!==j.ActionBar.contextMenu&&j.ActionBar.contextMenu.contains(this.field)?j.ActionBar.rightClickGS(t,e,!0):this.generateValues(t,e.split(' '),!0),!0}},insert(t){if(null!==this.field){j.hasChanged=!0,null!==this.dropdown&&this.dropdown.querySelector('.global_style_item[data-style-id="'+t+'"]').classList.add('selected'),this.el.getElementsByClassName('tb_gs_selected_styles')[0].appendChild(this.createSelectedItem(t));let e=this.field.value+' '+t;var i;this.field.value=e=e.trim(),''!==e&&null!==(i=this.stylingOverlay())&&(this.el.classList.add('tb_gs_dropdown_action'),this.el.appendChild(i)),null!==j.ActionBar.contextMenu&&j.ActionBar.contextMenu.contains(this.field)?j.ActionBar.rightClickGS(t,e):this.generateValues(t,e.split(' '))}},search(){const l=this;this.el.querySelector('#global-style-search').addEventListener('input',function(e){const s=e.target.value.toUpperCase(),t=this.el,i=function(){const i=t.getElementsByClassName('tb_gs_list')[0].getElementsByClassName('global_style_item');for(let t=i.length-1;-1<t;--t){let e=i[t].getElementsByClassName('global_style_title')[0];e&&(i[t].style.display=-1<e.innerHTML.toUpperCase().indexOf(s)?'':'none')}};null!==l.xhr&&(l.xhr.abort(),l.xhr=null),l.allLoaded||setTimeout(function(){l.loadMore(s,i)},100),i()}.bind(this),{passive:!0})},addItemToDropdown(o){if(null!==this.dropdown){const n=O.createDocumentFragment(),a=this.field.value.split(' '),e=this.dropdown.getElementsByClassName('tb_no_gs_item')[0];for(let l=0,e=o.length;l<e;++l){let e=this.styles[o[l]],t=O.createElement('div'),i=O.createElement('span'),s=O.createElement('span');t.className='global_style_item',t.className+=-1!==a.indexOf(o[l])?' selected':'',t.dataset.styleId=o[l],s.className='global_style_title',s.innerText=e.title,i.className='global_style_type',i.innerText=e.type,t.appendChild(s),t.appendChild(i),n.appendChild(t)}e.parentNode.insertBefore(n,e)}},loadMore(i,s){const l=this,t=[];this.loadingPosts=!0;for(let e in this.styles)void 0!==this.styles[e].id&&t.push(this.styles[e].id);this.xhr=$.ajax({type:'POST',url:themifyBuilder.ajaxurl,dataType:'json',data:{s:i,action:'tb_get_gs_posts',tb_load_nonce:themifyBuilder.tb_load_nonce,loaded:t},success(e){l.extend(l.styles,e);const t=Object.keys(e);i||(l.allLoaded=t.length<10),l.addItemToDropdown(t),l.loadingPosts=!1,s&&s()}})},initDropdown(){this.dropdown=this.el.getElementsByClassName('tb_gs_list')[0];const e=Object.keys(this.styles);this.addItemToDropdown(e),e.length<10&&!1===this.allLoaded&&this.loadMore(),!1===this.allLoaded&&this.dropdown.addEventListener('scroll',this.onScroll.bind(this),{passive:!0}),this.search()},initClickEvent(e){!0!==this.initContent&&this.initHTML();const t=e.target,i=t.classList;if('LABEL'===t.nodeName||i.contains('tb_open_gs'))return!0;'insert'===t.dataset.action?(e.preventDefault(),e.stopImmediatePropagation(),this.el.classList.remove('tb_gs_dropdown_action'),void 0===t.dataset.init&&(this.initDropdown(),t.dataset.init=!0)):i.contains('global_style_title')?(e.preventDefault(),e.stopImmediatePropagation(),this.insert(t.parentNode.dataset.styleId)):i.contains('tb_delete_gs')?(e.preventDefault(),e.stopImmediatePropagation(),this.delete(t.parentNode.getAttribute('data-style-id'))):'save'===t.dataset.action?(e.preventDefault(),e.stopImmediatePropagation(),this.saveAs()):i.contains('tb_gs_edit')&&this.liveEdit(t.parentNode.dataset.styleId)},onScroll(e){if(!1===this.allLoaded&&!1===this.loadingPosts){const t=e.target,i=Math.max(t.scrollHeight-(t.scrollTop+t.offsetHeight),0);0<i&&i<=200&&(this.loadingPosts=!0,this.loadMore())}},updated(e,t,i,s){!1===this.isGSPage&&'visual'===j.mode&&'module'!==j.activeModel.get('elType')&&this.extraStyle(t,i,s)},setImport(t,e,i,s){if(!0!==s)for(let e in t)void 0!==this.styles[e]&&delete t[e];if(0<Object.keys(t).length){this.loadingPosts=!0;const l=this;U.showLoader('show'),$.ajax({type:'POST',url:themifyBuilder.ajaxurl,dataType:'json',data:{onlySave:s?1:0,action:'tb_import_gs_posts_ajax',tb_load_nonce:themifyBuilder.tb_load_nonce,data:JSON.stringify(t)},error(){U.showLoader('error')},success(t){if(l.loadingPosts=!1,t)for(let e in t)l.styles[e]=t[e];e&&e(i),U.showLoader('hide')}})}else e&&e(i)},generateValues(t,i,s){if(!0!==this.isGSPage&&'visual'===j.mode){let e=j.activeModel.get('elType');'module'===e&&(e=j.activeModel.get('mod_name'));const l=j.activeModel.get('element_id'),o={styling:ThemifyStyles.generateGSstyles(i,e,this.styles),element_id:l},n=(ThemifyStyles.disableNestedSel=!0,null===this.liveInstance&&(this.liveInstance=j.createStyleInstance(),this.liveInstance.init(!0,!0)),this.createCss([o],e)),a=this.liveInstance,d=[],r=j.activeBreakPoint,c=a.prefix,u=new RegExp(c,'g');if(!(ThemifyStyles.disableNestedSel=null)===s){let i=ThemifyConstructor.breakpointsReverse;for(let t=i.length-1;-1<t;--t){j.activeBreakPoint=i[t],a.setMode(i[t],!0);let e=a.currentSheet,s=e.cssRules||e.rules;for(let e=s.length-1;-1<e;--e)if(-1!==s[e].selectorText.indexOf(c)){let t=s[e].selectorText.replace(/\,\s+/g,',').replace(u,'').split(','),i=s[e].cssText.split('{')[1].split(';');if(-1!==t[0].indexOf('.tb_text_wrap'))for(let e=t.length-1;0<e;--e)-1!==t[e].indexOf('.tb_text_wrap')&&t.splice(e,1);for(let e=i.length-2;-1<e;--e)a.setLiveStyle(i[e].trim().split(': ')[0].trim(),'',t)}}}delete n.gs;for(let o in n)if('fonts'===o||'cf_fonts'===o)for(let t in n[o]){let e=t;0<n[o][t].length&&(e+=':'+n[o][t].join(',')),d.push(e)}else{j.activeBreakPoint=o,a.setMode(o,!0);for(let i in n[o]){let l=i.replace(/\,\s+/g,',').replace(u,'').split(',');for(let e=0,t=n[o][i].length;e<t;++e){let s=n[o][i][e].split(';');for(let i=s.length-2;-1<i;--i)if(''!==s[i]){let e=s[i].split(':')[0],t=s[i].replace(e+':','').trim();'background-image'===e&&-1!==s[i].indexOf('svg')&&-1!==s[i].indexOf('data:')&&(t+=';'+s[i+1]),a.setLiveStyle(e,t,l)}}}}0<d.length&&ThemifyConstructor.font_select.loadGoogleFonts(d.join('|')),j.activeBreakPoint=r,this.updated(t,n,o,i),this.liveInstance=null}},extraStyle(i,e,t){var s=null!==this.liveInstance?this.liveInstance:j.liveStylingInstance,l=s.prefix.length-1,o=0!==s.getComponentBgOverlay(j.activeModel.get('elType')).length,n=s.$liveStyledElmt,a=o,d={top:!1,bottom:!1,left:!1,right:!1},r=0,c='builder-parallax-scrolling',u='builder-zoom-scrolling';e:for(let e in i)if('fonts'!==e&&'cf_fonts'!==e&&'gs'!==e)for(let t in i[e]){if(!1===a&&(a=-1!==t.indexOf('builder_row_cover',l)),-1!==t.indexOf('tb_row_frame',l))for(let e in d)if(!1===d[e]&&-1!==t.indexOf('tb_row_frame_'+e,l)){d[e]=!0,++r;break}if(!0===a&&4===r)break e}if(i=null,0==o&&!0===a&&s.addOrRemoveComponentOverlay(),0<r){const m=O.createDocumentFragment();for(let t in d)if(!0===d[t]&&0===n.children('.tb_row_frame_'+t).length){let e=O.createElement('div');e.className='tf_abs tf_overflow tb_row_frame tb_row_frame_'+t,e.className+='left'===t||'right'===t?' tf_h':' tf_w',m.appendChild(e)}n.children('.tb_action_wrap').after(m)}let _=void 0!==e.styling?e.styling.background_type:'none';'image'===(_=_||'image')&&e.styling.background_repeat===c&&e.styling.background_image?(n[0].classList.add(c),ThemifyBuilderModuleJs.loadOnAjax(n,null,!0)):(n[0].classList.remove(c),n[0].style.backgroundPosition='','image'===_&&e.styling.background_repeat===u&&e.styling.background_image?(n[0].classList.add(u),ThemifyBuilderModuleJs.loadOnAjax(n,null,!0)):(n[0].classList.remove(u),n[0].style.backgroundSize=''))},liveEdit(e){let t={styleClicked:!0},i,d=!1;if(null===j.activeModel&&null!==j.ActionBar.contextMenu&&j.ActionBar.contextMenu.contains(this.field)){const a=j.Instances.Builder[j.builderIndex].el.getElementsByClassName('tb_element_clicked')[0];if(void 0===a)return;j.activeModel=j.Models.Registry.lookup(a.getAttribute('data-cid')),t.element_id=j.activeModel.get('element_id'),this.previousModel=j.activeModel.cid,d=!0,j.Utils.scrollToDropped(a)}else null!==j.activeModel&&(this.previousModel=j.activeModel.cid,t.element_id=j.activeModel.get('element_id'),ThemifyConstructor.saveComponent(!0));const s=this.styles[e],r=this,l=ThemifyConstructor.label.done,o='visual'===j.mode?$.extend(!0,{},j.liveStylingInstance):null,n=$.extend(!0,{},s.data[0]),c=s.type,u=(this.activeGS=e,i='row'===c?(delete n.cols,delete n.styling[this.key],j.Views.init_row(n)):'subrow'===c?(delete n.cols,delete n.styling[this.key],j.Views.init_subrow(n)):(delete n.styling,'column'===c?(delete n.cols[0].modules,delete n.cols[0].styling[this.key],j.Views.init_column(n.cols[0])):(delete n.cols[0].styling,delete n.cols[0].modules[0].mod_settings[this.key],j.Views.init_module(n.cols[0].modules[0]))),U.Lightbox.$lightbox[0].className+=' gs_post',ThemifyConstructor.label.done=ThemifyConstructor.label.s_s,j.ActionBar.hideContextMenu(),U.Lightbox.$lightbox.one('themify_opened_lightbox.tb_gs_edit',function(){this.getElementsByClassName('current')[0].getElementsByClassName('tb_tooltip')[0].textContent=ThemifyConstructor.label.g_s+' - '+s.title}),i.model.set(t,{silent:!0}),i.model.trigger('edit',null),function(){if(D.body.off('themify_builder_lightbox_close.tb_gs_edit themify_builder_save_component.tb_gs_edit'),U.Lightbox.$lightbox[0].classList.remove('gs_post'),ThemifyConstructor.label.done=l,i.model.destroy(),'visual'===j.mode){if(o.prefix&&(j.liveStylingInstance=o,j.liveStylingInstance.$liveStyledElmt=$(O.querySelector(o.prefix)),null!==r.previousModel&&('row'===c||'column'===c||'subrow'===c))){const e=j.Models.Registry.lookup(r.previousModel);e&&'module'===e.get('elType')&&(j.liveStylingInstance.getComponentBgOverlay().remove(),j.liveStylingInstance.removeBgSlider(),j.liveStylingInstance.removeBgVideo(),j.liveStylingInstance.$liveStyledElmt.children('.tb_row_frame').remove(),j.liveStylingInstance.$liveStyledElmt[0].classList.remove('builder-zoom-scrolling','builder-zooming'))}r.liveInstance=null}r.activeGS=null});D.body.one('themify_builder_lightbox_close.tb_gs_edit',function(e){u(),d?r.previousModel=null:r.reopenPreviousPanel()}).one('themify_builder_save_component.tb_gs_edit',function(e,t){const i=r.activeGS,s=r.styles[i],l=r.previousModel,o=(delete ThemifyConstructor.values.cid,ThemifyConstructor.setStylingValues(j.activeBreakPoint),ThemifyConstructor.values),n=j.activeModel;if(delete o[this.key],'row'===c||'subrow'===c?(s.data[0].styling=o,delete s.data[0].cols):(delete s.data[0].styling,delete s.data[0].cols[0].grid_class,'column'===c?(delete s.data[0].cols[0].modules,s.data[0].cols[0].styling=o):(delete s.data[0].cols[0].styling,s.data[0].cols[0].modules[0].mod_settings=o)),U.showLoader('show'),j.Utils.saveCss(s.data,'',s.id),s.data=j.Utils.clear(s.data),r.styles[i].data=s.data,r.activeGS=null,r.previousModel=null,'visual'===j.mode&&j.hasChanged){const a=j.Models.Registry.items;for(let t in a){let e='module'===a[t].get('elType')?a[t].get('mod_settings'):a[t].get('styling');void 0!==e[r.key]&&''!==e[r.key]&&-1!==e[r.key].indexOf(i)&&(j.activeModel=a[t],r.generateValues(i,e[r.key].split(' '),!0))}r.liveInstance=null}j.activeModel=n,r.previousModel=l,u(),j.hasChanged=!1,$.ajax({type:'POST',url:themifyBuilder.ajaxurl,dataType:'json',data:{action:'tb_update_global_style',tb_load_nonce:themifyBuilder.tb_load_nonce,data:s.data,id:s.id},error(){U.showLoader('error')},success(){t||d?r.previousModel=null:r.reopenPreviousPanel(),U.showLoader('hide')}})})},reopenPreviousPanel(e){if(void 0!==e)e.model.trigger('edit',e.e,e.target);else if(null!==this.previousModel){const t=j.Models.Registry.lookup(this.previousModel);null!==t&&(t.set({styleClicked:!0},{silent:!0}),t.trigger('edit',null)),this.previousModel=null}},stylingOverlay(){if(null!==this.isShown||null===j.activeModel||null!==this.el.parentNode&&this.el.parentNode.classList.contains('tb_inline_gs_show'))return null;{this.isShown=!0;const e=O.createElement('div'),t=O.createElement('p');return e.className='tb_gs_options_overlay',t.textContent=themifyBuilder.i18n.has_gs,e.addEventListener('click',function(e){e.preventDefault(),e.stopPropagation(),this.parentNode.removeChild(this)},{once:!0}),e.appendChild(t),e}}}}(jQuery,Backbone,Themify,window,window.top,document,ThemifyBuilderCommon);