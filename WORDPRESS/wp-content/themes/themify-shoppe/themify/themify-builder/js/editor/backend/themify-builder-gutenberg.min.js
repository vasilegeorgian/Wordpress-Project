!function(t,e,n,$){let o=!1;const i=n.createElement,a=(e.__,{stateInit:!1,number:0,tempHTML:null,isRendered(){return null!==document.getElementById('tb_toolbar')},saveHTML(t){this.isRendered()&&(this.tempHTML=document.getElementById('tb_canvas_block').innerHTML)},restoreHTML(t){if('undefined'!=typeof tb_app&&this.tempHTML&&!this.isRendered()&&document.getElementById('tb_canvas_block')&&(document.getElementById('tb_canvas_block').innerHTML=this.tempHTML,tb_app.Instances.Builder[0])){let n=document.getElementById('tb_row_wrapper').querySelectorAll('[data-cid]');for(let e=(n=[].slice.call(n)).length-1;-1<e;--e){let t=tb_app.Models.Registry.lookup(n[e].getAttribute('data-cid'));t&&t.trigger('change:view',n[e])}tb_app.toolbar.setElement($('#tb_toolbar')).render(),tb_app.toolbarCallback(),tb_app.Instances.Builder[0].setElement($('#tb_row_wrapper')),tb_app.Instances.Builder[0].init(!0)}},manageState(t){'undefined'==typeof tb_app||this.stateInit||(this.stateInit=!0,tb_app.vent.on('dom:change',function(){tb_app.hasChanged&&t.setAttributes({data:a.number++})}),tb_app.vent.on('backend:switchfrontend',function(t){window.top.location.href=t}),document.getElementById('block-'+t.clientId).removeAttribute('tabIndex'))},saveBlock(){'undefined'!=typeof tb_app&&(o?o=!1:tb_app.hasChanged?tb_app.Utils.saveBuilder(this.goToFrontend):this.goToFrontend())},goToFrontend(){tb_app.redirectFrontend&&tb_app.vent.trigger('backend:switchfrontend',tb_app.redirectFrontend)}}),d=function(){a.saveBlock()};t.registerBlockType('themify-builder/canvas',{title:'Themify Builder',icon:'layout',category:'layout',useOnce:!0,edit(t){return setTimeout(function(){a.saveHTML(t),a.restoreHTML(t),a.manageState(t),Themify.trigger('tb_canvas_loaded')},800),i('div',{id:'tb_canvas_block'},'placeholder builder')},save(){return null}}),$(function(){$('body').on('click','.editor-post-publish-button, .editor-post-save-draft',function(t){tb_app.hasChanged&&tb_app.Utils.saveBuilder(function(){o=!0})}).off('click.frontend-btn','#tb_switch_frontend').on('click.frontend-btn','#tb_switch_frontend',function(){$('.editor-post-publish-button').on('DOMSubtreeModified',function(){this.classList.contains('is-busy')||$('.editor-post-saved-state').length||(o=!1,d())})})}),$(document).ajaxComplete(function(t,e,n){if('POST'===n.type&&void 0!==window.themifyBuilder&&themifyBuilder.post_ID){const o=n.url,i='post.php?post='+themifyBuilder.post_ID+'&action=edit&classic-editor=1&meta_box=1';-1!==o.indexOf(i)&&setTimeout(d,800)}})}(window.wp.blocks,window.wp.i18n,window.wp.element,jQuery);