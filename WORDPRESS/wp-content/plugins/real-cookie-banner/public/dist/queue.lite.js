var realCookieBanner_queue;(()=>{"use strict";var t={n:e=>{var n=e&&e.__esModule?()=>e.default:()=>e;return t.d(n,{a:n}),n},d:(e,n)=>{for(var o in n)t.o(n,o)&&!t.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:n[o]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e);const n=devowlWp_utils,o=devowlWp_realQueue,a="rcb-scan";let r;const c=(...t)=>(r||(r=(0,n.createLocalizationFactory)(n.BaseOptions.getPureSlug("real-cookie-banner")))).__(...t),i=jQuery;var s=t.n(i);const l={path:"/scanner/queue",method:n.RouteHttpVerb.POST},u=/.+?:\/\/.+?(\/.+?)(?:#|\?(.*)|$)/;function d(t,e,n=""){var o;const a=(null===(o=t.match(u))||void 0===o?void 0:o[1])||"/",r=e.match(u);if(r){const[,e,o]=r,c=o?"?".concat(o).concat(n?"?".concat(n):""):n?"?".concat(n):"";return"".concat(t).concat(e.substr(a.length)).concat(c)}return!1}async function p(t,e){try{const n=e?"".concat(e,"=1"):"",o=await fetch("".concat(t).concat("robots.txt").concat(n?"?".concat(n):""));if(!o.ok)return!1;const a=d(t,(await o.text()).match(/^sitemap:(.*)$/im)[1].trim(),n);if(a){const t=await fetch(a);if(!t.ok)return!1;const e=await t.text();return!!/<(?:sitemap|urlset)/gm.test(e)&&a}return!1}catch(t){return!1}}const m=["sitemap.xml","sitemap_index.xml","sitemap-index.xml","sitemap/","post-sitemap.xml","sitemap/sitemap.xml","sitemap/index.xml","sitemapindex.xml","sitemap.php","sitemap.txt","index.php/sitemap_index.xml","index.php?xml_sitemap=params=","glossar/sitemap.xml"];async function f(t,e=m){const n=e.map((e=>fetch("".concat(t).concat(e),{mode:"no-cors"})));for(const t of n)try{const e=await t,n=await e.text();if(n.indexOf("<sitemapindex")>-1||n.indexOf("<urlset")>-1)return e.url}catch(t){}return!1}const y="https://base";async function h(t,e,n){if(n)try{const o=await async function(t){const e=await fetch(t),n=await e.text();return(new DOMParser).parseFromString(n.trim(),"application/xml")}(e),{protocol:a}=new URL(e,y),r=o.querySelector("sitemapindex");if(r){const e=Array.from(r.children).map((t=>{var e;return null===(e=t.querySelector("loc"))||void 0===e?void 0:e.textContent})).filter(Boolean);for(const o of e){const e=d(t,o)||o;await h(t,e,n)}}const c=o.querySelector("urlset");if(c){const t=Array.from(c.children).map((t=>{var e;return null===(e=t.querySelector("loc"))||void 0===e?void 0:e.textContent})).filter(Boolean).map((t=>{try{const e=new URL(t,y);return"http:"===e.protocol&&(e.protocol=a),e.toString()}catch(e){return t}}));n.push(...t)}}catch(t){console.error("Error occurred during \"crawl('".concat(e,"')\":\n\r Error: ").concat(t))}else try{return(await h(t,e,[])).sort(((t,e)=>t.length-e.length))}catch(t){return console.error(t),[]}return n}async function b(t){const e=c('If you think a sitemap exists but you get this error, please <a href="%s" target="_blank" />contact our support</a> and we will look individually where the problem is in your WordPress installation.',c("https://devowl.io/support/"));let n=window.realCookieBannerQueue.originalHomeUrl;n=n.split("?",2)[0],null==t||t("find-sitemap");const o=await function(t,e,n){return new Promise(((o,a)=>{const r=t=>setTimeout((()=>o(t)),100);(async()=>{try{const o=await p(t);if(o)return void r(o);const a=await f(t);if(a)return void r(a);{const n=await p(t,e);if(n)return void r(n)}if(n){const e=await f(t,n);if(e)return void r(e)}r(!1)}catch(t){a(t)}})()}))}(n,"rcb-force-sitemap",["?sitemap=index&rcb-force-sitemap=1"]);if(!1===o)throw new Error("".concat(c("We didn't find a sitemap on your website. We need it to scan all the subpages of your website. Do you have this feature disabled in your WordPress?")," ").concat(e));null==t||t("collect-sitemap");let a=[];try{a=await h(n,o)}catch(t){throw new Error("".concat(c("The sitemap could not be parsed. Therefore, we cannot check for services on your website.")," ").concat(e))}if(0===a.length)throw new Error("".concat(c("The sitemap is empty. So, we could not add any URLs to the scanner.")," ").concat(e));return a}(0,n.handleCorruptRestApi)({}),document.addEventListener("".concat(o.JOB_DELAY_EVENT_PREFIX).concat(a),(({detail:{isIdle:t,settings:e}})=>{const n=/page=real-cookie-banner(?:-pro)?-component#\/scanner/.test(window.location.href);e.delay_ms=n||t?e.delay_ms:3e3})),document.addEventListener("".concat(o.CLIENT_JOB_EVENT_PREFIX).concat(a),(async({detail:{job:{id:t,data:{url:e},process_total:a,group_position:r,group_total:c,group_uuid:i},resolve:s,reject:l,saveJobResult:u}})=>{const d=new URL(e);(0,n.applyQueryString)(d,[{"rcb-scan":1,"rcb-scan-job":t}],!0);const p='<a href="'.concat(e,'" target="_blank">').concat(e,"</a>");try{const{ok:e,status:n,statusText:f,type:y,headers:h}=await window.fetch(d.toString(),{mode:"no-cors"}),b="opaque"===y;if(e||b){var m;!i||r!==c&&1!==r||(0,o.fetchStatus)(!0),b&&await u(t,a);const e=null===(m=h.get("content-type"))||void 0===m?void 0:m.toLowerCase();e&&!e.startsWith("text/")&&await u(t,a),s()}else l({code:"invalid_response_".concat(n),message:"".concat(f," (").concat(p,")")})}catch(t){l({code:"unexpected",message:"".concat(t.toString()," (").concat(p,")")})}})),function(){const t=document.getElementById("rcb-scan-result-notice"),e=document.querySelector("#wp-admin-bar-rcb-scanner-found-services > a > span:nth-child(2)");let n=!1;document.addEventListener(o.STATUS_ADDITIONAL_DATA_EVENT,(async({detail:{settings:{additionalData:e}}})=>{t&&n&&e.push("rcb-scan-notice")})),document.addEventListener(o.STATUS_EVENT,(({detail:{currentJobs:{[a]:o},remaining:{[a]:r},additionalData:{"rcb-scan-notice":i}}})=>{let l=100;const u=(null==r?void 0:r.failure)>0;if(r&&(null==o?void 0:o.group_position)>0){const{remaining:t,total:e}=r;l=+((e-t)/e*100).toFixed(0)}const d=l>0&&l<100,p=document.getElementById("rcb-scanner-status"),m=document.getElementById("rcb-checklist-overdue");if(n=d,t&&i&&(t.innerHTML=i.text,e.innerHTML=e.innerHTML.replace(/\d+/,i.countAll.toString())),p){const t="none"!==p.style.display;if(p.innerHTML="".concat(l," %"),p.style.display=d?"inline-block":"none",m&&(m.style.display=d?"none":"inline-block"),t&&!d&&!u)try{const t=s()(['#real-cookie-banner-component .nav-tab[href="#/scanner"]:not(.nav-tab-active)','#real-cookie-banner-pro-component .nav-tab[href="#/scanner"]:not(.nav-tab-active)',"body:not(.toplevel_page_real-cookie-banner-component) #toplevel_page_real-cookie-banner-component","body:not(.toplevel_page_real-cookie-banner-pro-component) #toplevel_page_real-cookie-banner-pro-component"].join(",")),e=t.hasClass("nav-tab");t.pointer({content:"<h3>".concat(c("Real Cookie Banner has scanned your website!"),"</h3><p>").concat(c('You may not have noticed, but we have been scanning your website in the background. View <a href="%s">scanner results</a> to obtain consent for used services from your website visitors!',"".concat(e?"":t.find("a").attr("href"),"#/scanner")),"</p>"),position:e?{edge:"top"}:{edge:"left",align:"bottom"},pointerClass:"wp-pointer arrow-".concat(e?"top":"bottom"),pointerWidth:420});const n=t.pointer("widget");n.css({marginLeft:-10}),e&&n.find(".wp-pointer-arrow").css({marginLeft:-38}),t.pointer("open"),e&&t.add(n.find("a")).on("click",(()=>{t.pointer("destroy")}))}catch(t){}}}))}(),document.addEventListener("".concat(o.CLIENT_JOB_EVENT_PREFIX).concat("rcb-automatic-scan-starter"),(async({detail:{job:{id:t,process_total:e},resolve:a,saveJobResult:r}})=>{let c;const i=setInterval((()=>{c=document.getElementById("rcb-btn-scan-start"),c&&(c.style.display="none")}),1e3);try{const s=await b(),{restRoot:u,restNonce:d,restQuery:p}=window.realQueue,m={restRoot:u,restNamespace:"real-cookie-banner/v1",restNonce:d,restQuery:p};await(0,n.commonRequest)({location:l,options:m,request:{urls:s,purgeUnused:!0}}),await(0,o.refreshQueue)(),(0,o.fetchStatus)(!0)}catch(t){}finally{clearInterval(i),c&&c.style.removeProperty("display"),await r(t,e),a()}})),realCookieBanner_queue=e})();
//# sourceMappingURL=queue.lite.js.map